<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
  <front>
    <journal-meta>
      <journal-id journal-id-type="publisher-id">plos</journal-id>
      <journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
      <journal-id journal-id-type="pmc">ploscomp</journal-id>
      <journal-title-group>
        <journal-title>PLoS Computational Biology</journal-title>
      </journal-title-group>
      <issn pub-type="ppub">1553-734X</issn>
      <issn pub-type="epub">1553-7358</issn>
      <publisher>
        <publisher-name>Public Library of Science</publisher-name>
        <publisher-loc>San Francisco, USA</publisher-loc>
      </publisher>
    </journal-meta>
    <article-meta>
      <article-id pub-id-type="publisher-id">PCOMPBIOL-D-12-01051</article-id>
      <article-id pub-id-type="doi">10.1371/journal.pcbi.1002981</article-id>
      <article-categories>
        <subj-group subj-group-type="heading">
          <subject>Research Article</subject>
        </subj-group>
        <subj-group subj-group-type="Discipline-v2">
          <subject>Biology</subject>
          <subj-group>
            <subject>Computational biology</subject>
            <subj-group>
              <subject>Genomics</subject>
              <subj-group>
                <subject>Comparative genomics</subject>
                <subject>Genome analysis tools</subject>
                <subject>Metagenomics</subject>
              </subj-group>
            </subj-group>
            <subj-group>
              <subject>Metabolic networks</subject>
              <subject>Systems biology</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Comparative genomics</subject>
              <subject>Metagenomics</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Microbiology</subject>
            <subj-group>
              <subject>Microbial metabolism</subject>
            </subj-group>
          </subj-group>
        </subj-group>
        <subj-group subj-group-type="Discipline">
          <subject>Genetics and Genomics</subject>
          <subject>Microbiology</subject>
          <subject>Computational Biology</subject>
        </subj-group>
      </article-categories>
      <title-group>
        <article-title>Probabilistic Inference of Biochemical Reactions in Microbial Communities from Metagenomic Sequences</article-title>
        <alt-title alt-title-type="running-head">Probabilistic Inference of Biochemical Reactions</alt-title>
      </title-group>
      <contrib-group>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Jiao</surname>
            <given-names>Dazhi</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Ye</surname>
            <given-names>Yuzhen</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Tang</surname>
            <given-names>Haixu</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
          <xref ref-type="aff" rid="aff2">
            <sup>2</sup>
          </xref>
          <xref ref-type="corresp" rid="cor1">
            <sup>*</sup>
          </xref>
        </contrib>
      </contrib-group>
      <aff id="aff1">
        <label>1</label>
        <addr-line>School of Informatics and Computing, Indiana University, Bloomington, Indiana, United States of America</addr-line>
      </aff>
      <aff id="aff2">
        <label>2</label>
        <addr-line>Center for Genomics and Bioinformatics, Indiana University, Bloomington, Indiana, United States of America</addr-line>
      </aff>
      <contrib-group>
        <contrib contrib-type="editor" xlink:type="simple">
          <name name-style="western">
            <surname>Ouzounis</surname>
            <given-names>Christos A.</given-names>
          </name>
          <role>Editor</role>
          <xref ref-type="aff" rid="edit1"/>
        </contrib>
      </contrib-group>
      <aff id="edit1">
        <addr-line>The Centre for Research and Technology, Hellas, Greece</addr-line>
      </aff>
      <author-notes>
        <corresp id="cor1">* E-mail: <email xlink:type="simple">hatang@indiana.edu</email></corresp>
        <fn fn-type="conflict">
          <p>The authors have declared that no competing interests exist.</p>
        </fn>
        <fn fn-type="con">
          <p>Conceived and designed the experiments: DJ YY HT. Performed the experiments: DJ. Analyzed the data: DJ YY HT. Wrote the paper: DJ YY HT.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="collection">
        <month>3</month>
        <year>2013</year>
      </pub-date>
      <pub-date pub-type="epub">
        <day>21</day>
        <month>3</month>
        <year>2013</year>
      </pub-date>
      <volume>9</volume>
      <issue>3</issue>
      <elocation-id>e1002981</elocation-id>
      <history>
        <date date-type="received">
          <day>25</day>
          <month>6</month>
          <year>2012</year>
        </date>
        <date date-type="accepted">
          <day>25</day>
          <month>1</month>
          <year>2013</year>
        </date>
      </history>
      <permissions>
        <copyright-year>2013</copyright-year>
        <copyright-holder>Jiao et al</copyright-holder>
        <license xlink:type="simple">
          <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
        </license>
      </permissions>
      <abstract>
        <p>Shotgun metagenomics has been applied to the studies of the functionality of various microbial communities. As a critical analysis step in these studies, biological pathways are reconstructed based on the genes predicted from metagenomic shotgun sequences. Pathway reconstruction provides insights into the functionality of a microbial community and can be used for comparing multiple microbial communities. The utilization of pathway reconstruction, however, can be jeopardized because of imperfect functional annotation of genes, and ambiguity in the assignment of predicted enzymes to biochemical reactions (e.g., some enzymes are involved in multiple biochemical reactions). Considering that metabolic functions in a microbial community are carried out by many enzymes in a collaborative manner, we present a probabilistic sampling approach to profiling functional content in a metagenomic dataset, by sampling functions of catalytically promiscuous enzymes within the context of the entire metabolic network defined by the annotated metagenome. We test our approach on metagenomic datasets from environmental and human-associated microbial communities. The results show that our approach provides a more accurate representation of the metabolic activities encoded in a metagenome, and thus improves the comparative analysis of multiple microbial communities. In addition, our approach reports likelihood scores of putative reactions, which can be used to identify important reactions and metabolic pathways that reflect the environmental adaptation of the microbial communities. Source code for sampling metabolic networks is available online at <ext-link ext-link-type="uri" xlink:href="http://omics.informatics.indiana.edu/mg/MetaNetSam/" xlink:type="simple">http://omics.informatics.indiana.edu/mg/MetaNetSam/</ext-link>.</p>
      </abstract>
      <abstract abstract-type="summary">
        <title>Author Summary</title>
        <p>We present a probabilistic sampling approach to profiling metabolic reactions in a microbial community from metagenomic shotgun reads, in an attempt to understand the metabolism within a microbial community and compare them across multiple communities. Different from the conventional pathway reconstruction approaches that aim at a definitive set of reactions, our method estimates how likely each annotated reaction can occur in the metabolism of the microbial community, given the shotgun sequencing data. This probabilistic measure improves our prediction of the actual metabolism in the microbial communities and can be used in the comparative functional analysis of metagenomic data.</p>
      </abstract>
      <funding-group>
        <funding-statement>This work was partially supported by National Institutes of Health (grant number 1R01HG004908) and National Science Foundation (grant number DBI-0845685). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
      </funding-group>
      <counts>
        <page-count count="11"/>
      </counts>
    </article-meta>
  </front>
  <body>
    <sec id="s1">
      <title>Introduction</title>
      <p>Metagenomics aims to analyze the microbial communities directly extracted from their living environment, bypassing the requirements of isolating and culturing the microbes. With the recent progress of the next generation sequencing (NGS) technologies, the shotgun sequencing of a whole microbial community has become a routine exercise. As a result, the list of metagenomics studies is growing rapidly <xref ref-type="bibr" rid="pcbi.1002981-NIH1">[1]</xref>, <xref ref-type="bibr" rid="pcbi.1002981-Markowitz1">[2]</xref>. This provides ample opportunities for researchers to develop new computational methods to analyze the sequences from metagenomics projects.</p>
      <p>To understand the functional and metabolic potential of a microbial community given the sequencing data, a key analysis is to predict - from raw NGS reads or assembled contigs - protein coding genes and their functions. Functional annotations are often achieved by similarity search (using BLASTX <xref ref-type="bibr" rid="pcbi.1002981-Altschul1">[3]</xref>, or faster tools like BLAT <xref ref-type="bibr" rid="pcbi.1002981-Kent1">[4]</xref> or RAPSearch <xref ref-type="bibr" rid="pcbi.1002981-Ye1">[5]</xref>) against gene families collected in the databases of biological pathways, such as Kyoto Encyclopedia of Genes and Genomes (KEGG) <xref ref-type="bibr" rid="pcbi.1002981-Kanehisa1">[6]</xref>, MetaCyc <xref ref-type="bibr" rid="pcbi.1002981-Caspi1">[7]</xref>, or SEED <xref ref-type="bibr" rid="pcbi.1002981-Overbeek1">[8]</xref> so that biological pathways can be reconstructed from the predicted functions. Although the principle is the same, different annotation systems may use different practices: for example, the HUMAnN pipeline directly predict gene families and pathways from short sequence reads based on similarity searches <xref ref-type="bibr" rid="pcbi.1002981-Abubucker1">[9]</xref>, while MG-RAST first predicts protein coding region from short reads <italic>de novo</italic>, and then predicts the functions of the predicted proteins based on similarity searches <xref ref-type="bibr" rid="pcbi.1002981-Meyer1">[10]</xref>.</p>
      <p>Differential functions or biological pathways can be identified by comparing annotations of metagenomes, providing insights into the differences of functionality of various microbial communities <xref ref-type="bibr" rid="pcbi.1002981-Gianoulis1">[11]</xref>–<xref ref-type="bibr" rid="pcbi.1002981-Liu1">[13]</xref>. For example, in recent work, the community-level metabolic networks of the microbiome were constructed from metagenomic data, and both gene-level and network-level topological differences were identified as associated with the host-based environments <xref ref-type="bibr" rid="pcbi.1002981-Greenblum1">[14]</xref>. For quantitative analysis, the abundances of genes (often measured as the reads counts) need to be normalized according to gene lengths (more reads will be sampled from longer genes), and the quantification of pathways needs to further consider the different sizes of the pathways (<italic>i.e.</italic>, the number of gene families each pathway contains) and the overlaps among different pathways <xref ref-type="bibr" rid="pcbi.1002981-Sharon1">[15]</xref>, <xref ref-type="bibr" rid="pcbi.1002981-Ye2">[16]</xref>.</p>
      <p>In this paper, we present a computational method for inferring the functional activities in a metagenome on the basis of the <italic>metabolic reactions</italic> catalyzed by predicted genes from the dataset, instead of the genes themselves. By directly working on reactions in the context of a global network, our method is immune to the problem of pathway reconstruction caused by the overlaps between pathways - pathways are important for understanding the biological processes, however, their definition can be rather arbitrary, and the overlaps between pathways are artificially created. More importantly, our new method computes the likelihood of each reaction for all potential reactions catalyzed by predicted functions. Clearly, using all potential reactions can lead to an unfaithful estimation of the functionality of a microbial community: functional predictions are noisy and contain mistakes; on the other hand, there are genes that indeed have multiple functions <xref ref-type="bibr" rid="pcbi.1002981-Nobeli1">[17]</xref>, but not all these functions are carried out by the microbial community. Our previous approach MinPath <xref ref-type="bibr" rid="pcbi.1002981-Ye2">[16]</xref>, which has been incorporated in HUMAnN <xref ref-type="bibr" rid="pcbi.1002981-Abubucker1">[9]</xref>, improves pathway reconstruction for metagenomes by removing spurious pathways; MinPath, however, does not provide confidence for individual reactions inferred from metagenomic datasets.</p>
      <p>We propose a probabilistic approach to estimate the <italic>likelihood</italic> of each reaction in a metagenome-scale metabolic network given predictions of enzymes. Our method computes the <italic>marginal probability</italic> of each reaction observed in a collection of randomly sampled subnetworks from the metagenome-scale metabolic network. In these subnetworks, for each annotated gene family, there exists at least one reaction that is carried out by the product of the gene (<italic>i.e.</italic> the enzyme). However, if the product of a gene is annotated to catalyze multiple reactions, some of these reactions may be excluded from the sampled subnetwork, as long as at least one of these reactions is included. We note that, according to this condition, each sampled subnetwork represents a putative reconstruction of the collective metabolic network of the metagenome, among which we assume the subnetworks containing fewer metabolites are more likely to represent the actual metabolism of the microbial community than the ones containing more metabolites. Based on this <italic>parsimony</italic> concept, we devised a Markov Chain Monte Carlo algorithm <xref ref-type="bibr" rid="pcbi.1002981-Robert1">[18]</xref>, by which we randomly sample a large set of subnetworks and estimate the likelihood of each reaction.</p>
      <p>A microbial community adapts its collective metabolic profile to its living environment. Therefore, the similarity measure based on either protein content or metabolic activities in metagenomes can be used to cluster the metagenomes, consistent to similarity of the environments <xref ref-type="bibr" rid="pcbi.1002981-Feingersch1">[19]</xref>. We applied our method to analyze 44 samples from several metagenomics studies: we used different measures to calculate the similarity of samples, and our results show that the distance measure based on the probability of reactions leads to the most discriminating clustering of the samples. Notably, the functional variations among metagenomes from different environmental niches cannot be fully explained by their differences in taxonomic composition, because the clustering of these metagenomes based on their metabolic taxonomic composition is not as discriminating as our method. We also show detailed comparison of the samples from two ecosystems, to demonstrate that how the probabilities of reactions can help identify important metabolic pathways that reflect the environmental adaptation of the microbial communities.</p>
    </sec>
    <sec id="s2">
      <title>Results</title>
      <sec id="s2a">
        <title>Probabilistic Inference of Biochemical Reactions in Different Environments</title>
        <p>From the IMG/M metagenome repository <xref ref-type="bibr" rid="pcbi.1002981-Markowitz1">[2]</xref>, we downloaded 44 metagenomic datasets, which were acquired in 10 separate metagenomics studies of different host-associated or environmental ecosystems: human and animal gut, soil, ocean, freshwater and saline lake water (<xref ref-type="supplementary-material" rid="pcbi.1002981.s002">Table S1</xref>). All these studies were conducted by using Illumina sequencers with massive amount of reads acquired (short reads data file size ranging from 250 MB to over 200 GB). For each sample, IMG/M provides the assembled metagenome, and the protein-coding genes are characterized with additional functional annotations, such as KEGG ortholog groups of enzymes. Based on these identified KEGG ortholog groups and the KEGG reference metabolic pathways, we constructed a metagenome-scale annotated global metabolic network for each metagenomic sample. Note that these annotated global metabolic networks contain a similar number of multi-functional enzymes (<xref ref-type="supplementary-material" rid="pcbi.1002981.s002">Table S1</xref>). For each metabolic network, we applied the MCMC sampling method and computed the marginal probabilities of all annotated reactions. These probabilities can be used to compare the similarity of the microbial communities in the corresponding environments.</p>
      </sec>
      <sec id="s2b">
        <title>Clustering of Metagenomics Samples from Different Environments</title>
        <p>We clustered the 44 samples based on different similarity measures of their enzyme contents or metabolic reactions. Five types of measures were used to estimate the distance between the metagenomics samples and compare the clustering results (for details see <xref ref-type="sec" rid="s4">Methods</xref>): 1) the Bray-Curtis dissimilarity <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e001" xlink:type="simple"/></inline-formula> that compares the quantities of the metabolic enzymes encoded in each pair of the metagenomics samples; 2) the binary distance <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e002" xlink:type="simple"/></inline-formula> between the binary vectors representing the presence/absence of each enzyme in the metagenomes; 3) the binary distance <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e003" xlink:type="simple"/></inline-formula> between the binary vectors representing the presence/absence of each reaction in the annotated global metabolic network based on the naive annotation of enzymes; 4) the taxonomic distance <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e004" xlink:type="simple"/></inline-formula> based on the phylogenetic composition of the prokaryotes involved in metabolism; and 5) the Euclidean distance <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e005" xlink:type="simple"/></inline-formula> that compares the marginal probabilities of the reactions estimated by using the MCMC algorithm.</p>
        <p>The hierarchical clustering of the metagenomics samples (for details see Method) using the five distance measures are shown in <xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1</xref>. It is clear that the clusters created by using <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e006" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1 (b)</xref>) and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e007" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1 (e)</xref>) are more consistent with the actual environmental similarities than the ones using the other distance measures. Between these two, the clusters generated using <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e008" xlink:type="simple"/></inline-formula> are more accurate because it can separate all metagenomic samples based on their habitats while the other method failed to. Research has shown that lake water microbial communities are highly affected by inoculation of microbes from soils <xref ref-type="bibr" rid="pcbi.1002981-Crump1">[20]</xref>, therefore, soil samples and lake water samples are considered to be from similar environments in previous studies <xref ref-type="bibr" rid="pcbi.1002981-Mazel1">[21]</xref>. This correlates well with the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e009" xlink:type="simple"/></inline-formula>-based clustering result, in which the soil samples and lake water samples are intermixed in one large cluster (<xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1 (e)</xref>). <xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1 (d)</xref> shows that the taxonomic composition derived from the genes involved in metabolic pathways cannot discriminate the microbial communities to their habitat groups very well, which implies that the functional similarities of the metabolisms cannot be completely attributed to the taxonomic composition of the metagenomes. The poor outcome when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e010" xlink:type="simple"/></inline-formula> (enzyme quantities-based distance, <xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1 (a)</xref>) is used as the distance measure indicates that prudence should be taken when using the enzyme abundances estimated in metagenome assemblies as a measure of metabolism in the microbial communities, even though it is shown to be useful in comparing relative abundance of metabolic functions in addition to binary functional reconstructions <xref ref-type="bibr" rid="pcbi.1002981-Abubucker1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1002981-Liu1">[13]</xref>, <xref ref-type="bibr" rid="pcbi.1002981-Greenblum1">[14]</xref>. The poor performance of the clustering when the enzyme-coding genes are naively annotated to all the reactions (<xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1 (c)</xref>) confirms our proposition that the naively annotated metabolic network cannot reflect the nature of the metabolic adaptation of the microbial community to its environment. The clustering results show that by computing the likelihood of the reactions occurring in the metabolism, the adaptation of the metabolism that was hidden in the global metabolic network can be revealed. This leads to a more accurate assessment of the functional similarities among the metagenomic samples.</p>
        <fig id="pcbi-1002981-g001" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002981.g001</object-id>
          <label>Figure 1</label>
          <caption>
            <title>Hierarchical clustering of 44 IMG/M metagenomics samples represented in dendrograms.</title>
            <p>Five different distance measures of the metabolic patterns were used in the clustering. Sample taxon IDs are colored according to the metagenomics study. The environments of the samples are represented in shapes. (a) Clustering with distance measure <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e011" xlink:type="simple"/></inline-formula> based on quantities of metabolic enzymes; (b) Clustering with distance measure <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e012" xlink:type="simple"/></inline-formula> based on presence/absence of enzymes; (c) Clustering with distance measure <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e013" xlink:type="simple"/></inline-formula> based on presence/absence of reactions; (d) Clustering with distance measure <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e014" xlink:type="simple"/></inline-formula> based on the taxonomic compositions; (e) Clustering with distance measure <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e015" xlink:type="simple"/></inline-formula> based on the likelihood of metabolic reactions. See text for details about the distance measures.</p>
          </caption>
          <graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002981.g001" position="float" xlink:type="simple"/>
        </fig>
      </sec>
      <sec id="s2c">
        <title>Comparative Functional Analysis Based on Metabolic Reactions</title>
        <p>To investigate how the distance measure <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e016" xlink:type="simple"/></inline-formula> improved the clustering results compared to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e017" xlink:type="simple"/></inline-formula>, we focused our analysis on the metagenomic samples from two ecosystems: the permafrost soil samples from Alaska, and the saline lake water samples from an Antarctic deep lake. The first group of samples was collected from three different layers (two samples in each layer) in permafrost in the sediment of a creek in Alaska <xref ref-type="bibr" rid="pcbi.1002981-Mackelprang1">[22]</xref>. The second group of lake water samples was collected at six different depths ranging from 5 to 36 meters in Antarctic lakes <xref ref-type="bibr" rid="pcbi.1002981-Lauro1">[23]</xref>. Note that when using <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e018" xlink:type="simple"/></inline-formula> as the distance measure, 3 saline water samples were incorrectly grouped into the cluster of permafrost samples; but the distance measure <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e019" xlink:type="simple"/></inline-formula> can accurately separate the samples from the two environments (<xref ref-type="fig" rid="pcbi-1002981-g001">Figure 1, (c) and (e)</xref>).</p>
        <p>We used statistical tests to assess whether a metabolic reaction is differentially likely to occur in the two environments. Because the presence/absence of the reactions in the metabolic network is represented by a binary vector, we identified 110 reactions using the Fisher's exact test <xref ref-type="bibr" rid="pcbi.1002981-Fisher1">[24]</xref> that are statistically different (P-value<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e020" xlink:type="simple"/></inline-formula>0.05) in the two groups (for details see <xref ref-type="sec" rid="s4">Methods</xref>), indicating these reactions are likely to occur only in one of the two environments. We then used t-test to check if the marginal probability of each metabolic reaction is significantly different between the two groups. The t-test identified 447 reactions showing statistically different likelihoods to occur in the two environments (<xref ref-type="supplementary-material" rid="pcbi.1002981.s003">Table S2</xref>). The two tests agree on 109 reactions, and 338 reactions are considered to be different between these two sets of samples only by the t-test (<xref ref-type="fig" rid="pcbi-1002981-g002">Figure 2</xref>) on the likelihood of reactions, whereas only one reaction is detected as significantly different only by the Fisher's exact test.</p>
        <fig id="pcbi-1002981-g002" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002981.g002</object-id>
          <label>Figure 2</label>
          <caption>
            <title>Heatmap of the reactions found to differentially occur in Antarctic deep lake and permafrost samples only by the t-test on the marginal probabilities of reactions.</title>
            <p>338 reactions are shown in rows, and the 12 metagenomes are shown in columns. These reactions are not found to be different in the two environments if only their occurrences in the metabolic networks are compared. The two groups of metagenomics samples from two environments are separated in the clustering results. The 6 permafrost samples are grouped into 3 clusters correctly, with each cluster contains two samples from the same layer in the permafrost soil.</p>
          </caption>
          <graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002981.g002" position="float" xlink:type="simple"/>
        </fig>
        <p>Note that 166 of these 338 reactions are annotated to be catalyzed by one or more catalytically promiscuous enzymes in all of the metabolic networks (<xref ref-type="supplementary-material" rid="pcbi.1002981.s003">Table S2</xref>). In other words, there is no difference if we compare whether they exist (based on the annotation of genes) in the metabolic networks in both groups. However, the marginal probabilities of these reactions, which were assigned by the MCMC algorithm, are different among the two groups of samples, indicating these reactions show different likelihood to occur in the metabolism of the samples between the two groups. For example, one reaction in the Benzoate degradation pathway (KEGG reaction R06989) is observed in all 12 metabolic networks with different likelihoods in both environments; the reaction is on average 2.5-fold more likely to occur in the permafrost samples than in the lake water samples, if we compare their marginal probabilities (<xref ref-type="supplementary-material" rid="pcbi.1002981.s003">Table S2</xref>). This reaction is catalyzed by the enzyme muconate cycloisomerase (KEGG ortholog K01856), a promiscuous enzyme that also catalyzes four other reactions (<xref ref-type="fig" rid="pcbi-1002981-g003">Figure 3</xref>). All five reactions involve the isomerization of cis,cis-muconate and its derivatives (<xref ref-type="supplementary-material" rid="pcbi.1002981.s001">Figure S1</xref>). In particular, the reaction R06989, which is an important step in benzoate degradation, transforms cis,cis-muconate, which is enzymatically produced from catechol. The functions of benzoate and catechol metabolism are also found to be enriched in the permafrost microbial communities by other studies <xref ref-type="bibr" rid="pcbi.1002981-HinsaLeasure1">[25]</xref>. The results of the MCMC simulation show that the differences of the marginal probabilities of the other four reactions are much smaller compared to R06989. Also note that the probabilities of the five reactions are almost the same in the Antarctic lake samples, whereas, in the Alaska permafrost samples, the reaction that isomerize cis,cis-muconate (R06989) apparently has greater probabilities (<xref ref-type="fig" rid="pcbi-1002981-g003">Figure 3</xref>). This shows how the results of our method can be used to analyze the potential adaptation of the functions of promiscuous enzymes in different environments, which cannot be revealed when analyzing only the enzyme-encoding genes.</p>
        <fig id="pcbi-1002981-g003" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002981.g003</object-id>
          <label>Figure 3</label>
          <caption>
            <title>Probabilities of the 5 reactions catalyzed by muconate cycloisomerase (K01856).</title>
            <p>The difference of the probabilities of the reaction R06989 between the two groups is more significant than the other reactions.</p>
          </caption>
          <graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002981.g003" position="float" xlink:type="simple"/>
        </fig>
        <p>Another interesting observation is that the difference between the marginal probabilities of the 338 reactions can be used to correctly cluster the samples into two groups (<xref ref-type="fig" rid="pcbi-1002981-g002">Figure 2</xref>). In addition, if we focus on the samples extracted from Alaska permafrost, all 6 samples are correctly separated into three clusters, with each containing two samples from the same layer in the permafrost. This shows that those reactions only identified by comparing the estimated marginal probabilities contain the critical information in the metabolic adaptations of these samples to their environments.</p>
        <p>Among those 447 reactions that are identified to be different by the t-test on the marginal probability, 327 reactions show higher marginal probabilities to appear in the Alaska permafrost samples than in Antarctic deep lake samples. The remaining 120 reactions show lower probabilities in the Alaska permafrost samples than the Antarctic deep lake samples (<xref ref-type="supplementary-material" rid="pcbi.1002981.s003">Table S2</xref>). We built two networks using these two sets of reactions. In these networks, vertices represent the reactions, and a pair of reactions is connected by an edge if there are one or more common metabolites in the two reactions(<xref ref-type="fig" rid="pcbi-1002981-g004">Figure 4</xref>). The connected components in these networks represent <italic>chains</italic> of metabolic reactions that can be considered to have significant higher probabilities to occur in the environment of one group compared to the other.</p>
        <fig id="pcbi-1002981-g004" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002981.g004</object-id>
          <label>Figure 4</label>
          <caption>
            <title>Network of reactions that are different in the two environments.</title>
            <p>Each vertex represents a reaction. An edge is connected between two vertices if the two reactions share one or more metabolites. Square shaped vertices represent the reactions discovered to be different by using t-test on marginal probabilities, but not different when using the Fisher's test on the enzyme occurrences; Circle shaped vertices represent the reactions considered to be different in both statistical tests. (a) 327 reactions with higher marginal probabilities in Alaska permafrost samples; (b) 120 reactions with lower marginal probabilities in Alaska permafrost samples.</p>
          </caption>
          <graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002981.g004" position="float" xlink:type="simple"/>
        </fig>
        <p>Several interesting chains of reactions were revealed in both networks. For example, the chain R07916-R04786-R04787 (R07916, R04786, R04787 are KEGG reaction IDs) has a higher probability to occur in the metabolism of microbial communities from Antarctic deep lakes (<xref ref-type="fig" rid="pcbi-1002981-g005">Figure 5</xref>), which is a part of the beta-carotene biosynthesis module belonging to the carotenoid biosynthesis pathway. Carotenoids are essential metabolites for photosynthetic bacterial because they provide photo-protection and accessory light harvesting <xref ref-type="bibr" rid="pcbi.1002981-Cogdell1">[26]</xref>. The bacterial community in fresh water is known to carry out photosynthetic activities even in deep water. The Antarctic deep lake metagenomics study also revealed trace of photosynthetic microorganisms in their samples <xref ref-type="bibr" rid="pcbi.1002981-Lauro1">[23]</xref>. Therefore, it is not surprising to observe that photosynthesis related pathway modules have a higher likelihood to occur in the deep lake microbial communities than in the permafrost soil samples, which exist in an environment deprived of light. Several chains of reactions were found to have higher probabilities to occur in permafrost samples, among which were chains in methanogenesis, and keratan sulfate degradation. Slow rates of methanogenesis by cold-adapted methanogens occur in permafrost and active layer soils <xref ref-type="bibr" rid="pcbi.1002981-Mackelprang1">[22]</xref>, and keratan is regarded as a carbon source for certain bacteria isolated from soil <xref ref-type="bibr" rid="pcbi.1002981-Nakazawa1">[27]</xref>. Note that these chains all contain reactions that are identified only by comparing the reaction marginal probabilities but not the enzymes or the existence of reactions. Some chains even contain only reactions that are identified by comparing the reaction marginal probabilities (<xref ref-type="fig" rid="pcbi-1002981-g004">Figure 4</xref>). Therefore, our method successfully expands the horizon of discovering important pathways that contain critical information of the adaptive metabolism of microbes.</p>
        <fig id="pcbi-1002981-g005" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002981.g005</object-id>
          <label>Figure 5</label>
          <caption>
            <title>R07916-R04786-R04787 reaction chain.</title>
            <p>It is part of the beta-carotene biosynthesis module, and is observed to be different in the metagenomic samples from the two environments, Antarctic lakes and Alaska permafrost. (a) Reactions and metabolites. Values above the reaction boxes are the average marginal probabilities of the reactions in the two groups. Values under the reaction boxes are the p-values from the t-test. (b) The marginal probabilities of the reactions in different samples.</p>
          </caption>
          <graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002981.g005" position="float" xlink:type="simple"/>
        </fig>
      </sec>
    </sec>
    <sec id="s3">
      <title>Discussion</title>
      <p>In this paper, we focus on the analysis of metagenomics samples based on the metabolic reactions annotated to be catalyzed by the predicted genes in the metagenomes. We proposed a method that assigns marginal probabilities to reactions to estimate the likelihood of the reactions to occur in the metabolism of a microbial community. The Markov Chain Monte Carlo (MCMC) sampling algorithm establishes a framework that can be used to study the different aspects of metabolic networks. The subnetwork universe can be sampled by the MCMC algorithm with different constraints based on various assumptions. For example, in recent work, flux balance analysis (FBA) is used to constrain the viability of the sampled genome-scale metabolic networks in a MCMC based method <xref ref-type="bibr" rid="pcbi.1002981-Samal1">[28]</xref>.</p>
      <p>The marginal probabilities are assigned by our method to reactions that are catalyzed by catalytically promiscuous enzymes. As shown in the results, the reactions occurring in a microbial community are a better representation of the metabolism in the community, because one reaction may be catalyzed by different enzymes encoded by different microbial organisms in the community. An extension of this method is to compare the likelihood of the reactions to be catalyzed by the same enzyme and allow us to investigate how promiscuous enzymes function in different environments.</p>
      <p>By applying the parsimony assumption, our method successfully takes several intrinsic properties of the metabolic network into consideration. It should be noted that this method indirectly favors highly connected metabolic networks, where the number of non-terminal metabolites that can be produced and consumed by the microbial community is maximized. Similar assumptions have been used in other studies. For example, in the metabolic network reconstruction, gaps in metabolic paths are usually filled to decrease the number of isolated reactions or metabolites <xref ref-type="bibr" rid="pcbi.1002981-Feist1">[29]</xref>. Notably, this assumption is particularly practical for the study of the metabolism in a microbial community rather than individual microbial organisms, because the microbes living in the same environment likely co-evolved into a condition under which microbes can make use of the metabolites from other microbes and only a small number of metabolites are required from the external environment by the whole community.</p>
      <p>We note that our method lacks the compartmentalization of the biochemical reactions and the resolution of individual species. In previous studies, multi-species models have been applied to investigate the interactions within the community or between host and microbiomes <xref ref-type="bibr" rid="pcbi.1002981-Trosvik1">[30]</xref>. In comparison, when studying the system-level behavior of the whole microbial communities, researchers often treat the microbial communities as individual adaptive organisms (also referred as <italic>supra-organism</italic>), ignoring the boundaries between species altogether <xref ref-type="bibr" rid="pcbi.1002981-Greenblum1">[14]</xref>, <xref ref-type="bibr" rid="pcbi.1002981-Gordon1">[31]</xref>, <xref ref-type="bibr" rid="pcbi.1002981-Borenstein1">[32]</xref>. In this study, we take a similar approach, which allows us to investigate the collective metabolic behavior of the microbial communities. This approach is also a necessity because genomic information is not available for all the species in the community and methods for decomposing complex metagenomic samples into compartmentalized organelles/prokaryotic cells are yet to be developed.</p>
      <p>There are, however, several limitations of the method that are worth noting. In our metabolic network definition, the reactions are considered to be indirect, which indicate that all reactions are reversible. However, conditions in the cell are often such that it is thermodynamically infeasible for flux of reactions to flow in certain direction so the reaction becomes irreversible. Therefore, there might be <italic>dead-end metabolites</italic> in the network, the metabolites that are not the product of the other reactions or are not used by other reactions as substrates. In our model, they are misinterpreted as the metabolites that connect two reactions, which could decrease the accuracy of the reaction and pathway annotated by our method. Another issue is that this method does not consider the abundance of enzymes predicted from the metagenomic sequences. We observed large variance in the abundance of the same enzyme among samples as well as pairs of enzymes that share same metabolites as substrates or products. We are working on a revision of our current method to take the abundance of enzymes into account.</p>
    </sec>
    <sec id="s4" sec-type="methods">
      <title>Methods</title>
      <sec id="s4a">
        <title>Problem Formulation</title>
        <p>We start the problem formulation with a formal definition of a metabolic network.</p>
        <sec id="s4a1">
          <title>Definition 1</title>
          <p><italic>A reference metabolic network is a labeled undirected graph</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e021" xlink:type="simple"/></inline-formula> <italic>where</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e022" xlink:type="simple"/></inline-formula> <italic>represents a set of</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e023" xlink:type="simple"/></inline-formula> <italic>vertices, each labeled by a metabolite (compound), and</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e024" xlink:type="simple"/></inline-formula> <italic>represents a set of</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e025" xlink:type="simple"/></inline-formula> <italic>edges, each labeled by a biochemical reaction. The graph topology is represented in a matrix form</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e026" xlink:type="simple"/></inline-formula>,<disp-formula id="pcbi.1002981.e027"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1002981.e027" xlink:type="simple"/></disp-formula></p>
          <p>We then annotate the enzymes corresponding to the predicted genes in a metagenomic dataset on the reference metabolic network (in the database such as the KEGG <xref ref-type="bibr" rid="pcbi.1002981-Kanehisa1">[6]</xref>), and define the <italic>annotated global metabolic network</italic> as follows.</p>
        </sec>
        <sec id="s4a2">
          <title>Definition 2</title>
          <p><italic>Considering the set of</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e028" xlink:type="simple"/></inline-formula> <italic>metabolic enzymes annotated in a metagenome as</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e029" xlink:type="simple"/></inline-formula>, <italic>the reactions in the reference network that are annotated by enzymes are represented as a matrix</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e030" xlink:type="simple"/></inline-formula><disp-formula id="pcbi.1002981.e031"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1002981.e031" xlink:type="simple"/></disp-formula></p>
          <p><italic>We call</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e032" xlink:type="simple"/></inline-formula> an annotated global metabolic network <italic>of the metagenome</italic>.</p>
          <p>In the annotated metabolic network, each reaction is annotated to be catalyzed by one or more enzyme, whereas each enzyme is <italic>naively</italic> annotated with all of its putative catalytic functions. The annotated metabolic network provides a global view of the metabolic activities encoded in a metagenome. Note that in an annotated network, there are usually a substantial number of catalytically promiscuous enzymes that are annotated to catalyze more than one reaction. The promiscuity of the enzymes is due to the factors such as the environmental conditions such as pH and temperature, and under certain circumstances, a promiscuous enzyme more likely catalyzes one of its annotated reaction than the others <xref ref-type="bibr" rid="pcbi.1002981-Nobeli1">[17]</xref>. Altogether, the annotated global metabolic network represents the universe of all metabolic profiles; but it does not reflect the adapted metabolism to certain environmental conditions because all functions of the promiscuous enzymes are considered to occur equally likely.</p>
          <p>Below we introduce the concept of a subnetwork of the annotated global metabolic network as a representation of one putative metabolic profile of the metagenome. A subnetwork consists of a subset of reactions, metabolites and enzymes from the global network; a subnetwork is defined as <italic>valid</italic> if each predicted enzyme is annotated to catalyze at least one reaction in the subnetwork. Their formal definitions are given as follows:</p>
        </sec>
        <sec id="s4a3">
          <title>Definition 3</title>
          <p><italic>Given the annotation</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e033" xlink:type="simple"/></inline-formula> <italic>on a gene set</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e034" xlink:type="simple"/></inline-formula> <italic>in an annotated metabolic network</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e035" xlink:type="simple"/></inline-formula>, <italic>we define an annotated metabolic subnetwork</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e036" xlink:type="simple"/></inline-formula>, <italic>where</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e037" xlink:type="simple"/></inline-formula> <italic>is a subgraph of the metabolic network</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e038" xlink:type="simple"/></inline-formula> <italic>(i.e.,</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e039" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e040" xlink:type="simple"/></inline-formula>, <italic>and</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e041" xlink:type="simple"/></inline-formula> <italic>is a submatrix of</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e042" xlink:type="simple"/></inline-formula><italic>),</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e043" xlink:type="simple"/></inline-formula>, <italic>and</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e044" xlink:type="simple"/></inline-formula> <italic>is a submatrix of</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e045" xlink:type="simple"/></inline-formula>.</p>
        </sec>
        <sec id="s4a4">
          <title>Definition 4</title>
          <p><italic>An annotated metabolic subnetwork</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e046" xlink:type="simple"/></inline-formula> <italic>of a annotated global metabolic network</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e047" xlink:type="simple"/></inline-formula> <italic>is called valid, if</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e048" xlink:type="simple"/></inline-formula></p>
          <p>The set of valid subnetworks from an annotated global metabolic network constitutes the universe of <italic>valid subnetworks</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e049" xlink:type="simple"/></inline-formula>. Within the scope of our study, the probability of a subnetwork in the universe <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e050" xlink:type="simple"/></inline-formula> is the likelihood of the subnetwork to represent the real metabolism of the metagenome, denoted as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e051" xlink:type="simple"/></inline-formula>. Assuming the probability distribution of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e052" xlink:type="simple"/></inline-formula> is known, we can calculate the marginal probability of each reaction given the annotated global metabolic network <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e053" xlink:type="simple"/></inline-formula> based on the Bayes' theorem (<xref ref-type="disp-formula" rid="pcbi.1002981.e054">equation (1)</xref>):<disp-formula id="pcbi.1002981.e054"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1002981.e054" xlink:type="simple"/><label>(1)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e055" xlink:type="simple"/></inline-formula> is the probability of a reaction <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e056" xlink:type="simple"/></inline-formula> to occur in the subnetwork. Because the configuration of the subnetwork is already known, it can be represented as an indicator function,<disp-formula id="pcbi.1002981.e057"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1002981.e057" xlink:type="simple"/></disp-formula></p>
          <p>Due to the complexity of metabolic networks, it is intractable to compute <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e058" xlink:type="simple"/></inline-formula>, because the subnetwork universe is huge – the total number of potential subnetworks is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e059" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e060" xlink:type="simple"/></inline-formula> is the number of enzymes in the annotated global metabolic network, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e061" xlink:type="simple"/></inline-formula> is the total number of reactions that enzyme <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e062" xlink:type="simple"/></inline-formula> catalyze. Given the number of multi-functional enzymes that an annotated global metabolic network contains, it's not tractable to enumerate all potential subnetworks to compute <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e063" xlink:type="simple"/></inline-formula>. Here, we resort to a Markov Chain Monte Carlo (MCMC) algorithm to sample subnetworks from the subnetwork universe <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e064" xlink:type="simple"/></inline-formula>, and compute the marginal probabilities based on the subnetwork samples.</p>
        </sec>
      </sec>
      <sec id="s4b">
        <title>The Parsimony Assumption and Inequality of the Likelihood of Metabolic Subnetworks</title>
        <p>Before we discuss the details of the MCMC algorithm, we introduce an inequality of likelihood of the metabolic subnetworks based on a parsimony assumption. We observe that within microbial communities, metabolic enzymes work collectively to catalyze a series of reactions to transform some compounds that are available in their living environment into other compounds that can be utilized to maintain their cellular functions. Although the enzymes act on different substrates and products, the products of some reactions are usually used as substrates in the subsequent reactions, resulting in a sequence of reactions devising the complex but efficient metabolic network. The adaption of a living microbial organism to its living environment often leads to a unique and nearly optimal metabolic network, in which only a small number of <italic>necessary</italic> compounds need to be taken from its environment, while the other compounds can be synthesized through metabolic reactions inside the microbial community. Based on these observations, we adopt a parsimony assumption: the valid subnetworks involving fewer compounds are more likely to represent the metabolism of the microbial community.</p>
        <p>Equivalently, given two valid subnetworks <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e065" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e066" xlink:type="simple"/></inline-formula> of the same annotated global network <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e067" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e068" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e069" xlink:type="simple"/></inline-formula>, if<disp-formula id="pcbi.1002981.e070"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1002981.e070" xlink:type="simple"/></disp-formula>then<disp-formula id="pcbi.1002981.e071"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1002981.e071" xlink:type="simple"/><label>(2)</label></disp-formula></p>
      </sec>
      <sec id="s4c">
        <title>Markov Chain Monte Carlo (MCMC) Sampling Based on the Parsimony Assumption</title>
        <p>We construct a Markov Chain (MC) of annotated subnetworks to sample the valid annotated metabolic subnetwork in the universe <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e072" xlink:type="simple"/></inline-formula> and estimate the marginal probabilities of reactions. At each step of the random MC walk, a new metabolic subnetwork is generated by inserting a new reaction to the current subnetwork, or by deleting an existing reaction from the current subnetwork. We repeat the insertion/deletion until a valid new subnetwork is generated. The transition from the current subnetwork to a new valid subnetwork is accepted or rejected based on the parsimony inequality in <xref ref-type="disp-formula" rid="pcbi.1002981.e071">equation (2)</xref>. If the number of metabolites found in the new subnetwork is smaller than the number of metabolites in the current subnetwork, we accept the transition to the new subnetwork; otherwise, we accept the transition with a probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e073" xlink:type="simple"/></inline-formula> (called the <italic>candidate probability</italic>), where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e074" xlink:type="simple"/></inline-formula> is the difference between the number of metabolites in the new and the current subnetwork.</p>
        <p>It is straightforward to show that this type of transition is <italic>ergodic</italic>, <italic>i.e.</italic>, any pair of subnetworks can be connected by a finite series of such transitions. The candidate probability ensures that the random walk samples the subnetworks based on the parsimony assumption, as defined in <xref ref-type="disp-formula" rid="pcbi.1002981.e071">equation (2)</xref>. According to the Metropolis-Hastings rule <xref ref-type="bibr" rid="pcbi.1002981-Hastings1">[33]</xref>, the candidate probability also ensures the subnetwork samples are drawn from a probability distribution that is proportional to the likelihood of the subnetwork in the subnetwork universe <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e075" xlink:type="simple"/></inline-formula>.</p>
        <p>The number of variables we are trying to estimate equals the number of reactions that are catalyzed by promiscuous enzymes. Metabolic networks constructed from metagenomic data normally contain hundreds of such reactions. Here we discuss several methodological issues of the Markov chain caused by the large number of variables in the sampling universe. First, every step in the random walk only changes the state of at most one reaction, therefore, the correlation between the two consecutive sampled subnetworks is obviously large. We use the <italic>subsampling</italic> (also called <italic>batch sampling</italic>) technique to reduce the correlation and to approximate independence between the successive samples of the Markov chain <xref ref-type="bibr" rid="pcbi.1002981-Robert1">[18]</xref>. We subsample from the Markov chain with a deterministic batch size <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e076" xlink:type="simple"/></inline-formula>, meaning that we consider only one subnetwork from every <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e077" xlink:type="simple"/></inline-formula> sampled subnetworks. As shown in <xref ref-type="fig" rid="pcbi-1002981-g006">Figure 6 (a)</xref>, when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e078" xlink:type="simple"/></inline-formula> for a network containing 362 promiscuous enzymes (1183 enzymes in total), subsampling almost completely eliminates the correlation of successive sampled subnetworks. Another issue is the acceptance rate of the transitions in the Markov chain, which is the ratio of the number of accepted transitions from the current subnetwork to the new subnetwork, over the number of proposed transitions. This ratio was shown to affect the convergence pattern of the Markov chain <xref ref-type="bibr" rid="pcbi.1002981-Robert1">[18]</xref>, and it's heuristically recommended to be controlled to close to 1/4 for models with high dimensions <xref ref-type="bibr" rid="pcbi.1002981-Roberts1">[34]</xref>. The acceptance rate is affected by the candidate distribution, which in our model has the exponential distribution form <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e079" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e080" xlink:type="simple"/></inline-formula> is the difference between the number of metabolites in the new subnetwork and the current subnetwork. We choose the candidate distribution in this form because it can restrict the acceptance rate of our random walk approximately within the range of 0.20 to 0.24. Note that because we only sample the valid subnetworks, the rejected invalid subnetworks in our algorithm (<xref ref-type="fig" rid="pcbi-1002981-g007">Figure 7</xref>) are not counted when calculating the acceptance rate. Furthermore, it requires a large number of samples from the subnetwork universe <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e081" xlink:type="simple"/></inline-formula> for an accurate estimation of the marginal probability. This, in addition to the requirement of subsampling to avoid high correlation between the samples, requires a careful monitoring of the convergence of the Markov chain. We examine the ergodic average of the estimated marginal probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e082" xlink:type="simple"/></inline-formula> for all reaction <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e083" xlink:type="simple"/></inline-formula> in a metabolic network of 609 reactions that are catalyzed by multi-functional enzymes, and heuristically determine that with subsampling of batch size <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e084" xlink:type="simple"/></inline-formula>, the Markov chain converges after 10,000 subnetworks are sampled (<xref ref-type="fig" rid="pcbi-1002981-g006">Figure 6 (b)</xref>). To improve the convergence of our Markov chain, in practice, we choose to discard samples from the first 10 million steps of the Markov chain, <italic>i.e.</italic>, the <italic>burn-in period</italic>, to make the random walk to start from a better point in the subnetwork probability space <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e085" xlink:type="simple"/></inline-formula>. Last but not least, because of the requirements of large batch size in subsampling, low acceptance rate, and large amount of samples, the running time of the Markov chain requires special examination. We find that when we control all these factors, the running time is linearly correlated to the number of reactions in the subnetwork, or in some sense the size of the subnetwork (<xref ref-type="fig" rid="pcbi-1002981-g006">Figure 6 (c)</xref>). For a large network with over 1,200 reactions, of which more than 600 are catalyzed by multi-functional enzymes, the algorithm can finish 250 million iterations in approximately 10 hours.</p>
        <fig id="pcbi-1002981-g006" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002981.g006</object-id>
          <label>Figure 6</label>
          <caption>
            <title>Properties of the Markov chain.</title>
            <p>(a) Correlations of the probability of reaction in consecutive subnetworks sampled from the Markov chain. As the batch size in subsampling increases, the correlation decreases and become insignificant (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e086" xlink:type="simple"/></inline-formula>0.1) for most reactions when batch size is set to 10,000. (b) Ergodic averages of the marginal probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e087" xlink:type="simple"/></inline-formula> for all reactions catalyzed by promiscuous enzymes in a metagenome. (subsampling with batch size = 10,000) (c) Running time of the Markov chain of global metabolic networks of various sizes for 250 million iterations. Top are the total numbers of reactions in each sample. Bottom are the numbers of reactions that are catalyzed by catalytically promiscuous enzymes.</p>
          </caption>
          <graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002981.g006" position="float" xlink:type="simple"/>
        </fig>
        <fig id="pcbi-1002981-g007" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002981.g007</object-id>
          <label>Figure 7</label>
          <caption>
            <title>Metropolis-Hastings Algorithm.</title>
          </caption>
          <graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002981.g007" position="float" xlink:type="simple"/>
        </fig>
        <p>The formal Metropolis-Hastings algorithm is shown in <xref ref-type="fig" rid="pcbi-1002981-g007">Figure 7</xref>.</p>
        <p>After sampling, we can compute the estimated marginal probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e088" xlink:type="simple"/></inline-formula> by<disp-formula id="pcbi.1002981.e089"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1002981.e089" xlink:type="simple"/><label>(3)</label></disp-formula>for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e090" xlink:type="simple"/></inline-formula> such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e091" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e092" xlink:type="simple"/></inline-formula> is the total number of sampled valid subnetworks.</p>
        <p>In addition to the marginal probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e093" xlink:type="simple"/></inline-formula>, we can also extract a subnetwork sample with the maximum likelihood in the samples, which is the subnetwork with the smallest number of compounds.</p>
      </sec>
      <sec id="s4d">
        <title>Distance Measures, Clustering Algorithm and Statistical Tests</title>
        <p>For any pair of metagenomes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e094" xlink:type="simple"/></inline-formula>, the Bray-Curtis dissimilarity is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e095" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e096" xlink:type="simple"/></inline-formula> is the sum of the lesser value for only those enzymes in common in both samples. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e097" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e098" xlink:type="simple"/></inline-formula> are the total number of enzymes counted in both samples <xref ref-type="bibr" rid="pcbi.1002981-Bray1">[35]</xref>. In this paper, this distance is denoted as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e099" xlink:type="simple"/></inline-formula>. The quantities of enzymes in each metagenomic dataset were obtained from IMG/M, computed based on the number of assembled contigs aligned to each family of enzymes. The Jaccard distance is used to estimate the binary distance of the samples, based on enzymes (denoted as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e100" xlink:type="simple"/></inline-formula>) and reactions (denoted as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e101" xlink:type="simple"/></inline-formula>). We also computed the Euclidean distance of reactions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e102" xlink:type="simple"/></inline-formula>, which is based on the marginal probabilities of the reactions.</p>
        <p>The taxonomic distances, denoted as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e103" xlink:type="simple"/></inline-formula> were calculated in several steps: for each metagenome downloaded from IMG/M, to ensure the comparison is based on the organisms involved in the collective metabolic processes, we removed the genes that are not annotated with a metabolic function in the IMG/M KEGG ortholog group annotations. Then we used BLAST (version 2.1.18) to search the genes against the KEGG genes database (E-value <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e104" xlink:type="simple"/></inline-formula>). From the BLAST results, we built a phylogenetic tree by gathering the genome of the top hits and mapping them to the Greengenes core set <xref ref-type="bibr" rid="pcbi.1002981-DeSantis1">[36]</xref>. Using the phylogenetic trees, we calculated the pairwise taxonomic distances between samples with unweighted Fast UniFrac method <xref ref-type="bibr" rid="pcbi.1002981-Lozupone1">[37]</xref>, <xref ref-type="bibr" rid="pcbi.1002981-Hamady1">[38]</xref> (PyCogent <xref ref-type="bibr" rid="pcbi.1002981-Knight1">[39]</xref> version 1.5.3), a metric that measures the phylogenetic relatedness of whole communities and has been widely applied in studies to compare taxonomic differences between complex microbial communities <xref ref-type="bibr" rid="pcbi.1002981-Lozupone2">[40]</xref>.</p>
        <p>We used the Ward's minimum variance method as the linkage criteria in our hierarchical clustering, which tries to minimize the total within-cluster variance. Note that when applying other common linkage criteria in the hierarchical clustering, even though the performance varies, the order of performances using the four distance measure was still observed.</p>
        <p>Fisher's exact test <xref ref-type="bibr" rid="pcbi.1002981-Fisher1">[24]</xref> is used to determine if there are nonrandom associations between two binary variables. For each reaction, we used Fisher's test to compare its presence/absence in the two groups of samples from the two environments. The p-value gives the exact probability of observing the particular ratio of the presence/absence of the reaction in the samples from the two environments, on the null hypothesis that the chances of the reaction to exist in both environments are the same. We consider reactions with p-value<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e105" xlink:type="simple"/></inline-formula>0.05 as ones that have significant different probability to be found in the two environments. We also used Fisher's test in comparing the binary representation of each enzyme in the two environments.</p>
        <p>We used the independent two-sample t-test to determine whether the quantities of enzymes are statistically different in two environments under the assumptions that these quantities are independent and normally distributed, and the distributions of the quantities in the two groups of samples have the same variance. So for each enzyme, we consider its quantities in samples in the two environments as two groups of values, and the t-statistic determines whether the means of the two groups of values are different. Similarly, we also used t-test for analyzing whether each reaction has a different probability in the two environments.</p>
      </sec>
      <sec id="s4e">
        <title>Implementation of MCMC Sampling</title>
        <p>The MCMC sampler of metabolic networks is implemented in Java, and based on the HYDRA MCMC library <xref ref-type="bibr" rid="pcbi.1002981-Warnes1">[41]</xref>. Running time of the program is dependent on the size of the network and the configuration of the MCMC sampler, including the subsampling size and burn-in period (<xref ref-type="fig" rid="pcbi-1002981-g006">Figure 6</xref>). For a large network with about 2,500 reactions, the sampling takes approximately 10 hours on a dual core Dell Latitude laptop, and requires a small amount of memory (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1002981.e106" xlink:type="simple"/></inline-formula>50 MB). Source codes can be downloaded at <ext-link ext-link-type="uri" xlink:href="http://omics.informatics.indiana.edu/mg/MetaNetSam/" xlink:type="simple">http://omics.informatics.indiana.edu/mg/MetaNetSam/</ext-link>.</p>
      </sec>
    </sec>
    <sec id="s5">
      <title>Supporting Information</title>
      <supplementary-material id="pcbi.1002981.s001" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1002981.s001" position="float" xlink:type="simple">
        <label>Figure S1</label>
        <caption>
          <p><bold>Reactions catalyzed by muconate cycloisomerase (KEGG Orothlog K01856).</bold> All five reactions are found in all samples in the metagenomics samples from the Antarctic deep lake and Alaska permafrost studies. KEGG reactions: (a) R05300; (b) R05390; (c) R06989; (d) R08116; (e) R09229.</p>
          <p>(PDF)</p>
        </caption>
      </supplementary-material>
      <supplementary-material id="pcbi.1002981.s002" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1002981.s002" position="float" xlink:type="simple">
        <label>Table S1</label>
        <caption>
          <p><bold>IMG/M metagenomics samples used in our study.</bold> Data were downloaded on 4/10/2012.</p>
          <p>(PDF)</p>
        </caption>
      </supplementary-material>
      <supplementary-material id="pcbi.1002981.s003" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1002981.s003" position="float" xlink:type="simple">
        <label>Table S2</label>
        <caption>
          <p><bold>Reactions in Antarctic deep lake and Alaska permafrost samples.</bold> The first p-value is from the Fisher's test that checks if the occurrences of the reactions in the two groups of samples are different. This p-value equaling 1 means the reaction occurs in all the samples in the two groups. The second p-value is the t-test based on the marginal probability of the reactions. The last two columns are the average marginal probabilities of the reactions in the two groups of samples.</p>
          <p>(PDF)</p>
        </caption>
      </supplementary-material>
    </sec>
  </body>
  <back>
    <ref-list>
      <title>References</title>
      <ref id="pcbi.1002981-NIH1">
        <label>1</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><collab xlink:type="simple">NIH HMP Working Group</collab> (<year>2009</year>) <name name-style="western"><surname>Peterson</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Garges</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Giovanni</surname><given-names>M</given-names></name>, <name name-style="western"><surname>McInnes</surname><given-names>P</given-names></name>, <etal>et al</etal>. (<year>2009</year>) <article-title>The NIH Human Microbiome Project</article-title>. <source>Genome Res</source> <volume>19</volume>: <fpage>2317</fpage>–<lpage>2323</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Markowitz1">
        <label>2</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Markowitz</surname><given-names>VM</given-names></name>, <name name-style="western"><surname>Chen</surname><given-names>IMA</given-names></name>, <name name-style="western"><surname>Chu</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Szeto</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Palaniappan</surname><given-names>K</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>IMG/M: the integrated metagenome data management and comparative analysis system</article-title>. <source>Nucleic Acids Res</source> <volume>40</volume>: <fpage>D123</fpage>–<lpage>D129</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Altschul1">
        <label>3</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Altschul</surname><given-names>SF</given-names></name>, <name name-style="western"><surname>Gish</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Miller</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Myers</surname><given-names>EW</given-names></name>, <name name-style="western"><surname>Lipman</surname><given-names>DJ</given-names></name> (<year>1990</year>) <article-title>Basic local alignment search tool</article-title>. <source>J Mol Biol</source> <volume>215</volume>: <fpage>403</fpage>–<lpage>410</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Kent1">
        <label>4</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kent</surname><given-names>WJ</given-names></name> (<year>2002</year>) <article-title>BLAT–the BLAST-like alignment tool</article-title>. <source>Genome Res</source> <volume>12</volume>: <fpage>656</fpage>–<lpage>664</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Ye1">
        <label>5</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ye</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Choi</surname><given-names>JH</given-names></name>, <name name-style="western"><surname>Tang</surname><given-names>H</given-names></name> (<year>2011</year>) <article-title>RAPSearch: a fast protein similarity search tool for short reads</article-title>. <source>BMC Bioinformatics</source> <volume>12</volume>: <fpage>159</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Kanehisa1">
        <label>6</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kanehisa</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Goto</surname><given-names>S</given-names></name> (<year>2000</year>) <article-title>KEGG: kyoto encyclopedia of genes and genomes</article-title>. <source>Nucleic Acids Res</source> <volume>28</volume>: <fpage>27</fpage>–<lpage>30</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Caspi1">
        <label>7</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Caspi</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Foerster</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Fulcher</surname><given-names>CA</given-names></name>, <name name-style="western"><surname>Hopkinson</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Ingraham</surname><given-names>J</given-names></name>, <etal>et al</etal>. (<year>2006</year>) <article-title>MetaCyc: a multiorganism database of metabolic pathways and enzymes</article-title>. <source>Nucleic Acids Res</source> <volume>34</volume>: <fpage>D511</fpage>–<lpage>D516</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Overbeek1">
        <label>8</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Overbeek</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Begley</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Butler</surname><given-names>RM</given-names></name>, <name name-style="western"><surname>Choudhuri</surname><given-names>JV</given-names></name>, <name name-style="western"><surname>Chuang</surname><given-names>HY</given-names></name>, <etal>et al</etal>. (<year>2005</year>) <article-title>The subsystems approach to genome annotation and its use in the project to annotate 1000 genomes</article-title>. <source>Nucleic Acids Res</source> <volume>33</volume>: <fpage>5691</fpage>–<lpage>5702</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Abubucker1">
        <label>9</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Abubucker</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Segata</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Goll</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Schubert</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Izard</surname><given-names>J</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Metabolic Reconstruction for Metagenomic Data and Its Application to the Human Microbiome</article-title>. <source>PLoS Comput Biol</source> <volume>8</volume>: <fpage>e1002358</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Meyer1">
        <label>10</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Meyer</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Paarmann</surname><given-names>D</given-names></name>, <name name-style="western"><surname>D'Souza</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Olson</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Glass</surname><given-names>EM</given-names></name>, <etal>et al</etal>. (<year>2008</year>) <article-title>The metagenomics RAST server - a public resource for the automatic phylogenetic and functional analysis of metagenomes</article-title>. <source>BMC Bioinformatics</source> <volume>9</volume>: <fpage>386</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Gianoulis1">
        <label>11</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gianoulis</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Raes</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Patel</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Bjornson</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Korbel</surname><given-names>J</given-names></name>, <etal>et al</etal>. (<year>2009</year>) <article-title>Quantifying environmental adaptation of metabolic pathways in metagenomics</article-title>. <source>Proc Natl Acad Sci</source> <volume>106</volume>: <fpage>1374</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-DeLong1">
        <label>12</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>DeLong</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Preston</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Mincer</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Rich</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Hallam</surname><given-names>S</given-names></name>, <etal>et al</etal>. (<year>2006</year>) <article-title>Community genomics among stratified microbial assemblages in the ocean's interior</article-title>. <source>Science</source> <volume>311</volume>: <fpage>496</fpage>–<lpage>503</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Liu1">
        <label>13</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Liu</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Pop</surname><given-names>M</given-names></name> (<year>2011</year>) <article-title>MetaPath: identifying differentially abundant metabolic pathways in metagenomic datasets</article-title>. <source>BMC Proc</source> <volume>5</volume><supplement>Suppl 2</supplement>: <fpage>S9</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Greenblum1">
        <label>14</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Greenblum</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Turnbaugh</surname><given-names>PJ</given-names></name>, <name name-style="western"><surname>Borenstein</surname><given-names>E</given-names></name> (<year>2012</year>) <article-title>Metagenomic systems biology of the human gut microbiome reveals topological shifts associated with obesity and inflammatory bowel disease</article-title>. <source>Proc Natl Acad Sci</source> <volume>109</volume>: <fpage>594</fpage>–<lpage>599</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Sharon1">
        <label>15</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sharon</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Bercovici</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Pinter</surname><given-names>RY</given-names></name>, <name name-style="western"><surname>Shlomi</surname><given-names>T</given-names></name> (<year>2011</year>) <article-title>Pathway-based functional analysis of metagenomes</article-title>. <source>J Comput Biol</source> <volume>18</volume>: <fpage>495</fpage>–<lpage>505</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Ye2">
        <label>16</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ye</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Doak</surname><given-names>T</given-names></name> (<year>2009</year>) <article-title>A parsimony approach to biological pathway reconstruction/inference for genomes and metagenomes</article-title>. <source>PLoS Comput Biol</source> <volume>5</volume>: <fpage>e1000465</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Nobeli1">
        <label>17</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Nobeli</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Favia</surname><given-names>AD</given-names></name>, <name name-style="western"><surname>Thornton</surname><given-names>JM</given-names></name> (<year>2009</year>) <article-title>Protein promiscuity and its implications for biotechnology</article-title>. <source>Nat Biotechnol</source> <volume>27</volume>: <fpage>157</fpage>–<lpage>167</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Robert1">
        <label>18</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Robert</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Casella</surname><given-names>G</given-names></name> (<year>2004</year>) <article-title>Monte Carlo statistical methods</article-title>. <source>Springer Verlag</source></mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Feingersch1">
        <label>19</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Feingersch</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Suzuki</surname><given-names>MT</given-names></name>, <name name-style="western"><surname>Shmoish</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Sharon</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Sabehi</surname><given-names>G</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Microbial community genomics in eastern Mediterranean Sea surface waters</article-title>. <source>ISME J</source> <volume>4</volume>: <fpage>78</fpage>–<lpage>87</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Crump1">
        <label>20</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Crump</surname><given-names>BC</given-names></name>, <name name-style="western"><surname>Amaral-Zettler</surname><given-names>LA</given-names></name>, <name name-style="western"><surname>Kling</surname><given-names>GW</given-names></name> (<year>2012</year>) <article-title>Microbial diversity in arctic freshwaters is structured by inoculation of microbes from soils</article-title>. <source>ISME J</source> <volume>6</volume>: <fpage>1751</fpage>–<lpage>7370</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Mazel1">
        <label>21</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mazel</surname><given-names>D</given-names></name> (<year>2006</year>) <article-title>Integrons: agents of bacterial evolution</article-title>. <source>Nat Rev Microbiol</source> <volume>4</volume>: <fpage>608</fpage>–<lpage>620</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Mackelprang1">
        <label>22</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mackelprang</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Waldrop</surname><given-names>MP</given-names></name>, <name name-style="western"><surname>DeAngelis</surname><given-names>KM</given-names></name>, <name name-style="western"><surname>David</surname><given-names>MM</given-names></name>, <name name-style="western"><surname>Chavarria</surname><given-names>KL</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Metagenomic analysis of a permafrost microbial community reveals a rapid response to thaw</article-title>. <source>Nature</source> <volume>480</volume>: <fpage>368</fpage>–<lpage>371</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Lauro1">
        <label>23</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lauro</surname><given-names>FM</given-names></name>, <name name-style="western"><surname>DeMaere</surname><given-names>MZ</given-names></name>, <name name-style="western"><surname>Yau</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>MV</given-names></name>, <name name-style="western"><surname>Ng</surname><given-names>C</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>An integrative study of a meromictic lake ecosystem in Antarctica</article-title>. <source>ISME J</source> <volume>5</volume>: <fpage>879</fpage>–<lpage>895</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Fisher1">
        <label>24</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Fisher</surname><given-names>R</given-names></name> (<year>1922</year>) <article-title>On the interpretation of <italic>χ</italic><sup>2</sup> from contingency tables, and the calculation of P</article-title>. <source>J R Stat Soc Ser</source> <volume>85</volume>: <fpage>87</fpage>–<lpage>94</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-HinsaLeasure1">
        <label>25</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hinsa-Leasure</surname><given-names>SM</given-names></name>, <name name-style="western"><surname>Bhavaraju</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Rodrigues</surname><given-names>JLM</given-names></name>, <name name-style="western"><surname>Bakermans</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Gilichinsky</surname><given-names>DA</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Characterization of a bacterial community from a Northeast Siberian seacoast permafrost sample</article-title>. <source>FEMS Microbiol Ecol</source> <volume>74</volume>: <fpage>103</fpage>–<lpage>113</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Cogdell1">
        <label>26</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cogdell</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Frank</surname><given-names>H</given-names></name> (<year>1987</year>) <article-title>How carotenoids function in photosynthetic bacteria</article-title>. <source>Biochim Biophys Acta</source> <volume>895</volume>: <fpage>63</fpage>–<lpage>79</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Nakazawa1">
        <label>27</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Nakazawa</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Suzuki</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Suzuki</surname><given-names>S</given-names></name> (<year>1975</year>) <article-title>Sequential degradation of keratan sulfate by bacterial enzymes and purification of a sulfatase in the enzymatic system</article-title>. <source>J Biol Chem</source> <volume>250</volume>: <fpage>905</fpage>–<lpage>911</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Samal1">
        <label>28</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Samal</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Martin</surname><given-names>O</given-names></name> (<year>2011</year>) <article-title>Randomizing genome-scale metabolic networks</article-title>. <source>PLoS One</source> <volume>6</volume>: <fpage>e22295</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Feist1">
        <label>29</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Feist</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Herrgård</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Thiele</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Reed</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Palsson</surname><given-names>B</given-names></name> (<year>2008</year>) <article-title>Reconstruction of biochemical networks in microorganisms</article-title>. <source>Nat Rev Microbiol</source> <volume>7</volume>: <fpage>129</fpage>–<lpage>143</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Trosvik1">
        <label>30</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Trosvik</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Rudi</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Straetkvern</surname><given-names>KO</given-names></name>, <name name-style="western"><surname>Jakobsen</surname><given-names>KS</given-names></name>, <name name-style="western"><surname>Naes</surname><given-names>T</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Web of ecological interactions in an experimental gut microbiota</article-title>. <source>Environ Microbiol</source> <volume>12</volume>: <fpage>2677</fpage>–<lpage>2687</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Gordon1">
        <label>31</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gordon</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Klaenhammer</surname><given-names>T</given-names></name> (<year>2011</year>) <article-title>A rendezvous with our microbes</article-title>. <source>Proc Natl Acad Sci</source> <volume>108</volume>: <fpage>4513</fpage>–<lpage>4515</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Borenstein1">
        <label>32</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Borenstein</surname><given-names>E</given-names></name> (<year>2012</year>) <article-title>Computational systems biology and in silico modeling of the human microbiome</article-title>. <source>Brief Bioinform</source> <volume>13</volume>: <fpage>769</fpage>–<lpage>780</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Hastings1">
        <label>33</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hastings</surname><given-names>W</given-names></name> (<year>1970</year>) <article-title>Monte Carlo sampling methods using Markov chains and their applications</article-title>. <source>Biometrika</source> <volume>57</volume>: <fpage>97</fpage>–<lpage>109</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Roberts1">
        <label>34</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Roberts</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Gelman</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Gilks</surname><given-names>W</given-names></name> (<year>1997</year>) <article-title>Weak convergence and optimal scaling of random walk Metropolis algorithms</article-title>. <source>Ann Appl Probab</source> <volume>7</volume>: <fpage>110</fpage>–<lpage>120</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Bray1">
        <label>35</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bray</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Curtis</surname><given-names>J</given-names></name> (<year>1957</year>) <article-title>An ordination of the upland forest communities of southern Wisconsin</article-title>. <source>Ecol Monogr</source> <volume>27</volume>: <fpage>325</fpage>–<lpage>349</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-DeSantis1">
        <label>36</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>DeSantis</surname><given-names>TZ</given-names></name>, <name name-style="western"><surname>Hugenholtz</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Larsen</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Rojas</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Brodie</surname><given-names>EL</given-names></name>, <etal>et al</etal>. (<year>2006</year>) <article-title>Greengenes, a chimerachecked 16S rRNA gene database and workbench compatible with ARB</article-title>. <source>Appl Environ Microbiol</source> <volume>72</volume>: <fpage>5069</fpage>–<lpage>5072</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Lozupone1">
        <label>37</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lozupone</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Knight</surname><given-names>R</given-names></name> (<year>2005</year>) <article-title>Unifrac: a new phylogenetic method for comparing microbial communities</article-title>. <source>Appl Environ Microbiol</source> <volume>71</volume>: <fpage>8228</fpage>–<lpage>8235</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Hamady1">
        <label>38</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hamady</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Lozupone</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Knight</surname><given-names>R</given-names></name> (<year>2010</year>) <article-title>Fast UniFrac: facilitating high-throughput phylogenetic analyses of microbial communities including analysis of pyrosequencing and PhyloChip data</article-title>. <source>ISME J</source> <volume>4</volume>: <fpage>17</fpage>–<lpage>27</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Knight1">
        <label>39</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Knight</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Maxwell</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Birmingham</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Carnes</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Caporaso</surname><given-names>JG</given-names></name>, <etal>et al</etal>. (<year>2007</year>) <article-title>PyCogent: a toolkit for making sense from sequence</article-title>. <source>Genome Biol</source> <volume>8</volume>: <fpage>R171</fpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Lozupone2">
        <label>40</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lozupone</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Lladser</surname><given-names>ME</given-names></name>, <name name-style="western"><surname>Knights</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Stombaugh</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Knight</surname><given-names>R</given-names></name> (<year>2011</year>) <article-title>Unifrac: an effective distance metric for microbial community comparison</article-title>. <source>ISME J</source> <volume>5</volume>: <fpage>169</fpage>–<lpage>172</lpage>.</mixed-citation>
      </ref>
      <ref id="pcbi.1002981-Warnes1">
        <label>41</label>
        <mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Warnes</surname><given-names>G</given-names></name> (<year>2002</year>) <article-title>HYDRA A JAVA library for Markov Chain Monte Carlo</article-title>. <source>J Stat Softw</source> <volume>7</volume>: <fpage>1</fpage>–<lpage>32</lpage>.</mixed-citation>
      </ref>
    </ref-list>
  </back>
</article>