<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS ONE</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">plosone</journal-id><journal-title-group>
<journal-title>PLoS ONE</journal-title></journal-title-group>
<issn pub-type="epub">1932-6203</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PONE-D-13-37034</article-id>
<article-id pub-id-type="doi">10.1371/journal.pone.0089543</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Biology</subject><subj-group><subject>Computational biology</subject><subj-group><subject>Evolutionary modeling</subject></subj-group></subj-group><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Evolutionary processes</subject><subj-group><subject>Speciation</subject><subject>Species extinction</subject></subj-group></subj-group><subj-group><subject>Evolutionary systematics</subject><subj-group><subject>Phylogenetics</subject></subj-group></subj-group><subj-group><subject>Forms of evolution</subject><subj-group><subject>Macroevolution</subject></subj-group></subj-group><subj-group><subject>Paleontology</subject></subj-group></subj-group><subj-group><subject>Theoretical biology</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Mathematics</subject><subj-group><subject>Applied mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group><subj-group><subject>Probability theory</subject><subj-group><subject>Markov model</subject></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Automatic Detection of Key Innovations, Rate Shifts, and Diversity-Dependence on Phylogenetic Trees</article-title>
<alt-title alt-title-type="running-head">Modeling Macroevolutionary Mixtures on Phylogenies</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>Daniel L.</given-names></name><xref ref-type="aff" rid="aff1"/><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><addr-line>Department of Ecology and Evolutionary Biology and Museum of Zoology, University of Michigan, Ann Arbor, Michigan, United States of America</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Kolokotronis</surname><given-names>Sergios-Orestis</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>Fordham University, United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">drabosky@umich.edu</email></corresp>
<fn fn-type="conflict"><p>The author has declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: DLR. Performed the experiments: DLR. Analyzed the data: DLR. Contributed reagents/materials/analysis tools: DLR. Wrote the paper: DLR.</p></fn>
</author-notes>
<pub-date pub-type="collection"><year>2014</year></pub-date>
<pub-date pub-type="epub"><day>26</day><month>2</month><year>2014</year></pub-date>
<volume>9</volume>
<issue>2</issue>
<elocation-id>e89543</elocation-id>
<history>
<date date-type="received"><day>8</day><month>9</month><year>2013</year></date>
<date date-type="accepted"><day>22</day><month>1</month><year>2014</year></date>
</history>
<permissions>
<copyright-year>2014</copyright-year>
<copyright-holder>Daniel L</copyright-holder><license xlink:type="simple"><license-p>Rabosky. This is an open-access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions>
<abstract>
<p>A number of methods have been developed to infer differential rates of species diversification through time and among clades using time-calibrated phylogenetic trees. However, we lack a general framework that can delineate and quantify heterogeneous mixtures of dynamic processes within single phylogenies. I developed a method that can identify arbitrary numbers of time-varying diversification processes on phylogenies without specifying their locations in advance. The method uses reversible-jump Markov Chain Monte Carlo to move between model subspaces that vary in the number of distinct diversification regimes. The model assumes that changes in evolutionary regimes occur across the branches of phylogenetic trees under a compound Poisson process and explicitly accounts for rate variation through time and among lineages. Using simulated datasets, I demonstrate that the method can be used to quantify complex mixtures of time-dependent, diversity-dependent, and constant-rate diversification processes. I compared the performance of the method to the MEDUSA model of rate variation among lineages. As an empirical example, I analyzed the history of speciation and extinction during the radiation of modern whales. The method described here will greatly facilitate the exploration of macroevolutionary dynamics across large phylogenetic trees, which may have been shaped by heterogeneous mixtures of distinct evolutionary processes.</p>
</abstract>
<funding-group><funding-statement>Financial support was provided by the Miller Institute for Basic Research in Science at the University of California, Berkeley, by the University of Michigan, and by NSF- DEB-1256330. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="15"/></counts></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>Perhaps the most general feature of biological diversity on Earth is the extent to which it varies - either through space, through time, or among different kinds of organisms. Biologists have long been fascinated by the observation that some groups of organisms contain far more species than other groups. For example, within vertebrates, lineages such as tetrapods (22000+ species), therian mammals (5000+ species), and teleosts (30000+ species) are several orders of magnitude more diverse than their respective sister clades (lungfishes, 6 species; monotremes, 5 species; holosteian fishes, &lt;10 species). This phylogenetic variation in species richness is mirrored by analogous variation in diversity through time. Paleontological evidence indicates that species richness has undergone dramatic changes during the past 550 million years <xref ref-type="bibr" rid="pone.0089543-Alroy1">[1]</xref>, <xref ref-type="bibr" rid="pone.0089543-Sepkoski1">[2]</xref>. Finally, contemporary species richness varies dramatically among geographic and climatic regions <xref ref-type="bibr" rid="pone.0089543-Mittelbach1">[3]</xref>, <xref ref-type="bibr" rid="pone.0089543-Ricklefs1">[4]</xref>. At least in part, the causes of phylogenetic, temporal, and spatial variation in species richness are thought to reside in the evolutionary processes of speciation and extinction. Consequently, there has been great interest in studying historical patterns of species diversification through time, towards understanding how and why speciation and extinction rates might vary through time, through space, and among clades <xref ref-type="bibr" rid="pone.0089543-Glor1">[5]</xref>, <xref ref-type="bibr" rid="pone.0089543-Morlon1">[6]</xref>, <xref ref-type="bibr" rid="pone.0089543-Paradis1">[7]</xref>, <xref ref-type="bibr" rid="pone.0089543-Ricklefs2">[8]</xref>, <xref ref-type="bibr" rid="pone.0089543-Wagner1">[9]</xref>.</p>
<p>The fossil record has provided insight into the temporal dynamics of species diversification <xref ref-type="bibr" rid="pone.0089543-Alroy2">[10]</xref>, <xref ref-type="bibr" rid="pone.0089543-Foote1">[11]</xref>, but analyses have generally been restricted to groups with exceptional fossil records and/or to relatively coarse temporal and phylogenetic scales. Because of the difficulties in applying paleontological approaches to many groups of organisms that lack adequate fossil records, there is great interest in extracting information about macroevolutionary dynamics from time-calibrated phylogenetic trees of extant species only <xref ref-type="bibr" rid="pone.0089543-Ricklefs2">[8]</xref>, <xref ref-type="bibr" rid="pone.0089543-Nee1">[12]</xref>. The increase in the availability of such phylogenies has helped catalyze a surge of methodological <xref ref-type="bibr" rid="pone.0089543-Etienne1">[13]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky1">[14]</xref>, <xref ref-type="bibr" rid="pone.0089543-Stadler1">[15]</xref> and meta-analyses <xref ref-type="bibr" rid="pone.0089543-McPeek1">[16]</xref>,  on the temporal dynamics of speciation and extinction through time. At the same time, a range of new approaches have been developed to assess the extent to which rates of species diversification vary among lineages <xref ref-type="bibr" rid="pone.0089543-Alfaro1">[20]</xref>, <xref ref-type="bibr" rid="pone.0089543-Slowinski1">[21]</xref> or in association with character states <xref ref-type="bibr" rid="pone.0089543-FitzJohn1">[22]</xref>, <xref ref-type="bibr" rid="pone.0089543-Maddison1">[23]</xref>, <xref ref-type="bibr" rid="pone.0089543-Mitter1">[24]</xref>, <xref ref-type="bibr" rid="pone.0089543-Paradis2">[25]</xref>.</p>
<p>To date, few macroevolutionary studies have simultaneously accounted for rate variation through time and among lineages <xref ref-type="bibr" rid="pone.0089543-Morlon1">[6]</xref>, <xref ref-type="bibr" rid="pone.0089543-Etienne1">[13]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky2">[26]</xref>. Increasing evidence suggests that failing to accommodate rate variation through time and among lineages can lead to profoundly biased parameter estimation <xref ref-type="bibr" rid="pone.0089543-Rabosky3">[27]</xref> and conceptually flawed interpretations of the factors that regulate species richness within clades or regions <xref ref-type="bibr" rid="pone.0089543-Rabosky2">[26]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky4">[28]</xref>.</p>
<p>In this article, I introduce a new framework for studying patterns of rate variation through time and among lineages using time-calibrated phylogenies of extant species. The approach is premised on the idea that phylogenetic trees are frequently shaped by heterogeneous mixtures of distinct processes. For example, some phylogenies may reflect mixtures of both diversity-dependent and constant-rate diversification processes (<xref ref-type="fig" rid="pone-0089543-g001">Figure 1</xref>). There is already considerable evidence that many empirical phylogenies have been shaped by multiple distinct evolutionary processes <xref ref-type="bibr" rid="pone.0089543-Etienne1">[13]</xref>, <xref ref-type="bibr" rid="pone.0089543-Jonnson1">[29]</xref>, and challenges of modeling such data are expected to increase with phylogenetic tree size.</p>
<fig id="pone-0089543-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g001</object-id><label>Figure 1</label><caption>
<title>Example of tree simulated under mixture of three distinct evolutionary processes.</title>
<p>(A) Clade diversification under constant-rate “background” diversification process with λ = 0.032 and μ = 0. (B) Shift to new adaptive zone with subsequent diversity-dependent regulation of speciation and diversity-independent extinction (blue branches; λ<sub>0</sub> = 0.395; K = 66; μ = 0.041). (C) Another lineage shifts to diversity-dependent speciation regime (red branches; λ<sub>0</sub> = 0.21; K = 97; μ = 0.012). Total tree depth is 100 time units. Despite undergoing two distinct diversity-dependent slowdowns in the rate of speciation, the overall gamma statistic <xref ref-type="bibr" rid="pone.0089543-Pybus1">[63]</xref> for the tree is positive (γ = 2.51) and provides no evidence for changes in the rate of speciation through time. Note that a tree with three distinct processes contains two distinct transitions between processes.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g001" position="float" xlink:type="simple"/></fig>
<p>My general approach assumes that shifts between macroevolutionary regimes occur across the branches of a phylogenetic tree under a compound Poisson process. This framework has been used previously to model among-lineage variation in rates of molecular evolution <xref ref-type="bibr" rid="pone.0089543-Huelsenbeck1">[30]</xref>. The number of such transitions between distinct processes is assumed to follow a Poisson distribution. Rather than assume a fixed number of distinct processes on a given phylogenetic tree, I use reversible jump Markov Chain Monte Carlo <xref ref-type="bibr" rid="pone.0089543-Green1">[31]</xref> (hereafter, rjMCMC) to automatically explore the universe of models that differ in the number of distinct evolutionary regimes. The method thus enables exploration of a vast state space of possible models to explain a given phylogenetic diversification pattern.</p>
<p>The method described here differs from previous methods in several key respects. First, the method does not assume that rates of speciation and extinction are constant through time within clades, thus relaxing the assumption of time-homogeneous diversification used in most previous multi-model approaches <xref ref-type="bibr" rid="pone.0089543-Alfaro1">[20]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky5">[32]</xref>. Second, the location and number of distinct evolutionary processes (“regimes”) represent random quantities that are themselves estimated from the data. In addition, by adopting a Bayesian approach, we can algorithmically explore a greater number of candidate models than is possible with incremental (e.g., stepwise) information-theoretic approaches <xref ref-type="bibr" rid="pone.0089543-Alfaro1">[20]</xref>. Because rjMCMC samples diversification models in proportion to their posterior probability <xref ref-type="bibr" rid="pone.0089543-Green1">[31]</xref>, <xref ref-type="bibr" rid="pone.0089543-Bartolucci1">[33]</xref>, model selection emerges automatically from the analysis. Finally, the method provides marginal distributions of speciation and extinction rates for every branch in a phylogenetic tree.</p>
</sec><sec id="s2" sec-type="materials|methods">
<title>Materials and Methods</title>
<sec id="s2a">
<title>Compound Poisson Process Model of Diversification Rate Variation</title>
<p>The model assumes that phylogenetic trees are shaped by a countable set of distinct and potentially dynamic evolutionary processes of speciation and extinction. Transitions between processes, or “events”, are assumed to occur across the branches of the phylogeny under a compound Poisson process <xref ref-type="bibr" rid="pone.0089543-Huelsenbeck1">[30]</xref>. Let <italic>ξ<sub>i</sub></italic> denote the mapping of the i’th transition to a specific location on the tree; thus, <italic>ξ</italic> denotes a unique location on a specific branch of the tree. Nodes and branches descended from a mapped transition <italic>ξ<sub>i</sub></italic> inherit the evolutionary process, denoted by <italic>Φ<sub>i</sub></italic>, that begins at point <italic>ξ<sub>i</sub></italic>. The process <italic>Φ<sub>i</sub></italic> terminates at terminal branches, or at the next downstream transition (<xref ref-type="fig" rid="pone-0089543-g001">Figure 1</xref>). Thus, the occurrence of a transition defines a connected subgraph of adjacent nodes, but does not necessarily include all of the descendent nodes downstream of a particular transition.</p>
<p>Any tree is necessarily governed by at least one process that begins at the root node and the number of additional transitions is a Poisson-distributed random variable with rate parameter <italic>Λ</italic>. In the MCMC implementation of the model described below, new transitions can be added to the tree, and existing transitions can be moved or deleted from the tree. The addition of a transition results in a new evolutionary process that is decoupled from the parent process. For example, consider a phylogeny with dynamics governed by just a single process, <italic>Φ<sub>R</sub></italic>. If a transition occurs at position <italic>ξ<sub>i</sub></italic>, then all lineages downstream from point ξ<sub>i</sub> are governed by a new evolutionary process, <italic>Φ<sub>i</sub></italic>. Formally, each possible count of transitions defines a diversification model, and we denote a model with <italic>k</italic> distinct transitions by M<sub>k</sub>. The addition of a process to a tree with <italic>k</italic> transitions thus entails a jump from model M<sub>k</sub> to M<sub>k+1</sub>. There is no upper bound on the number of transitions, as multiple transitions can occur on a given branch. The minimum model, with a single process, corresponds to <italic>k</italic> = 0 and contains zero transitions.</p>
<p>I assume that each process <italic>Φ</italic> represents a distinct time-varying process of speciation (<italic>λ</italic>) and a constant background rate of extinction (<italic>μ</italic>). We used an exponential change function to model variation in speciation rates through time within a particular process, such that<disp-formula id="pone.0089543.e001"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e001" xlink:type="simple"/><label>(1)</label></disp-formula>where <italic>λ</italic> is the rate of speciation for a process at time t<sub>i</sub> relative to the start of the process and where <italic>λ<sub>0,i</sub></italic> and <italic>z<sub>i</sub></italic> represent the initial speciation rate and rate change parameter for the i’th transition. For notational clarity, parameters associated with the root process are denoted with zero subscripts: for example, <italic>λ<sub>0,0</sub></italic> and <italic>z<sub>0</sub></italic> correspond to the initial speciation rate and rate-change parameter for the process associated with the root of the tree. This model is equivalent to the SPVAR model from Rabosky and Lovette <xref ref-type="bibr" rid="pone.0089543-Rabosky1">[14]</xref>. The exponential change function is a natural choice for modeling both time-varying and diversity-dependent speciation, because an exponential change in speciation with respect to time closely approximates a linear change in speciation with respect to diversity <xref ref-type="bibr" rid="pone.0089543-Quental1">[34]</xref>. The full model thus includes the possibility that a single time-varying diversification process describes the entire phylogeny <xref ref-type="bibr" rid="pone.0089543-Rabosky1">[14]</xref> as well as the possibility that many independent time-varying processes govern evolutionary dynamics across the tree.</p>
<p>I implemented the model in a Bayesian framework. Bayesian approaches have already been used effectively to model single processes on phylogenetic trees <xref ref-type="bibr" rid="pone.0089543-Bokma1">[35]</xref>, <xref ref-type="bibr" rid="pone.0089543-Silvestro1">[36]</xref>, but in this case, the number of distinct processes is itself a random quantity. I constructed a transdimensional Markov chain that could move between models containing different numbers of processes. This is known as “reversible jump” Markov Chain Monte Carlo (rjMCMC), as it involves probabilistic “jumps” between model subspaces of different dimensionality <xref ref-type="bibr" rid="pone.0089543-Green1">[31]</xref>. An attractive feature of this approach is that the Markov chain samples diversification models in proportion to their posterior probability. Thus, the relative probabilities of diversification models with (0, 1, 2, 3…. <italic>k</italic>) distinct processes can be computed immediately by tabulating the relative frequencies of those models in the MCMC output. Several recent studies have used rjMCMC to study variation in rates of phenotypic evolution across phylogenetic trees <xref ref-type="bibr" rid="pone.0089543-Eastman1">[37]</xref>, <xref ref-type="bibr" rid="pone.0089543-Venditti1">[38]</xref>.</p>
</sec><sec id="s2b">
<title>Bayesian Implementation</title>
<p>The full model contains parameters for the overall rate at which transitions occur (<italic>Λ</italic>), as well as location (<italic>ξ</italic>) and diversification parameters (<italic>λ, z, μ</italic>) for each transition. I simulated a Markov process that (i) permitted incremental transitions to new diversification models (<italic>M<sub>k</sub> → M<sub>k+1</sub></italic> or <italic>M<sub>k</sub></italic> → <italic>M<sub>k-1</sub></italic>), and (ii) updates to parameters of the current models. Note that my usage of the word model in this context can refer to either the overall compound Poisson process model, or to submodels with distinct numbers of processes (e.g., <italic>M<sub>1</sub></italic>, <italic>M<sub>2</sub></italic>, … <italic>M<sub>N</sub></italic>). The Markov chain is updated using the following moves: (1) a transition is added to the tree, (2) a transition is deleted from the tree, (3) the position of an existing transition (<italic>ξ<sub>i</sub></italic>) is updated, (4) the rate at which transitions occur is updated (<italic>Λ</italic>), (5) the initial speciation rate for the i’th transition is changed (<italic>λ<sub>0, i</sub></italic>), (6) the rate-change parameter for the i’th transition (<italic>z<sub>i</sub></italic>) is updated, and (7) the extinction rate for the i’th transition is changed (µ<italic><sub>i</sub></italic>).</p>
<p>For within-model moves that do not involve changes in the dimensionality of the full model, acceptance probabilities follow the standard Metropolis-Hastings formulation <xref ref-type="bibr" rid="pone.0089543-Hastings1">[39]</xref>, <xref ref-type="bibr" rid="pone.0089543-Metropolis1">[40]</xref>, or<disp-formula id="pone.0089543.e002"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e002" xlink:type="simple"/><label>(2)</label></disp-formula>where <italic>θ</italic> and <italic>θ’</italic> are parameter vectors corresponding to current and proposed states, <italic>f(• )</italic> and <italic>π(• )</italic> are the corresponding likelihood and prior densities, and <italic>q(θ’ | θ)</italic> is the relative probability of proposing a move to parameter vector <italic>θ’</italic> given that the current state is <italic>θ.</italic></p>
<p>The acceptance probability for moves that transition between models requires a more general formulation <xref ref-type="bibr" rid="pone.0089543-Green1">[31]</xref>, <xref ref-type="bibr" rid="pone.0089543-Sisson1">[41]</xref>, of which standard Metropolis-Hastings is a special case. In the present framework, we propose to jump from some model <italic>M<sub>k</sub></italic> with parameter vector <italic>θ</italic> to a new model <italic>M<sub>k+1</sub></italic> with parameter vectors <italic>θ’</italic> and <italic>ψ</italic>, where <italic>θ</italic> denotes parameters that are common to both models and <italic>ψ</italic> denotes parameters that occur in the proposed model but not the current model. To move between models, we generate a random vector <italic>ν</italic> from some known density, <italic>q(ν)</italic>. We then map the current state and the random vector to the new state (<italic>θ’</italic>, <italic>ψ</italic>) through use of a mapping function g(<italic>θ, ν</italic>). The random vector <italic>ν</italic> has a number of elements equal to the number of parameters in <italic>ψ</italic>, thus satisfying the dimension-matching requirement for transdimensional moves. The acceptance probability for this move is given by<disp-formula id="pone.0089543.e003"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e003" xlink:type="simple"/><label>(3)</label></disp-formula>where q(<italic>M<sub>k</sub></italic> | <italic>M<sub>k+1</sub></italic>) denotes the probability of proposing a move from model <italic>M<sub>k+1</sub></italic> to model <italic>M<sub>k</sub></italic>, π(<italic>M<sub>k</sub></italic>) is the prior probability of model <italic>M<sub>k</sub></italic>, and the last term is the determinant of the Jacobian matrix for the transition from the vector (<italic>θ, ν)</italic> to (<italic>θ’</italic>, <italic>ψ</italic>) via the mapping function <italic>g(•).</italic> The corresponding reverse move is deterministic and the acceptance probability is given by the inverse of the numerator in <xref ref-type="disp-formula" rid="pone.0089543.e003">equation 3</xref>, with the exception of the case where <italic>k</italic> equals 0 or 1 (discussed below).</p>
<p>In the model described here, an increase from <italic>M<sub>k</sub></italic> to <italic>M<sub>k+1</sub></italic> involves the addition of four new parameters to the process: <italic>ψ = </italic>(<italic>ξ</italic><sub>k+1</sub>, <italic>λ<sub>0,k+1</sub>, z<sub>k+1</sub>,</italic> µ<italic><sub>k+1</sub></italic>). During model-jumping proposals, all parameters <italic>θ</italic> are mapped to <italic>θ’</italic> via the identity function, such that <italic>θ’</italic> = <italic>θ.</italic> The mapping from <italic>ν</italic> to <italic>ψ</italic>, or g(<italic>ν),</italic> was also defined using simple identity relationships:<disp-formula id="pone.0089543.e004"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e004" xlink:type="simple"/><label>(4)</label></disp-formula></p>
<p>Variables <italic>ν<sub>1</sub>, ν<sub>2</sub>, ν<sub>2</sub>,</italic> and <italic>ν<sub>3</sub></italic> were sampled from the corresponding prior distributions for <italic>ξ, λ<sub>0</sub>, z,</italic> and <italic>μ</italic>. The Jacobian term reduces to the identity matrix and has a determinant of 1.</p>
<p>Under the compound Poisson process, the overall (whole-tree) rate at which transitions occur under the model is <italic>Λ</italic>. The prior ratio for models M<sub>k+1</sub> to M<sub>k</sub>, given Λ, is simply the ratio of Poisson densities with <italic>k</italic>+1 and <italic>k</italic> transitions, or<disp-formula id="pone.0089543.e005"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e005" xlink:type="simple"/><label>(5)</label></disp-formula></p>
<p>To compute the proposal probability q(<italic>M<sub>k</sub></italic> | <italic>M<sub>k+1</sub></italic>), let <italic>d<sub>k+1</sub></italic> represent the probability of making a move that deletes one of <italic>k +1</italic> transitions on the tree, and let <italic>b<sub>k</sub></italic> represent the probability of adding a transition when there are currently <italic>k</italic> transitions on the tree. The probabilities <italic>d<sub>k</sub></italic> and <italic>b<sub>k</sub></italic> are typically equal to 0.5, since addition and deletion moves are equiprobable for most values of <italic>k</italic>. However, when the tree includes just a single process and no transitions (<italic>k</italic> = 0), the relative probability of adding a transition is equal to 1.0, as the root process cannot be deleted. In this case, <italic>d<sub>1</sub></italic> = 0 and <italic>b<sub>1</sub></italic> = 1, because only additions of transitions (and not deletions) can be proposed. This leads to an asymmetrical proposal ratios for adding transitions (when <italic>k</italic> = 0) and for deleting transitions (when <italic>k</italic> = 1). When <italic>k</italic> = 0, the ratio <italic>d<sub>2</sub></italic>/<italic>b<sub>1</sub></italic> is equal to 0.5. When there are two processes on the tree (<italic>k</italic> = 1), the proposal ratio is asymmetrical and <italic>b<sub>k-1</sub></italic><sub>/</sub><italic>d<sub>k</sub></italic> is equal to 2.0. This compensates for the excess of gain proposals that occur when there is just a single process on the tree. Otherwise, q(<italic>M<sub>k+1</sub></italic> | <italic>M<sub>k</sub></italic>) = q(<italic>M<sub>k</sub></italic> | <italic>M<sub>k+1</sub></italic>) = 1.</p>
<p>Because elements of <italic>v</italic> are sampled from prior distributions for <italic>ξ</italic>, <italic>λ<sub>0</sub>, z,</italic> and <italic>μ,</italic> the prior on <italic>ψ</italic> in the numerator of <xref ref-type="disp-formula" rid="pone.0089543.e003">equation 3</xref> is equal to the density q(<italic>ν</italic>) in the denominator, as in <xref ref-type="bibr" rid="pone.0089543-Huelsenbeck1">[30]</xref>. The acceptance probability for the addition of a transition is thus a function of the likelihood ratio, the prior ratio for models <italic>M<sub>k+1</sub></italic> and <italic>M<sub>k</sub></italic>, and the proposal ratio for the models, or<disp-formula id="pone.0089543.e006"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e006" xlink:type="simple"/><label>(6)</label></disp-formula>where <italic>L</italic> is the likelihood ratio of current and proposed states.</p>
<p>The acceptance probability for a move that deletes one of <italic>k</italic> transitions from the tree involves inverting the ratio term from <xref ref-type="disp-formula" rid="pone.0089543.e006">equation (6</xref>) and modifying subscripts to reflect the fact that we are proposing a move to a state with <italic>k</italic>–1 transitions. The proposal ratio becomes <italic>b<sub>k-1</sub></italic>/<italic>d<sub>k</sub></italic>, leading to an overall acceptance probability of<disp-formula id="pone.0089543.e007"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e007" xlink:type="simple"/><label>(7)</label></disp-formula></p>
<p>The positions of transitions were updated using global and local moves. A global move entailed sampling a new map location <italic>ξ</italic> from tree and allowed transitions to shift to any point on the tree with uniform probability. A local move involved shifting the position of a transition by a small random quantity that was sampled from a uniform distribution. I fixed the ratio of global:local proposals at 1∶10 for all analyses described here. The acceptance probability for a move that changes the position of a transition is equal to min(1, <italic>L</italic>).</p>
<p>To update any of the zero-bounded rate parameters in the model (Λ, λ<sub>i</sub>, µ<sub>i</sub>), I used a proportional shrinking-expanding proposal <xref ref-type="bibr" rid="pone.0089543-Yang1">[42]</xref>, such that<disp-formula id="pone.0089543.e008"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e008" xlink:type="simple"/><label>(8)</label></disp-formula>where <italic>r</italic> is the current value of the rate parameter, <italic>U</italic> is a random variable sampled from a uniform (0, 1) distribution, and <italic>η</italic> is a tuning parameter. The acceptance probability of a move that updates such a rate parameter is</p>
<p><disp-formula id="pone.0089543.e009"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e009" xlink:type="simple"/><label>(9)</label></disp-formula>Finally, I used a sliding window proposal to update the value of the rate change parameter <italic>z<sub>i</sub></italic>. Here, a random variable is sampled from a uniform (−<italic>δ</italic>, <italic>δ</italic>) distribution and added to the current value of the parameter; δ is a tuning parameter that can be modified to increase the efficiency of the MCMC sampling. The proposal ratio for the sliding window proposal is 1.0, and the acceptance probability is min(1, <italic>L</italic>).</p>
<p>I placed a uniform (0, <italic>T</italic>) prior density on the location of transitions, assuming simply that all positions on the tree are equiprobable. Thus, during the addition of a new transition, we sample a new map location at random from (0, <italic>T</italic>). I placed relatively flat exponential priors on <italic>λ</italic> and <italic>μ</italic> and a normal (mean = 0; variance = 0.05) prior on <italic>z</italic>; the latter choice was motivated by the fact that <italic>z</italic> = 0 corresponds to a constant-speciation diversification process (<xref ref-type="disp-formula" rid="pone.0089543.e001">equation 1</xref>). I placed an exponential prior on Λ, the parameter of the Poisson distribution that serves as a prior on the number of transitions on the tree. Larger values for the rate parameter of this exponential distribution imply a greater number of transitions on the tree. I denote this exponential prior on the number of transitions by γ.</p>
<p>Likelihoods were computed on branches using a discretization of the constant-rate birth death model that enabled us to approximate time-dependent and diversity-dependent rate variation. Following the notation from Maddison et al. <xref ref-type="bibr" rid="pone.0089543-Maddison1">[23]</xref>, let <italic>D(t)</italic> represent the probability that some lineage at time <italic>t</italic> evolves into a clade identical to the observed descendant clade, and let <italic>E(t</italic>) represent the probability that the lineage goes extinct before the present. Following <xref ref-type="bibr" rid="pone.0089543-FitzJohn2">[43]</xref>, let <italic>t<sub>N</sub></italic> be the initial time for such an interval, in units of time before the present, and let <italic>t</italic> be some earlier time (closer to the root), such that <italic>t</italic>&gt;<italic>t<sub>N</sub></italic> &gt;0. It is straightforward to write down the change in <italic>D</italic> and <italic>E</italic> as a function of time, such that<disp-formula id="pone.0089543.e010"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e010" xlink:type="simple"/><label>(10)</label></disp-formula>and</p>
<p><disp-formula id="pone.0089543.e011"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e011" xlink:type="simple"/><label>(11)</label></disp-formula>Let <italic>E<sub>0</sub></italic> and <italic>D<sub>0</sub></italic> denote the initial values of the speciation and extinction probability for a given interval Δ<italic>t</italic> over which <italic>E(t)</italic> and <italic>D(t)</italic> must be computed. The analytical solution to <xref ref-type="disp-formula" rid="pone.0089543.e011">equation (11</xref>), given <italic>E<sub>0</sub></italic>, is<disp-formula id="pone.0089543.e012"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e012" xlink:type="simple"/><label>(12)</label></disp-formula>which is identical to <xref ref-type="disp-formula" rid="pone.0089543.e012">equation (12a</xref>) from FitzJohn et al. (2009) under the substitution <italic>E<sub>0</sub></italic> = 1–<italic>f</italic>, where <italic>f</italic> is the sampling fraction of the phylogeny. FitzJohn et al. <xref ref-type="bibr" rid="pone.0089543-FitzJohn2">[43]</xref> demonstrated how the birth-death model could be extended to account for incomplete taxon sampling (via the sampling fraction <italic>f</italic>), but their results allow the calculation of probabilities along any segment of a branch of a phylogenetic tree, provided that <italic>E<sub>0</sub></italic> and <italic>D<sub>0</sub></italic> are available for the beginning of the interval over which the probabilities are to be computed. <xref ref-type="disp-formula" rid="pone.0089543.e012">Equation (12</xref>) can be substituted into <xref ref-type="disp-formula" rid="pone.0089543.e010">equation (10</xref>), and the resulting expression simplifies to<disp-formula id="pone.0089543.e013"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e013" xlink:type="simple"/><label>(13)</label></disp-formula>where Δt is the duration of the focal interval, between time tN and time t. As we begin with known conditions D0 and E0 at the beginning of the focal segment, we can set tN = 0 for the purposes of our calculations. This immediately simplifies <xref ref-type="disp-formula" rid="pone.0089543.e013">equation (13</xref>) from <xref ref-type="bibr" rid="pone.0089543-FitzJohn2">[43]</xref> and leads to <xref ref-type="disp-formula" rid="pone.0089543.e013">equation (13</xref>) above. As demonstrated by FitzJohn et al. <xref ref-type="bibr" rid="pone.0089543-FitzJohn2">[43]</xref>, these calculations reduce to the speciation-extinction model for phylogenetic trees developed earlier <xref ref-type="bibr" rid="pone.0089543-Nee1">[12]</xref>.</p>
<p>To discretize the rate calculations, I broke each branch of the phylogenetic tree into segments and computed the mean speciation rate under the exponential change model (<xref ref-type="disp-formula" rid="pone.0089543.e001">equation 1</xref>) for the corresponding process. I then assumed constant rate diversification within each branch segment. For each branch segment, the initial speciation and extinction rates <italic>D<sub>0</sub></italic> and <italic>E<sub>0</sub></italic> are equal to the terminal values for the preceding segment. I made this design choice to facilitate rapid likelihood calculations on large phylogenetic trees and, as demonstrated below, this discretization performs well across a range of simulated datasets. I used a step size of 1.0 time units for all calculations. If a branch was particularly short, such that this step size exceeded the length of the branch, the entire branch was assumed to have a single rate equal to the mean rate along its length.</p>
<p>To compute the likelihood of the full tree under a given set of parameters, we perform the calculations described above on each terminal branch of the phylogeny. Initial values of <italic>D<sub>0</sub></italic> and <italic>E<sub>0</sub></italic> at the tips of the tree were set to 1.0 and 0.0 respectively. It is straightforward to modify these values to account for incomplete taxon sampling if only a fraction <italic>f</italic> of the total species in a clade have been included in a phylogenetic tree. When <italic>f</italic> &gt;0, we can set <italic>D<sub>0</sub></italic> = <italic>f</italic> and <italic>E<sub>0</sub></italic> = 1–<italic>f</italic> for the initial calculations at the tips of the tree <xref ref-type="bibr" rid="pone.0089543-FitzJohn2">[43]</xref>. This correction assumes that species are missing at random from the phylogeny, which may not be valid for many datasets <xref ref-type="bibr" rid="pone.0089543-Brock1">[44]</xref>, <xref ref-type="bibr" rid="pone.0089543-Cusimano1">[45]</xref>, <xref ref-type="bibr" rid="pone.0089543-Hohna1">[46]</xref>, <xref ref-type="bibr" rid="pone.0089543-Stadler2">[47]</xref>. As in the BiSSE calculations <xref ref-type="bibr" rid="pone.0089543-Maddison1">[23]</xref>, these calculations flow “rootwards” from these terminal branches towards the root. When terminal probabilities have been computed for both descendant branches from a given internal node, the left (<italic>D<sub>L</sub></italic>) and right (<italic>D<sub>R</sub></italic>) branch probabilities were combined as <italic>λ D<sub>R</sub>(t)D<sub>L</sub>(t)</italic>, where λ is the speciation rate at the focal node <xref ref-type="bibr" rid="pone.0089543-Maddison1">[23]</xref>. The calculations then continue down the branch subtending this node. The likelihood of the full tree is the value of <italic>D</italic> after combining these probabilities at the root node. Likelihoods were conditioned on the occurrence of a root node and on the survival of both descendent branches from the root speciation event <xref ref-type="bibr" rid="pone.0089543-Nee1">[12]</xref>, <xref ref-type="bibr" rid="pone.0089543-Maddison1">[23]</xref>.</p>
<p>I implemented the compound Poisson process model of rate variation described above in a C++ program, which I refer to as BAMM. BAMM (Bayesian Analysis of Macroevolutionary Mixtures) can estimate the number of distinct evolutionary regimes across phylogenetic trees and estimates marginal distributions of speciation and extinction rates for each branch in a phylogenetic tree. The model allows extinction rates to exceed speciation rates. BAMM and associated documentation is available from the BAMM project website (<ext-link ext-link-type="uri" xlink:href="http://www.bamm-project.org" xlink:type="simple">www.bamm-project.org</ext-link>). The program operates on fully bifurcating phylogenetic trees of extant species. The implementation allows users to analytically account for incomplete taxon sampling under the assumption of random taxon sampling <xref ref-type="bibr" rid="pone.0089543-FitzJohn2">[43]</xref>.</p>
</sec><sec id="s2c">
<title>Analysis of Simulated Datasets</title>
<p>To evaluate performance of the compound Poisson process model of diversification rate variation, I simulated phylogenetic trees under six general diversification models. I first considered a simple constant-rate birth death process (model CR; 1 process), to evaluate parameter bias and the frequency of overfitting when the generating model does not include a heterogeneous mixture of processes. Given the widespread interest in identifying well-supported rate shifts and key innovations on phylogenetic trees, we are particularly interested in the frequency with which the model described here will incorrectly identify a multi-process model as having the maximum <italic>a posteriori</italic> probability, when the true generating model is a single process model. To assess whether my results were sensitive to choice of prior on the Poisson rate parameter <italic>Λ</italic>, I analyzed constant-rate phylogenies under three different prior parameterizations, corresponding to γ = 1, γ = 5, and γ = 10. All other analyses used a prior of γ = 1.0, which is conservative in the context of these analyses (see results).</p>
<p>I also considered a model where a pure-birth diversification process shifts to an exponential change process at some point in time (model exp2; 2 processes). Finally, I considered four variants of diversity-dependent multi-process models. In each case, I assumed that a pure-birth process at the root of the tree underwent multiple (1, 2, 3, or 4) shifts to independent and decoupled diversity-dependent speciation-extinction processes (models DD2, DD3, DD4, DD5). I conducted 500 simulations per scenario.</p>
<p>Each multiprocess simulation was conducted by first simulating a pure-birth phylogeny for 100 time units with λ = 0.032. I then randomly chose a time T<sub>s</sub> on the interval (40, 95) for the occurrence of a rate shift. A shift was then assigned randomly to one of the lineages that existed at time T<sub>s</sub>. I then sampled parameters for the new process (see below). The tree was then broken at the shift point, and a new subtree was simulated forward in time from the shift point under the new process parameters. For trees with more than two processes, this procedure was repeated until the target number of processes had been added. For the exp2 model, this consisted of sampling <italic>λ</italic>, <italic>z</italic>, and <italic>μ</italic> for the shift process uniformly on the following intervals: <italic>λ</italic>, (0.05, 0.50); <italic>z</italic>, (−0.10, 0.05); <italic>μ</italic>, (0.0, 0.45). Thus, the addition of an exponential change process could have resulted in either an increase in rates through time (if <italic>z</italic> &gt;0) or a decrease (if <italic>z</italic> &lt;0). For all simulations, I required that subtrees contained at least 25 and fewer than 1000 terminal taxa; any simulations failing to meet this criterion were automatically rejected.</p>
<p>For the diversity-dependent models, diversification dynamics followed a linear diversity-dependent model <xref ref-type="bibr" rid="pone.0089543-Rabosky6">[48]</xref>. The rate of speciation was thus a function of the number of coeval lineages in the subclade, or<disp-formula id="pone.0089543.e014"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e014" xlink:type="simple"/><label>(14)</label></disp-formula>where <italic>K</italic> is the clade-specific carrying capacity, and <italic>n<sub>t</sub></italic> is the number of lineages in the subclade at time <italic>t</italic>. Note that the occurrence of a shift event results in a decoupling of dynamics from the parent process. To parameterize the diversity-dependent processes, I sampled <italic>λ<sub>0</sub></italic> from a uniform (0.05, 0.40) distribution, <italic>K</italic> from a uniform (25, 250) distribution, and μ from a uniform (0, 0.05) distribution. For the constant-rate birth-death simulations, I sampled <italic>λ</italic> from a uniform (0, 0.1) distribution and chose a corresponding relative extinction rate (<italic>μ</italic>/<italic>λ</italic>) from a uniform (0, 0.99) distribution.</p>
<p>Each of the 500 simulations for each of 6 simulation scenarios was thus conducted under a potentially unique speciation-extinction parameterization. The number of taxa in each simulated tree also varied among datasets. I recorded the mean rate of speciation and extinction across each branch in each simulated tree. All simulations were conducted in C++; simulated trees are available through the Dryad data repository (doi:10.5061/dryad.hn1vn).</p>
<p>I analyzed each of the 3000 simulated datasets using BAMM with 3 million generations of MCMC sampling. I discarded the first half of samples from each simulation of the posterior as “burn-in” and estimated the overall “best model” as the model that was sampled most frequently by the Markov chain. I computed the mean of the posterior distribution of speciation and extinction rates on each branch for each tree. I then used OLS regression to assess the relationship between branch-specific rate estimates obtained using BAMM versus the true underlying evolutionary rates. As an additional estimate of bias, I computed the proportional error <xref ref-type="bibr" rid="pone.0089543-Eastman1">[37]</xref> in the estimated rates as a function of the true rates. This metric is computed as the weighted average of proportional rate differences across all <italic>N</italic> branches in the phylogeny, or<disp-formula id="pone.0089543.e015"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pone.0089543.e015" xlink:type="simple"/><label>(15)</label></disp-formula>where <italic>r<sub>EST</sub></italic> and <italic>r<sub>TRUE</sub></italic> are the estimated and true values of rates along a particular branch. A value of 2 would imply that estimated rates are, on average, equal to twice the true rate in the generating model.</p>
</sec><sec id="s2d">
<title>Comparison with MEDUSA</title>
<p>I compared the performance of BAMM to that of MEDUSA <xref ref-type="bibr" rid="pone.0089543-Alfaro1">[20]</xref>, a maximum likelihood method for modeling among-lineage heterogeneity in speciation-extinction dynamics. Beginning with a constant rate birth-death process, MEDUSA uses a stepwise AIC algorithm to incrementally add rate shifts to phylogenetic trees until the addition of new partitions fails to improve the fit of the model to the data. Thus, MEDUSA is similar to the method described here in that it is explicitly designed to discover the number and location of distinct processes of speciation and extinction on phylogenetic trees. However, MEDUSA, as implemented and typically used, makes the assumption that rates of species diversification are constant in time within rate classes. This assumption has been rejected by studies across a range of taxonomic scales, from species-level phylogenies <xref ref-type="bibr" rid="pone.0089543-McPeek1">[16]</xref>, <xref ref-type="bibr" rid="pone.0089543-Morlon2">[17]</xref>, <xref ref-type="bibr" rid="pone.0089543-Phillimore1">[18]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky2">[26]</xref> to tree-of-life scale compilations of clade age and species richness <xref ref-type="bibr" rid="pone.0089543-Rabosky7">[49]</xref>. However, the consequences of violating this assumption for MEDUSA analyses have not been investigated.</p>
<p>I analyzed each of the simulated datasets described above (500 datasets under each of 6 distinct models of diversification) using MEDUSA, using the implementation of MEDUSA available in the Geiger v1.99-3 package <xref ref-type="bibr" rid="pone.0089543-Harmon1">[50]</xref> for the R programming and statistical environment. Model selection used the default AICc criterion. I summarized the results of MEDUSA analyses in two ways. First, for each simulation scenario, I tabulated the distribution of “best fit” models, to assess the fraction of simulations for which MEDUSA was able to correctly estimate the number of processes in the generating model. Second, I used the same summary statistics described above for BAMM (e.g., proportional error) to compare branch-specific estimates of speciation rates under MEDUSA to the true rates under the generating model.</p>
</sec><sec id="s2e">
<title>Empirical Example: Cetacean Radiation</title>
<p>Steeman et al. <xref ref-type="bibr" rid="pone.0089543-Steeman1">[51]</xref> provided a time-calibrated phylogenetic tree for 87 of 89 extant species of whales and dolphins (Mammalia: Cetacea). They found support for increased rates of species diversification within a major dolphin clade, the Delphinidae. They also found evidence for an increased rate of species diversification at approximately 7.5 million years before present (Ma). I used the BAMM implementation of the compound Poisson process model of diversification rate variation to investigate the tempo and mode of cetacean diversification through time. I conducted 5 million generations of MCMC sampling, with multiple independent runs to assess convergence. Finally, I assessed the sensitivity of the cetacean analyses to the choice of prior γ on the number of processes in the phylogeny.</p>
</sec></sec><sec id="s3">
<title>Results</title>
<sec id="s3a">
<title>Analysis of Simulated Datasets</title>
<p><xref ref-type="fig" rid="pone-0089543-g002">Figure 2</xref> shows a representative BAMM analysis for a tree simulated under the DD3 model (see also <xref ref-type="fig" rid="pone-0089543-g001">Figure 1</xref>). BAMM results are generally robust to choice of prior on the expected number of processes (γ) in the phylogeny under the compound Poisson process model of rate variation (<xref ref-type="fig" rid="pone-0089543-g003">Figure 3</xref>). With increasing values of γ, the model with maximum <italic>a posteriori</italic> probability (MAP) was biased in favor of <italic>M<sub>1</sub></italic>, a model with two processes. However, this represents a weak tendency towards model overfitting, because the true model (<italic>M<sub>0</sub></italic>) was generally characterized by a posterior probability much greater than 0.05 (<xref ref-type="fig" rid="pone-0089543-g003">Figure 3E, F</xref>). This suggests that results are robust to choice of γ: even with the trend towards overfitting (<xref ref-type="fig" rid="pone-0089543-g003">Figure 3C</xref>), the method is unlikely to yield strong support for models that are more complex than the generating model (<xref ref-type="fig" rid="pone-0089543-g003">Figure 3F</xref>). The simulation results presented below are based on γ = 1.</p>
<fig id="pone-0089543-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g002</object-id><label>Figure 2</label><caption>
<title>BAMM analysis of example tree (<xref ref-type="fig" rid="pone-0089543-g001">Figure 1</xref>).</title>
<p>Example tree was simulated under three distinct processes (one constant rate and two diversity dependent processes; two transitions in total). The tree was analyzed under (i) the full multi-process BAMM model with time-variable speciation; (ii) a constrained multi-process BAMM with time-constant speciation; and (iii) a fully constrained 1-process constant-rate birth-death model. (A) Log-likelihoods for thinned MCMC chains for the constant rate birth-death process (bottom), the time-constant multi-process model (middle), and the full BAMM model with time-varying speciation (top). (B) Numbers of transitions during rjMCMC sampling when model is constrained to time-constant speciation rates; sidebar gives frequency distribution of sampled states. (C) Numbers of transitions under full BAMM model with time-variable speciation processes. Black sidebar denotes true number of transitions in generating model. The true number of transitions was estimated correctly only when the assumption of time-constant rates was relaxed.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g002" position="float" xlink:type="simple"/></fig><fig id="pone-0089543-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g003</object-id><label>Figure 3</label><caption>
<title>BAMM analyses of constant-rate phylogenies and prior on Poisson rate parameter (γ).</title>
<p>Histograms in (A–C) display the frequency distribution of the estimated number of processes in the model with the maximum a posteriori (MAP) probability as a function of three different priors on the Poisson rate parameter <italic>Λ</italic> (γ = 1; γ = 5; γ = 10). This “best-fit” model was simply the model that was visited most often during the MCMC simulation of the posterior. (D–F) show the distribution of posterior probabilities for the true model (M<sub>0</sub>). With a relatively flat prior on models (γ = 10), the MAP model is biased towards a model with 2 processes ( = 1 transition). However, the posterior probability of the true model M<sub>0</sub> remains substantial (F), and M<sub>0</sub> nonetheless had a posterior probability greater than 0.10 for the vast majority of simulations. Results are based on 500 simulated phylogenies per γ scenario.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g003" position="float" xlink:type="simple"/></fig>
<p>For the five simulation scenarios with rate heterogeneity, the number of distinct processes estimated using BAMM was generally equal to the number of processes in the generating model (<xref ref-type="fig" rid="pone-0089543-g004">Figure 4</xref>). Power to infer the true number of processes decreased for the most complex models (DD3, DD4, DD5), but model overfitting was not a problem. The MAP model was no more complex than the generating model in the overwhelming majority of simulations (&gt;95%) for all five simulation scenarios.</p>
<fig id="pone-0089543-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g004</object-id><label>Figure 4</label><caption>
<title>Frequency distribution of evolutionary rate regimes estimated using BAMM, compared with true number of processes.</title>
<p>For each simulation, the estimated number of processes was simply the model that was most frequently sampled during MCMC simulation of the posterior distribution. Black bars denote true number of processes in generating model. For example, 84% of trees simulated under a single-shift exponential change model (exp2; top panel; two processes in the generating model) were correctly inferred to have been generated under a two-process model. For a diversity-dependent model with five processes (DD5), power to detect the true number of processes is lower, although though most analyses (80.4%) recovered either 4 or 5 process models as the MAP model. Results for each model are based on 500 simulated phylogenies and used a conservative γ = 1 prior on the expected number of non-root processes (see <xref ref-type="fig" rid="pone-0089543-g003">Figure 3</xref>).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g004" position="float" xlink:type="simple"/></fig>
<p>Estimates of speciation and extinction rates under the constant-rate model were highly correlated with rates in the generating model (<xref ref-type="fig" rid="pone-0089543-g005">Figure 5</xref>), although both rates were biased upwards for low rates. For multiprocess simulation models, branch-specific estimates of speciation rates were highly correlated with rates in the generating model (<xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref>, left). The estimated slope of the relationship between the true rates and estimated rates approached equality. However, a small percentage of simulations had estimated slopes that suggested a lack of relationship between true and estimated rates. These simulations were those where the most frequently sampled model had only a single process and thus reflect a lack of power, rather than consistent bias. In other words, branch specific estimates of rates for a multiprocess model may be poor if model underfitting has occurred. In the extreme case, a tree that is estimated to have only a single process may have very similar rate estimates on each branch; the correlation between these rates and the true rates will necessarily be low if the true model includes multiple processes and considerable rate heterogeneity across the tree.</p>
<fig id="pone-0089543-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g005</object-id><label>Figure 5</label><caption>
<title>BAMM estimates of speciation and extinction rates for phylogenies simulated under constant-rate birth-death process.</title>
<p>(A) Relationship between speciation rate in generating model and reconstructed mean rate across the tree under BAMM. Solid black line: identity line, expected if λ<sub>TRUE</sub> = λ<sub>ESTIMATED</sub>. Solid gray line: fitted OLS regression to estimates (black points) obtained using full BAMM model (multiple processes with time-variable speciation rates). (B) Corresponding extinction rate estimates for same set of trees.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g005" position="float" xlink:type="simple"/></fig><fig id="pone-0089543-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g006</object-id><label>Figure 6</label><caption>
<title>Precision and bias of BAMM in the estimation of branch-specific rates of speciation.</title>
<p>Phylogenies were simulated under 5 distinct evolutionary scenarios. For each simulated phylogeny, I reconstructed branch-specific speciation rates using BAMM and modeled these as a function of the true branch rates from the generating model. Frequency distributions of the estimated slope of this relationship are shown in the left column for each simulation scenario. Center column denotes corresponding r<sup>2</sup> values from the same OLS regressions. Right column is distribution of mean relative rate differences (RRD) for each scenario. A value of 1 implies that, on average, branch-specific speciation estimates are unbiased; a value of 0.5 would imply that branch-specific estimates are, on average, equal to 50% of the true value. Results for each simulation scenario are based on 500 simulated phylogenies (thus giving 500 slopes, r<sup>2</sup> values, and RRD values for each simulation scenario).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g006" position="float" xlink:type="simple"/></fig>
<p>A large fraction of the total variation in the underlying speciation rates is also explained by the estimated rates under the compound Poisson process model of diversification rate variation (<xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref>, middle). This fraction is higher for the two-process models (exp2, DD2) but remains stable across the remaining diversity-dependent scenarios (DD3, DD4, DD5). Finally, analysis of proportional error suggests that, on average, rates are not consistently over- or underestimated using BAMM; the mean proportional error between simulated and estimated rates is near 1.0 for all simulation scenarios.</p>
<p>I performed a similar analysis for extinction rates, with one key difference. Each simulation scenario assumed constant extinction rates within each process; hence, the number of unique extinction rates in each simulation was equal to the number of processes in the generating model. I computed the mean branch-specific extinction rate across each subclade that was governed by a distinct evolutionary process in the simulation model; I then analyzed these extinction rates across all 500 trees in a given simulation scenario together. For example, consider the phylogeny shown in <xref ref-type="fig" rid="pone-0089543-g001">Figure 1</xref>, with <italic>k</italic> = 3 processes. I computed the mean of the posterior distribution of all extinction estimates for branches assigned to process <italic>A</italic>, giving a single estimated rate overall for that process. I repeated this for processes <italic>B</italic> and <italic>C</italic>, such that I obtained <italic>k</italic> extinction estimates for each tree with <italic>k</italic> processes. <xref ref-type="table" rid="pone-0089543-t001">Table 1</xref> shows summary statistics for analyzing these sets of extinction rate estimates across all trees from a given simulation scenario. In general, relative rate differences suggest that extinction estimates are biased upwards. Nonetheless, the fraction of variance explained by the model is low in each case. Proportional error calculations were also performed as described above, although the root rate class was ignored, as it was equal to 0 in the simulation model. These values likewise indicate an upwards bias in extinction rate estimates.</p>
<table-wrap id="pone-0089543-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.t001</object-id><label>Table 1</label><caption>
<title>Relationship between branch-specific BAMM estimates of extinction and true rates in the simulation model.</title>
</caption><alternatives><graphic id="pone-0089543-t001-1" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.t001" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" rowspan="1" colspan="1">Model</td>
<td align="left" rowspan="1" colspan="1">processes</td>
<td align="left" rowspan="1" colspan="1">slope <xref ref-type="table-fn" rid="nt101">a</xref></td>
<td align="left" rowspan="1" colspan="1">r<sup>2</sup></td>
<td align="left" rowspan="1" colspan="1">PE <xref ref-type="table-fn" rid="nt102">b</xref></td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">Exponential change (exp2)</td>
<td align="left" rowspan="1" colspan="1">2</td>
<td align="left" rowspan="1" colspan="1">0.76</td>
<td align="left" rowspan="1" colspan="1">0.59</td>
<td align="left" rowspan="1" colspan="1">1.27</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Diversity-dependent (DD2)</td>
<td align="left" rowspan="1" colspan="1">2</td>
<td align="left" rowspan="1" colspan="1">0.81</td>
<td align="left" rowspan="1" colspan="1">0.16</td>
<td align="left" rowspan="1" colspan="1">1.85</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Diversity-dependent (DD3)</td>
<td align="left" rowspan="1" colspan="1">3</td>
<td align="left" rowspan="1" colspan="1">0.75</td>
<td align="left" rowspan="1" colspan="1">0.11</td>
<td align="left" rowspan="1" colspan="1">1.68</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Diversity-dependent (DD4)</td>
<td align="left" rowspan="1" colspan="1">4</td>
<td align="left" rowspan="1" colspan="1">0.81</td>
<td align="left" rowspan="1" colspan="1">0.13</td>
<td align="left" rowspan="1" colspan="1">1.67</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Diversity-dependent (DD5)</td>
<td align="left" rowspan="1" colspan="1">5</td>
<td align="left" rowspan="1" colspan="1">0.82</td>
<td align="left" rowspan="1" colspan="1">0.10</td>
<td align="left" rowspan="1" colspan="1">1.66</td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt101"><label>a</label><p>Slope and r<sup>2</sup> denote the estimated slope and variance explained by the relationship between true and estimated extinction rates for 500 trees simulated under each model.</p></fn><fn id="nt102"><label>b</label><p>PE is the mean proportional error across all simulations under a given model.</p></fn></table-wrap-foot></table-wrap></sec><sec id="s3b">
<title>Comparison with MEDUSA</title>
<p>I analyzed all 3000 simulated datasets using MEDUSA. The number of processes inferred for each simulation scenario are shown in <xref ref-type="fig" rid="pone-0089543-g007">Figure 7</xref> and can be compared to the corresponding BAMM results shown in <xref ref-type="fig" rid="pone-0089543-g003">Figure 3</xref>. MEDUSA performed worse than BAMM for all scenarios with time-varying rates of species diversification. Under the DD2 model, with just two processes, MEDUSA estimated the correct number of processes in 40.2% of simulated datasets. In contrast, BAMM correctly identified the true number of processes in 90% of simulated datasets (<xref ref-type="fig" rid="pone-0089543-g003">Figure 3</xref>). For diversity-dependent scenarios with more than two processes in total, MEDUSA consistently underestimated the true number of processes in the generating model for the overwhelming majority of simulated datasets. For the DD5 scenario, MEDUSA correctly identified the generating model in fewer than 5% of simulations, versus 38.4% with BAMM (<xref ref-type="fig" rid="pone-0089543-g007">Figure 7</xref> vs. <xref ref-type="fig" rid="pone-0089543-g004">Figure 4</xref>).</p>
<fig id="pone-0089543-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g007</object-id><label>Figure 7</label><caption>
<title>Frequency distribution of evolutionary rate regimes estimated using MEDUSA, compared with true number of processes.</title>
<p>Phylogenies were simulated under 5 distinct evolutionary scenarios. For each simulation, the number of distinct rate partitions was estimated using the stepwise AICc algorithm as implemented in MEDUSA. Black bars denote true number of processes in generating model. MEDUSA consistently underestimates the true number of processes in simulated datasets when rates of speciation vary through time. Comparable results for BAMM using the same set of simulated datasets are shown in <xref ref-type="fig" rid="pone-0089543-g004">Figure 4</xref>. A total of 500 simulated datasets were analyzed per diversification scenario.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g007" position="float" xlink:type="simple"/></fig>
<p>Branch-specific estimates of speciation rates under MEDUSA were, in general, extremely poor (<xref ref-type="fig" rid="pone-0089543-g008">Figure 8</xref>) when compared to the corresponding estimates under BAMM (<xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref>). The estimated slope of the relationship between the true speciation rates on each branch and the corresponding MEDUSA estimates has a modal value of zero for four of five simulation scenarios (<xref ref-type="fig" rid="pone-0089543-g008">Figure 8</xref>, left column). In contrast, BAMM estimates were far closer to the ‘perfect’ value of 1.0. For all simulation scenarios but exp2, the MEDUSA-estimated speciation rates explained little of the variance in the true distribution of rates (<xref ref-type="fig" rid="pone-0089543-g008">Figure 8</xref>, middle). Finally, proportional error analysis indicated that MEDUSA generally underestimates true rates of speciation when rates are time-dependent or diversity-dependent (<xref ref-type="fig" rid="pone-0089543-g008">Figure 8</xref>, right column).</p>
<fig id="pone-0089543-g008" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g008</object-id><label>Figure 8</label><caption>
<title>Precision and bias of MEDUSA in the estimation of branch-specific rates of speciation.</title>
<p>For each simulated phylogeny, MEDUSA was used to estimate the number, location, and parameters of diversification rate shifts. The resulting branch-specific rates of speciation were compared with the true branch rates from the generating model. Results are based on the same simulated datasets analyzed with BAMM and can be directly compared to those shown in <xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref>. Branch-specific speciation rates estimated with MEDUSA show little correspondence with true rates when rates vary through time, at least in comparison to rates estimated with BAMM.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g008" position="float" xlink:type="simple"/></fig></sec><sec id="s3c">
<title>Empirical Example: Cetacean Radiation</title>
<p>Analysis of the time-calibrated cetacean phylogeny found strong support for a two-process model (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9</xref>). The posterior probability of a one-process model is <italic>p</italic> = 0.017, with a posterior odds ratio of 44.6 in favor of a two-process model. These results suggest a substantial increase in the rate of speciation in the ancestral lineage leading to the Delphinidae (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9A</xref>), possibly excluding the killer whale <italic>Orcinus orca</italic>. The posterior probability of a rate shift occurring on at least one of these branches is greater than 0.975 (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9B</xref>). However, we find little evidence for additional processes within the cetacean phylogeny as a whole (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9</xref> B, C).</p>
<fig id="pone-0089543-g009" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g009</object-id><label>Figure 9</label><caption>
<title>Dynamics of cetacean diversification through time as revealed by BAMM analysis.</title>
<p>(A) Phylogeny of cetaceans <xref ref-type="bibr" rid="pone.0089543-Steeman1">[51]</xref>, with branch lengths drawn proportional to their marginal speciation rate as estimated using BAMM. A large increase in the rate of speciation (&gt;6-fold) occurred in one of the ancestral branches leading to the Delphinidae (including or excluding the killer whale, <italic>Orcinus orca</italic>). Despite this increase, the overall trend is towards decelerating rates through time. (B) Cetacean phylogeny with branch lengths scaled by the posterior probability that they contain a rate shift. Numbers above branches denote branch-specific shift probabilities. The probability that a rate shift occurred on at least one of these three branches was 0.975. No other branches had shift probabilities exceeding 0.02. (C) Posterior distribution of the number of distinct processes (including the root process) on the cetacean phylogeny. A two-process model vastly outperforms a one-process model. (D) Speciation rates through time during the extant cetacean radiation; distinct shaded regions denote (from bottom) 0.05, 0.25, 0.50, 0.75, and 0.95 quantiles on the posterior distribution of rates at a given point in time. Massive spike in mean speciation rates at 7.5 Ma corresponds to the early radiation of the Delphinidae clade. (E) Corresponding extinction through time curve.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g009" position="float" xlink:type="simple"/></fig>
<p>Using output from BAMM, I computed mean rates of speciation and extinction through time during the cetacean radiation. This was done by drawing an imaginary grid of vertical lines through the time-calibrated cetacean phylogeny at equally spaced points in time. Evolutionary rates were estimated as the mean branch-specific rates for all branches that intersected the line corresponding to a specific time point. This enabled estimation of the posterior density of speciation and extinction for any point in time. These results suggest an overall decline in the background rate of whale speciation, with a large spike during the Miocene driven by the radiation of the dolphin clade (Delphinidae). Extinction rates are inferred to be relatively low overall, with a mean per-branch relative extinction rate (<italic>μ</italic>/<italic>λ</italic>) of 0.36.</p>
<p>Finally, I assessed the sensitivity of the cetacean dataset to choice of prior on the number of processes in the phylogeny. I used BAMM to analyze the cetacean data under four additional values of γ (0.1, 0.5, 5, and 10). In each case, the single-process model had low posterior probability and was marginally worth considering (Pr (M<sub>1</sub>) = 0.127) only under the strongest prior (γ = 0.1). For γ = 5 and γ = 10, the posterior probability of a model with a single process was approximately 0. The MAP model had two processes under γ = 0.5 and γ = 5. For γ = 10, the MAP model had four processes, but was not substantially more probable than models with two or three processes. The posterior odds ratio for M<sub>4</sub> versus M<sub>2</sub> was merely 1.63, and for M<sub>4</sub> versus M<sub>3</sub> it was only 1.26. I estimated marginal diversification rates for each branch in the cetacean phylogeny under these prior formulations; pairwise plots for speciation rate estimates under alternative priors suggest that these rates are robust to choice of prior (<xref ref-type="fig" rid="pone-0089543-g010">Figure 10</xref>). Extinction rate estimates were sensitive to choice of prior, although estimated rates were low under all prior formulations.</p>
<fig id="pone-0089543-g010" position="float"><object-id pub-id-type="doi">10.1371/journal.pone.0089543.g010</object-id><label>Figure 10</label><caption>
<title>Sensitivity of marginal rate estimates to prior on Poisson rate parameter.</title>
<p>Each panel shows a pairwise plot comparing branch-specific (marginal) diversification rate estimates for two values of γ for the Cetacean dataset, with results for speciation and extinction separated by the diagonal. Speciation rate estimates for the cetaceans are remarkably robust to choice of prior: even γ = 10 and γ = 0.1 yield strikingly similar marginal distributions for branch-specific speciation rates. This is generally not true for extinction, where mean marginal rates for each branch were more sensitive to prior formulation. However, extinction was nonetheless estimated to be low overall regardless of the prior γ.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pone.0089543.g010" position="float" xlink:type="simple"/></fig></sec></sec><sec id="s4">
<title>Discussion</title>
<p>Extracting information about the tempo and mode of species diversification remains a central methodological challenge in macroevolutionary studies. I developed a Poisson process model of diversification rate variation to address several limitations of current methodological approaches for studying evolutionary dynamics on phylogenetic trees. The approach described here views phylogenetic trees as the outcome of a complex mixture of potentially dynamic evolutionary processes and enables researchers to detect rate shifts, key innovations, time-dependent speciation, and diversity-dependence within single trees. Output from the BAMM implementation of the compound Poisson process model includes (i) estimates of the number of distinct process and posterior probabilities of each possible model; (ii) estimates of locations of those processes as well as associated parameter estimates; and (iii) estimates of branch-specific rates of speciation and extinction, which can further be used to infer temporal trends in evolutionary rates (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9D, E</xref>).</p>
<p>BAMM performed well throughout the parameter space explored here. For each of six distinct macroevolutionary scenarios, BAMM was usually able to identify the true number of processes in the generating model (<xref ref-type="fig" rid="pone-0089543-g003">Figure 3</xref>; <xref ref-type="fig" rid="pone-0089543-g004">Fig. 4</xref>). Branch-specific speciation rates estimated using BAMM are fairly accurate: relative rate differences for estimated rates are centered on 1 (<xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref>, right). Moreover, the OLS regression slope for the relationship between true and estimated branch-specific rates across individual simulation trees was generally close to 1.0; the mean of each distribution of slopes shown in <xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref> (left column) exceeded 0.85. Surprisingly, branch-specific estimates did not decay with increasing complexity of the generating model: observed slopes (<xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref>, left) for the most complex model (DD5) were closer to 1.0 (observed mean: 0.95) and had lower variance than any other simulation scenario, including those with only two processes.</p>
<p>Extinction rate estimates from the model should be taken with caution. Branch specific estimates of extinction are potentially biased and, although these estimates are correlated with the true underlying rates, confidence in those estimates is low (<xref ref-type="table" rid="pone-0089543-t001">Table 1</xref>; <xref ref-type="fig" rid="pone-0089543-g005">Figure 5</xref>). This is consistent with previous studies that have noted low power in estimating extinction rates from molecular phylogenies <xref ref-type="bibr" rid="pone.0089543-Maddison1">[23]</xref>, <xref ref-type="bibr" rid="pone.0089543-Nee2">[52]</xref>. In addition, previous studies have demonstrated that extinction estimates from molecular phylogenies are exceedingly sensitive to violations of model assumptions <xref ref-type="bibr" rid="pone.0089543-Rabosky3">[27]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky8">[53]</xref>. Because few real-world phylogenies will conform perfectly to the assumptions of the model described here, it is likely that estimated extinction rates will be even less accurate than results in <xref ref-type="table" rid="pone-0089543-t001">Table 1</xref> would suggest.</p>
<p>By implementing an exponential change function for speciation, I was able to accurately infer diversity-dependent dynamics across a range of simulation scenarios (<xref ref-type="fig" rid="pone-0089543-g004">Figure 4</xref>; <xref ref-type="fig" rid="pone-0089543-g006">Figure 6</xref>). This is consistent with Quental and Marshall’s <xref ref-type="bibr" rid="pone.0089543-Quental1">[34]</xref> prediction that time-dependent exponential processes (<xref ref-type="disp-formula" rid="pone.0089543.e001">equation 1</xref>) should provide good approximations to linear diversity-dependent processes. It is possible that formal diversity-dependent models <xref ref-type="bibr" rid="pone.0089543-Etienne1">[13]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky6">[48]</xref>, <xref ref-type="bibr" rid="pone.0089543-Etienne2">[54]</xref> would provide increased power and/or precision of parameter estimates over the exponential approximation used in this study. However, fitting a full diversity-dependent model with extinction is far more computationally demanding than the exponential approximation used here. For multiprocess diversity-dependent models, computing a single likelihood currently requires numerically solving large but linear systems of ordinary differential equations. The exponential approximation implemented in BAMM results in extremely fast likelihood calculations on even the largest phylogenetic trees. No attempts have yet been made to parallelize BAMM calculations, affording additional opportunities for computational speedups.</p>
<sec id="s4a">
<title>Comparison to Existing Methods</title>
<p>My results suggest that MEDUSA is not robust to violations of its assumption that diversification rates are constant through time. Whereas BAMM was often able to estimate the true number of distinct processes in the generating model (<xref ref-type="fig" rid="pone-0089543-g004">Figure 4</xref>), MEDUSA consistently underestimated the number of processes (<xref ref-type="fig" rid="pone-0089543-g007">Figure 7</xref>). Furthermore, the magnitude of the underestimates became more severe with increasing model complexity. Speciation rates estimated under MEDUSA were especially poor (<xref ref-type="fig" rid="pone-0089543-g008">Figure 8</xref>) and showed little overall correspondence with true rates in the simulation model.</p>
<p>To be clear, the model implementation in BAMM - in contrast to MEDUSA - was explicitly designed to account for variation in evolutionary rates both through time and among lineages. However, the MEDUSA method has been applied to many empirical datasets with little attention given to the potential consequences of violating the assumption of rate-constancy through time. Using <italic>a posteriori</italic> simulations, Rabosky et al. <xref ref-type="bibr" rid="pone.0089543-Rabosky7">[49]</xref> found that parameter estimates from MEDUSA analyses on higher taxonomic datasets largely fail to predict patterns of species richness across clades. They suggested that this failure results from MEDUSA’s strong assumption of time-invariant speciation and extinction rates. It seems likely that many or most real datasets will be characterized by rate variation through time as well as among lineages. As discussed by O’Meara <xref ref-type="bibr" rid="pone.0089543-OMeara1">[55]</xref>, the challenges of modeling rate heterogeneity in phylogenetic trees are likely to become more severe as we consider ever-larger phylogenetic trees <xref ref-type="bibr" rid="pone.0089543-BinindaEmonds1">[56]</xref>, <xref ref-type="bibr" rid="pone.0089543-Jetz1">[57]</xref>, <xref ref-type="bibr" rid="pone.0089543-Pyron1">[58]</xref>, <xref ref-type="bibr" rid="pone.0089543-Rabosky9">[59]</xref>: the larger the phylogeny, the greater the likelihood that the tree is the result of a heterogeneous mixture of distinct evolutionary processes. Describing the complex mixture of dynamic processes that shape real phylogenetic trees was the primary motivation for proposing the method described in this article.</p>
</sec><sec id="s4b">
<title>Cetacean Macroevolutionary Dynamics</title>
<p>The analysis of the Cetacean phylogeny provides an important window into the history of cetacean diversification through time (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9</xref>) that complements results obtained by several previous studies <xref ref-type="bibr" rid="pone.0089543-Morlon1">[6]</xref>, <xref ref-type="bibr" rid="pone.0089543-Etienne1">[13]</xref>, <xref ref-type="bibr" rid="pone.0089543-Steeman1">[51]</xref>. The overall lineage accumulation curve for cetaceans is relatively flat <xref ref-type="bibr" rid="pone.0089543-Etienne1">[13]</xref>, suggesting relatively little variation in speciation rates through time. However, I find strong support for a multi-process diversification model consisting of two distinct evolutionary rate regimes: a root process involving a weak slowdown in speciation through time (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9A</xref>), and an explosive burst and subsequent slowdown in speciation associated with the origin of the Delphinidae (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9A</xref>). Slater et al. <xref ref-type="bibr" rid="pone.0089543-Slater1">[60]</xref> also found support for a rate shift in the crown delphinids, excluding the killer whale, using MEDUSA. It seems likely that some of the evidence in favor of the “ocean restructuring” model <xref ref-type="bibr" rid="pone.0089543-Steeman1">[51]</xref> actually reflects the independent evolutionary dynamics of delphinid and non-delphinid lineages. The increase in speciation from 13 million years ago (Ma) to 4 Ma in particular seems likely to indicate the rapid diversification of the dolphin clade. My results do not rule out the possibility that ocean restructuring contributed to this clade-specific burst and slowdown in speciation rates, but it appears equally plausible that the acceleration in rates during this interval reflects the occurrence of a key evolutionary innovation early in the history of the dolphins.</p>
</sec><sec id="s4c">
<title>Extensions to the Model</title>
<p>Many extensions are possible within the framework developed here. The computational machinery for adding, moving, and deleting processes from phylogenetic trees is flexible and can easily be extended to allow alternative functional models for speciation and/or extinction rate variation through time. Another obvious future extension is to explicitly account for phylogenetic uncertainty during simulation of the posterior. As currently implemented, BAMM simulates posterior distributions of models and parameters across a fixed topology. However, phylogenetic trees are rarely (if ever) known without error. Credible intervals on parameters inferred using BAMM (<xref ref-type="fig" rid="pone-0089543-g009">Figure 9</xref> D, E) reflect only parametric uncertainty associated with the diversification model itself and would presumably increase if we also accounted for uncertainty in tree topology and branch lengths. Finally, it would be interesting to allow joint inference on paleontological and neontological data, as there is increasing recognition that these two datatypes are frequently in conflict <xref ref-type="bibr" rid="pone.0089543-Quental2">[61]</xref>. This objective is facilitated by theoretical advances that allow evolutionary rate estimation using both fossils and molecular phylogenies <xref ref-type="bibr" rid="pone.0089543-Didier1">[62]</xref>, although suitable datasets remain elusive.</p>
</sec></sec><sec id="s5">
<title>Summary</title>
<p>I have described a methodological framework for inferring mixtures of processes that have influenced the structure of phylogenetic trees. By modeling phylogenies as collections of dynamic processes, the method greatly extends our ability to describe evolutionary dynamics. Most previous evolutionary studies using transdimensional MCMC on phylogenetic trees have assumed that dynamics within component processes are constant in time. By relaxing the assumption of time-homogeneous diversification, the model is better able to describe complex mixtures of both time-constant and time-varying processes. A number of recent studies have suggested that such complex dynamics might dominate speciation-extinction patterns in many empirical datasets. I suggest that the use of rjMCMC to fit time-inhomogeneous multiprocess models to phylogenetic data may have applications beyond those described here, including DNA sequence evolution, phenotypic evolution, and phylogeography.</p>
</sec></body>
<back>
<ack>
<p>I thank M. Alfaro. F. Bokma, R. FitzJohn, L. Harmon, J. Huelsenbeck, S. Kolokotronis, B. Moore, S. Otto, A. Pyron, J. Schraiber, J. Uyeda, and members of the Huelsenbeck lab for comments on the manuscript and/or discussion that improved the results presented here. I thank T. Nan for developing the PPSS code that facilitated parallel analysis of simulated datasets on multiprocessor computers.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pone.0089543-Alroy1"><label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Alroy</surname><given-names>J</given-names></name> (<year>2010</year>) <article-title>The shifting balance of diversity among major marine animal groups</article-title>. <source>Science</source> <volume>321</volume>: <fpage>1191</fpage>–<lpage>1194</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Sepkoski1"><label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sepkoski</surname><given-names>JJ</given-names></name> (<year>1978</year>) <article-title>A kinetic model of Phanerozoic taxonomic diversity I. Analysis of marine orders</article-title>. <source>Paleobiology</source> <volume>4</volume>: <fpage>223</fpage>–<lpage>251</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Mittelbach1"><label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mittelbach</surname><given-names>GG</given-names></name>, <name name-style="western"><surname>Schemske</surname><given-names>DW</given-names></name>, <name name-style="western"><surname>Cornell</surname><given-names>HV</given-names></name>, <name name-style="western"><surname>Allen</surname><given-names>AP</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>JM</given-names></name>, <etal>et al</etal>. (<year>2007</year>) <article-title>Evolution and the latitudinal diversity gradient: speciation, extinction and biogeography</article-title>. <source>Ecology Letters</source> <volume>10</volume>: <fpage>315</fpage>–<lpage>331</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Ricklefs1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ricklefs</surname><given-names>RE</given-names></name> (<year>1987</year>) <article-title>Community diversity - relative roles of local and regional processes</article-title>. <source>Science</source> <volume>235</volume>: <fpage>167</fpage>–<lpage>171</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Glor1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Glor</surname><given-names>RE</given-names></name> (<year>2010</year>) <article-title>Phylogenetic insights on adaptive radiation</article-title>. <source>Ann Rev Ecol Evol Syst</source> <volume>41</volume>: <fpage>251</fpage>–<lpage>270</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Morlon1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Morlon</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Parsons</surname><given-names>TL</given-names></name>, <name name-style="western"><surname>Plotkin</surname><given-names>JB</given-names></name> (<year>2011</year>) <article-title>Reconciling molecular phylogenies with the fossil record</article-title>. <source>Proceedings of the National Academy of Sciences of the United States of America</source> <volume>108</volume>: <fpage>16327</fpage>–<lpage>16332</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Paradis1"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Paradis</surname><given-names>E</given-names></name> (<year>2011</year>) <article-title>Time-dependent speciation and extinction from phylogenies: a least squares approach</article-title>. <source>Evolution</source> <volume>65</volume>: <fpage>661</fpage>–<lpage>672</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Ricklefs2"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ricklefs</surname><given-names>RE</given-names></name> (<year>2007</year>) <article-title>Estimating diversification rates from phylogenetic information</article-title>. <source>Trends in Ecology &amp; Evolution</source> <volume>22</volume>: <fpage>601</fpage>–<lpage>610</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Wagner1"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wagner</surname><given-names>CE</given-names></name>, <name name-style="western"><surname>Harmon</surname><given-names>LJ</given-names></name>, <name name-style="western"><surname>Seehausen</surname><given-names>O</given-names></name> (<year>2012</year>) <article-title>Ecological opportunity and sexual selection together predict adaptive radiation</article-title>. <source>Nature</source> <volume>487</volume>: <fpage>366</fpage>–<lpage>369</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Alroy2"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Alroy</surname><given-names>J</given-names></name> (<year>2008</year>) <article-title>The dynamics of origination and extinction in the marine fossil record</article-title>. <source>Proc Nat Acad Sci USA</source> <volume>105</volume>: <fpage>11536</fpage>–<lpage>11542</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Foote1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Foote</surname><given-names>M</given-names></name> (<year>2000</year>) <article-title>Origination and extinction components of taxonomic diversity: general problems</article-title>. <source>Paleobiology</source> <volume>26</volume>: <fpage>74</fpage>–<lpage>102</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Nee1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Nee</surname><given-names>S</given-names></name>, <name name-style="western"><surname>May</surname><given-names>RM</given-names></name>, <name name-style="western"><surname>Harvey</surname><given-names>PH</given-names></name> (<year>1994</year>) <article-title>The reconstructed evolutionary process</article-title>. <source>Phil Trans R Soc Lond B Biol Sci</source> <volume>344</volume>: <fpage>305</fpage>–<lpage>311</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Etienne1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Etienne</surname><given-names>RS</given-names></name>, <name name-style="western"><surname>Haegeman</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Aze</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Pearson</surname><given-names>PN</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Diversity-dependence brings molecular phylogenies closer to agreement with the fossil record</article-title>. <source>Proc R Soc Lond B Biol Sci</source> <volume>279</volume>: <fpage>1300</fpage>–<lpage>1309</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky1"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Lovette</surname><given-names>IJ</given-names></name> (<year>2008</year>) <article-title>Explosive evolutionary radiations: Decreasing speciation or increasing extinction through time?</article-title> <source>Evolution</source> <volume>62</volume>: <fpage>1866</fpage>–<lpage>1875</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Stadler1"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name> (<year>2011</year>) <article-title>Mammalian phylogeny reveals recent diversification rate shifts</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>108</volume>: <fpage>6187</fpage>–<lpage>6192</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-McPeek1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>McPeek</surname><given-names>MA</given-names></name> (<year>2008</year>) <article-title>Ecological dynamics of clade diversification and community assembly</article-title>. <source>Am Nat</source> <volume>172</volume>: <fpage>E270</fpage>–<lpage>E284</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Morlon2"><label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Morlon</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Potts</surname><given-names>MD</given-names></name>, <name name-style="western"><surname>Plotkin</surname><given-names>JB</given-names></name> (<year>2010</year>) <article-title>Inferring the Dynamics of Diversification: A Coalescent Approach</article-title>. <source>PLoS Biology</source> <volume>8</volume>: <fpage>e1000493</fpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Phillimore1"><label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Phillimore</surname><given-names>AB</given-names></name>, <name name-style="western"><surname>Price</surname><given-names>TD</given-names></name> (<year>2008</year>) <article-title>Density dependent cladogenesis in birds</article-title>. <source>Plos Biology</source> <volume>6</volume>: <fpage>e71</fpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Ruber1"><label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ruber</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Zardoya</surname><given-names>R</given-names></name> (<year>2005</year>) <article-title>Rapid cladogenesis in marine fishes revisited</article-title>. <source>Evolution</source> <volume>59</volume>: <fpage>1119</fpage>–<lpage>1127</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Alfaro1"><label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Alfaro</surname><given-names>ME</given-names></name>, <name name-style="western"><surname>Santini</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Brock</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Alamillo</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Dornburg</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2009</year>) <article-title>Nine exceptional radiations plus high turnover explain species diversity in jawed vertebrates</article-title>. <source>Proc Nat Acad Sci USA</source> <volume>106</volume>: <fpage>13410</fpage>–<lpage>13414</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Slowinski1"><label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Slowinski</surname><given-names>JB</given-names></name>, <name name-style="western"><surname>Guyer</surname><given-names>CG</given-names></name> (<year>1989</year>) <article-title>Testing the stochasticity of patterns of organismal diversity: an imporoved null model</article-title>. <source>American Naturalist</source> <volume>134</volume>: <fpage>907</fpage>–<lpage>921</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-FitzJohn1"><label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>FitzJohn</surname><given-names>R</given-names></name> (<year>2010</year>) <article-title>Quantitative traits and diversification</article-title>. <source>Syst Biol</source> <volume>59</volume>: <fpage>619</fpage>–<lpage>633</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Maddison1"><label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Maddison</surname><given-names>WP</given-names></name>, <name name-style="western"><surname>Midford</surname><given-names>PE</given-names></name>, <name name-style="western"><surname>Otto</surname><given-names>SP</given-names></name> (<year>2007</year>) <article-title>Estimating a binary character’s effect on speciation and extinction</article-title>. <source>Syst Biol</source> <volume>56</volume>: <fpage>701</fpage>–<lpage>710</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Mitter1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mitter</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Farrell</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Wiegmann</surname><given-names>B</given-names></name> (<year>1988</year>) <article-title>The phylogenetic study of adaptive zones - has phytophagy promoted insect diversification?</article-title> <source>American Naturalist</source> <volume>132</volume>: <fpage>107</fpage>–<lpage>128</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Paradis2"><label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Paradis</surname><given-names>E</given-names></name> (<year>2005</year>) <article-title>Statistical analysis of diversification with species traits</article-title>. <source>Evolution</source> <volume>59</volume>: <fpage>1</fpage>–<lpage>12</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky2"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Glor</surname><given-names>RE</given-names></name> (<year>2010</year>) <article-title>Equilibrium speciation dynamics in a model adaptive radiation of island lizards</article-title>. <source>Proc Nat Acad Sci USA</source> <volume>107</volume>: <fpage>22178</fpage>–<lpage>22183</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky3"><label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name> (<year>2010</year>) <article-title>Extinction rates should not be estimated from molecular phylogenies</article-title>. <source>Evolution</source> <volume>64</volume>: <fpage>1816</fpage>–<lpage>1824</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky4"><label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name> (<year>2012</year>) <article-title>Testing the time-for-speciation effect in the assembly of regional biotas</article-title>. <source>Methods Ecol Evol</source> <volume>3</volume>: <fpage>224</fpage>–<lpage>233</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Jonnson1"><label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jonnson</surname><given-names>KA</given-names></name>, <name name-style="western"><surname>Fabre</surname><given-names>P–H</given-names></name>, <name name-style="western"><surname>Fritz</surname><given-names>SA</given-names></name>, <name name-style="western"><surname>Etienne</surname><given-names>RS</given-names></name>, <name name-style="western"><surname>Ricklefs</surname><given-names>RE</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Ecological and evolutionary determinants for the adaptive radiation of the Madagascan vangas</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>109</volume>: <fpage>6620</fpage>–<lpage>6625</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Huelsenbeck1"><label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Larget</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Swofford</surname><given-names>D</given-names></name> (<year>2000</year>) <article-title>A compound Poisson process for relaxing the molecular clock</article-title>. <source>Genetics</source> <volume>154</volume>: <fpage>1879</fpage>–<lpage>1892</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Green1"><label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Green</surname><given-names>PJ</given-names></name> (<year>1995</year>) <article-title>Reversible jump Markov chain Monte Carlo computation and Bayesian model determination</article-title>. <source>Biometrika</source> <volume>82</volume>: <fpage>711</fpage>–<lpage>732</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky5"><label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Donnellan</surname><given-names>SC</given-names></name>, <name name-style="western"><surname>Talaba</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Lovette</surname><given-names>IJ</given-names></name> (<year>2007</year>) <article-title>Exceptional among-lineage variation in diversification rates during the radiation of Australia’s most diverse vertebrate clade</article-title>. <source>Proc R Soc Lond B Biol Sci</source> <volume>274</volume>: <fpage>2915</fpage>–<lpage>2923</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Bartolucci1"><label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bartolucci</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Scaccia</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Mira</surname><given-names>A</given-names></name> (<year>2006</year>) <article-title>Efficient Bayes factor estimation from the reversible jump output</article-title>. <source>Biometrika</source> <volume>93</volume>: <fpage>41</fpage>–<lpage>52</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Quental1"><label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Quental</surname><given-names>TB</given-names></name>, <name name-style="western"><surname>Marshall</surname><given-names>CR</given-names></name> (<year>2009</year>) <article-title>Extinction during evolutionary radiations: reconciling the fossil record with molecular phylogenies</article-title>. <source>Evolution</source> <volume>63</volume>: <fpage>3158</fpage>–<lpage>3167</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Bokma1"><label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bokma</surname><given-names>F</given-names></name> (<year>2008</year>) <article-title>Detection of “punctuated equilibrium” by Bayesian estimation of speciation and extinction rates, ancestral character states, and rates of anagenetic and cladogenetic evolution on a molecular phylogeny</article-title>. <source>Evolution</source> <volume>62</volume>: <fpage>2718</fpage>–<lpage>2726</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Silvestro1"><label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Silvestro</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Schnitzler</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Zizka</surname><given-names>G</given-names></name> (<year>2011</year>) <article-title>A Bayesian framework to estimate diversification rates and their variation through time and space</article-title>. <source>BMC Evol Biol</source> <volume>11</volume>: <fpage>311</fpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Eastman1"><label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Eastman</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>Alfaro</surname><given-names>ME</given-names></name>, <name name-style="western"><surname>Joyce</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Hipp</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Harmon</surname><given-names>LJ</given-names></name> (<year>2011</year>) <article-title>A novel comparative method for identifying shifts in the rate of character evolution on trees</article-title>. <source>Evolution</source> <volume>65</volume>: <fpage>3578</fpage>–<lpage>3589</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Venditti1"><label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Venditti</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Meade</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Pagel</surname><given-names>M</given-names></name> (<year>2011</year>) <article-title>Multiple routes to mammalian diversity</article-title>. <source>Nature</source> <volume>479</volume>: <fpage>393</fpage>–<lpage>396</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Hastings1"><label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hastings</surname><given-names>WK</given-names></name> (<year>1970</year>) <article-title>Monte Carlo sampling methods using Markov chains and their applications</article-title>. <source>Biometrika</source> <volume>57</volume>: <fpage>97</fpage>–<lpage>109</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Metropolis1"><label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Metropolis</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Rosenbluth</surname><given-names>AW</given-names></name>, <name name-style="western"><surname>Rosenbluth</surname><given-names>MN</given-names></name>, <name name-style="western"><surname>Teller</surname><given-names>AH</given-names></name>, <name name-style="western"><surname>Teller</surname><given-names>E</given-names></name> (<year>1953</year>) <article-title>Equations of state calculations by fast computing machines</article-title>. <source>J Chem Phys</source> <volume>21</volume>: <fpage>1087</fpage>–<lpage>1091</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Sisson1"><label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sisson</surname><given-names>SA</given-names></name> (<year>2005</year>) <article-title>Transdimensional Markov Chains</article-title>. <source>J Amer Statist Assoc</source> <volume>100</volume>: <fpage>1077</fpage>–<lpage>1089</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Yang1"><label>42</label>
<mixed-citation publication-type="other" xlink:type="simple">Yang Z (2006) Computational Molecular Evolution: Oxford University Press.</mixed-citation>
</ref>
<ref id="pone.0089543-FitzJohn2"><label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>FitzJohn</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Maddison</surname><given-names>WP</given-names></name>, <name name-style="western"><surname>Otto</surname><given-names>SP</given-names></name> (<year>2009</year>) <article-title>Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies</article-title>. <source>Syst Biol</source> <volume>58</volume>: <fpage>595</fpage>–<lpage>611</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Brock1"><label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Brock</surname><given-names>CD</given-names></name>, <name name-style="western"><surname>Harmon</surname><given-names>LJ</given-names></name>, <name name-style="western"><surname>Alfaro</surname><given-names>ME</given-names></name> (<year>2011</year>) <article-title>Testing for temporal variation in diversification rates when sampling is incomplete and nonrandom</article-title>. <source>Syst Biol</source> <volume>60</volume>: <fpage>410</fpage>–<lpage>419</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Cusimano1"><label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cusimano</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Renner</surname><given-names>SS</given-names></name> (<year>2010</year>) <article-title>Slowdowns in diversification rates from real phylogenies may not be real</article-title>. <source>Systematic Biology</source> <volume>59</volume>: <fpage>458</fpage>–<lpage>464</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Hohna1"><label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hohna</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Ronquist</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Britton</surname><given-names>T</given-names></name> (<year>2011</year>) <article-title>Inferring speciation and extinction rates under different sampling schemes</article-title>. <source>Mol Biol Evol</source> <volume>28</volume>: <fpage>2577</fpage>–<lpage>2589</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Stadler2"><label>47</label>
<mixed-citation publication-type="other" xlink:type="simple">Stadler T (2013) Recovering speciation and extinction dynamics based on phylogenies. J Evol Biol doi: 10.1111/jeb.12139.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky6"><label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Lovette</surname><given-names>IJ</given-names></name> (<year>2008</year>) <article-title>Density-dependent diversification in North American wood warblers</article-title>. <source>Proc R Soc Lond B Biol Sci</source> <volume>275</volume>: <fpage>2363</fpage>–<lpage>2371</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky7"><label>49</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Slater</surname><given-names>GJ</given-names></name>, <name name-style="western"><surname>Alfaro</surname><given-names>ME</given-names></name> (<year>2012</year>) <article-title>Clade age and species richness are decoupled across the Eukaryotic tree of life</article-title>. <source>PLoS Biol</source> <volume>10</volume>: <fpage>e1001381</fpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Harmon1"><label>50</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Harmon</surname><given-names>LJ</given-names></name>, <name name-style="western"><surname>Weir</surname><given-names>JT</given-names></name>, <name name-style="western"><surname>Brock</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Glor</surname><given-names>RE</given-names></name>, <name name-style="western"><surname>Challenger</surname><given-names>WE</given-names></name> (<year>2008</year>) <article-title>GEIGER: Investigating evolutionary radiations</article-title>. <source>Bioinformatics</source> <volume>24</volume>: <fpage>129</fpage>–<lpage>131</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Steeman1"><label>51</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Steeman</surname><given-names>ME</given-names></name>, <name name-style="western"><surname>Hebsgaard</surname><given-names>MB</given-names></name>, <name name-style="western"><surname>Fordyce</surname><given-names>RE</given-names></name>, <name name-style="western"><surname>Ho</surname><given-names>SYW</given-names></name>, <name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name>, <etal>et al</etal>. (<year>2009</year>) <article-title>Radiation of Extant Cetaceans Driven by Restructuring of the Oceans</article-title>. <source>Systematic Biology</source> <volume>58</volume>: <fpage>573</fpage>–<lpage>585</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Nee2"><label>52</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Nee</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name>, <name name-style="western"><surname>May</surname><given-names>RM</given-names></name>, <name name-style="western"><surname>Harvey</surname><given-names>PH</given-names></name> (<year>1994</year>) <article-title>Extinction rates can be estimated from molecular phylogenies</article-title>. <source>Philos Trans R Soc Lond B</source> <volume>344</volume>: <fpage>77</fpage>–<lpage>82</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky8"><label>53</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name> (<year>2010</year>) <article-title>Primary controls on species richness in higher taxa</article-title>. <source>Systematic Biology</source> <volume>59</volume>: <fpage>634</fpage>–<lpage>645</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Etienne2"><label>54</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Etienne</surname><given-names>RS</given-names></name>, <name name-style="western"><surname>Haegeman</surname><given-names>B</given-names></name> (<year>2012</year>) <article-title>A conceptual and statistical Framework for adaptive radiations with a key role for diversity dependence</article-title>. <source>Am Nat</source> <volume>180</volume>: <fpage>E75</fpage>–<lpage>E89</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-OMeara1"><label>55</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>O’Meara</surname><given-names>BC</given-names></name> (<year>2012</year>) <article-title>Evolutionary inferences from phylogenies: a review of methods</article-title>. <source>Ann Rev Ecol Evol Syst</source> <volume>43</volume>: <fpage>267</fpage>–<lpage>285</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-BinindaEmonds1"><label>56</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bininda-Emonds</surname><given-names>ORP</given-names></name>, <name name-style="western"><surname>Cardillo</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Jones</surname><given-names>KE</given-names></name>, <name name-style="western"><surname>MacPhee</surname><given-names>RDE</given-names></name>, <name name-style="western"><surname>Beck</surname><given-names>RMD</given-names></name>, <etal>et al</etal>. (<year>2007</year>) <article-title>The delayed rise of present-day mammals</article-title>. <source>Nature</source> <volume>446</volume>: <fpage>507</fpage>–<lpage>512</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Jetz1"><label>57</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jetz</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Thomas</surname><given-names>GH</given-names></name>, <name name-style="western"><surname>Joy</surname><given-names>JB</given-names></name>, <name name-style="western"><surname>Hartmann</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Mooers</surname><given-names>A</given-names></name> (<year>2012</year>) <article-title>The global diversity of birds in space and time</article-title>. <source>Nature</source> <volume>491</volume>: <fpage>444</fpage>–<lpage>448</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Pyron1"><label>58</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pyron</surname><given-names>RA</given-names></name>, <name name-style="western"><surname>Burbrink</surname><given-names>FT</given-names></name>, <name name-style="western"><surname>Wiens</surname><given-names>JJ</given-names></name> (<year>2013</year>) <article-title>A phylogeny and updated classification of Squamata, including 4161 species of lizards and snakes</article-title>. <source>BMC Evol Biol</source> <volume>13</volume>: <fpage>93</fpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Rabosky9"><label>59</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabosky</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Santini</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Eastman</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>Smith</surname><given-names>SA</given-names></name>, <name name-style="western"><surname>Sidlauskas</surname><given-names>B</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Rates of speciation and morphological evolution are correlated across the largest vertebrate radiation</article-title>. <source>Nature Communications</source> <volume>4</volume>: <fpage>10.1038/ncomms2958</fpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Slater1"><label>60</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Slater</surname><given-names>GJ</given-names></name>, <name name-style="western"><surname>Price</surname><given-names>SA</given-names></name>, <name name-style="western"><surname>Santini</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Alfaro</surname><given-names>ME</given-names></name> (<year>2010</year>) <article-title>Diversity versus disparity and the radiation of modern cetaceans</article-title>. <source>Proc R Soc Lond B Biol Sci</source> <volume>277</volume>: <fpage>3097</fpage>–<lpage>3104</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Quental2"><label>61</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Quental</surname><given-names>TB</given-names></name>, <name name-style="western"><surname>Marshall</surname><given-names>CR</given-names></name> (<year>2010</year>) <article-title>Diversity dynamics: molecular phylogenies need the fossil record</article-title>. <source>Trends Ecol Evol</source> <volume>25</volume>: <fpage>434</fpage>–<lpage>441</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Didier1"><label>62</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Didier</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Royer-Carenzi</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Laurin</surname><given-names>M</given-names></name> (<year>2012</year>) <article-title>The reconstructed evolutionary process with the fossil record</article-title>. <source>J Theor Biol</source> <volume>315</volume>: <fpage>26</fpage>–<lpage>37</lpage>.</mixed-citation>
</ref>
<ref id="pone.0089543-Pybus1"><label>63</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name>, <name name-style="western"><surname>Harvey</surname><given-names>PH</given-names></name> (<year>2010</year>) <article-title>Testing macro-evolutionary models using incomplete molecular phylogenies</article-title>. <source>Proc R Soc B</source> <volume>267</volume>: <fpage>2267</fpage>–<lpage>2272</lpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>