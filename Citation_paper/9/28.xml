<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id><journal-title-group>
<journal-title>PLoS Computational Biology</journal-title></journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-14-01048</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1003919</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Biology and life sciences</subject><subj-group><subject>Computational biology</subject><subj-group><subject>Epigenomics</subject><subject>Evolutionary modeling</subject></subj-group></subj-group><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Evolutionary processes</subject><subj-group><subject>Macroevolution</subject></subj-group></subj-group></subj-group><subj-group><subject>Molecular biology</subject><subj-group><subject>Molecular biology techniques</subject><subj-group><subject>Molecular biology assays and analysis techniques</subject><subj-group><subject>Phylogenetic analysis</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Research and analysis methods</subject><subj-group><subject>Mathematical and statistical techniques</subject><subj-group><subject>Bayesian method</subject></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Bayesian Inference of Sampled Ancestor Trees for Epidemiology and Fossil Calibration</article-title>
<alt-title alt-title-type="running-head">Bayesian Inference of Sampled Ancestor Trees</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Gavryushkina</surname><given-names>Alexandra</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Welch</surname><given-names>David</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Stadler</surname><given-names>Tanja</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>Alexei J.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><label>1</label><addr-line>Department of Computer Science, University of Auckland, Auckland, New Zealand</addr-line></aff>
<aff id="aff2"><label>2</label><addr-line>Allan Wilson Centre for Molecular Ecology and Evolution, Massey University, Palmerston North, New Zealand</addr-line></aff>
<aff id="aff3"><label>3</label><addr-line>Department of Biosystems Science and Engineering, ETH Zürich, Switzerland</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Koelle</surname><given-names>Katia</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>Duke University, United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">alexei@cs.auckland.ac.nz</email> (AJD); <email xlink:type="simple">sasha.gavryushkina@auckland.ac.nz</email> (AG)</corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: AJD AG DW TS. Performed the experiments: AG. Analyzed the data: AG AJD DW TS. Wrote the paper: AG AJD TS DW.</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>12</month><year>2014</year></pub-date>
<pub-date pub-type="epub"><day>4</day><month>12</month><year>2014</year></pub-date>
<volume>10</volume>
<issue>12</issue>
<elocation-id>e1003919</elocation-id>
<history>
<date date-type="received"><day>15</day><month>6</month><year>2014</year></date>
<date date-type="accepted"><day>8</day><month>9</month><year>2014</year></date>
</history>
<permissions>
<copyright-year>2014</copyright-year>
<copyright-holder>Gavryushkina et al</copyright-holder><license xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions>
<abstract>
<p>Phylogenetic analyses which include fossils or molecular sequences that are sampled through time require models that allow one sample to be a direct ancestor of another sample. As previously available phylogenetic inference tools assume that all samples are tips, they do not allow for this possibility. We have developed and implemented a Bayesian Markov Chain Monte Carlo (MCMC) algorithm to infer what we call sampled ancestor trees, that is, trees in which sampled individuals can be direct ancestors of other sampled individuals. We use a family of birth-death models where individuals may remain in the tree process after sampling, in particular we extend the birth-death skyline model [Stadler <italic>et al.</italic>, 2013] to sampled ancestor trees. This method allows the detection of sampled ancestors as well as estimation of the probability that an individual will be removed from the process when it is sampled. We show that even if sampled ancestors are not of specific interest in an analysis, failing to account for them leads to significant bias in parameter estimates. We also show that sampled ancestor birth-death models where every sample comes from a different time point are non-identifiable and thus require one parameter to be known in order to infer other parameters. We apply our phylogenetic inference accounting for sampled ancestors to epidemiological data, where the possibility of sampled ancestors enables us to identify individuals that infected other individuals after being sampled and to infer fundamental epidemiological parameters. We also apply the method to infer divergence times and diversification rates when fossils are included along with extant species samples, so that fossilisation events are modelled as a part of the tree branching process. Such modelling has many advantages as argued in the literature. The sampler is available as an open-source BEAST2 package (<ext-link ext-link-type="uri" xlink:href="https://github.com/CompEvol/sampled-ancestors" xlink:type="simple">https://github.com/CompEvol/sampled-ancestors</ext-link>).</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>A central goal of phylogenetic analysis is to estimate evolutionary relationships and the dynamical parameters underlying the evolutionary branching process (e.g. macroevolutionary or epidemiological parameters) from molecular data. The statistical methods used in these analyses require that the underlying tree branching process is specified. Standard models for the branching process which were originally designed to describe the evolutionary past of present day species do not allow one sampled taxon to be the ancestor of another. However the probability of sampling a direct ancestor is not negligible for many types of data. For example, when fossil and living species are analysed together to infer species divergence times, fossil species may or may not be direct ancestors of living species. In epidemiology, a sampled individual (a host from which a pathogen sequence was obtained) can infect other individuals after sampling, which then go on to be sampled themselves. The models that account for direct ancestors produce phylogenetic trees with a different structure from classic phylogenetic trees and so using these models in inference requires new computational methods. Here we developed a method for phylogenetic analysis that accounts for the possibility of direct ancestors.</p>
</abstract>
<funding-group><funding-statement>AG was funded by The University of Auckland Doctoral Scholarship <ext-link ext-link-type="uri" xlink:href="https://www.auckland.ac.nz/" xlink:type="simple">https://www.auckland.ac.nz/</ext-link>. AJD was funded by a Rutherford Discovery Fellowship from the Royal Society of New Zealand <ext-link ext-link-type="uri" xlink:href="http://www.royalsociety.org.nz" xlink:type="simple">http://www.royalsociety.org.nz</ext-link>. TS is supported in part by the European Research Council under the 7th Framework Programme of the European Commission (PhyPD: Grant Agreement Number 335529). AJD, DW, TS, and AG were partially funded by Marsden grant #UOA1324 from the Royal Society of New Zealand <ext-link ext-link-type="uri" xlink:href="http://www.royalsociety.org.nz/programmes/funds/marsden/awards/2013-awards/" xlink:type="simple">http://www.royalsociety.org.nz/programmes/funds/marsden/awards/2013-awards/</ext-link>. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="15"/></counts><custom-meta-group><custom-meta id="data-availability" xlink:type="simple"><meta-name>Data Availability</meta-name><meta-value>The authors confirm that all data underlying the findings are fully available without restriction. All relevant data are within the paper and its Supporting Information files.</meta-value></custom-meta></custom-meta-group></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>Phylogenetic analysis uses molecular sequence data to infer evolutionary relationships between organisms and to infer evolutionary parameters. Since the introduction of Bayesian inference in phylogenetics <xref ref-type="bibr" rid="pcbi.1003919-Yang1">[1]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Huelsenbeck1">[3]</xref>, it has become the standard approach for fully probabilistic inference of evolutionary history with many popular implementations <xref ref-type="bibr" rid="pcbi.1003919-Drummond1">[4]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Lartillot1">[7]</xref> of Markov chain Monte Carlo (MCMC) <xref ref-type="bibr" rid="pcbi.1003919-Metropolis1">[8]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Hastings1">[9]</xref> sampling over the space of phylogenetic trees. Initial descriptions of Bayesian phylogenetic analysis were restricted to considering bifurcating trees <xref ref-type="bibr" rid="pcbi.1003919-Yang1">[1]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Mau1">[2]</xref>, but have been extended to include explicit polytomies <xref ref-type="bibr" rid="pcbi.1003919-Lewis1">[10]</xref>. Here we tackle phylogenetic inference with trees that may contain sampled ancestors <xref ref-type="bibr" rid="pcbi.1003919-Gavryushkina1">[11]</xref>.</p>
<p>Standard phylogenetic models developed for inferring the evolutionary past of present day species assume that all samples are terminal (leaf) nodes in the estimated phylogenetic tree. However, serially sampled data generated by different evolutionary processes can be analysed using phylogenetic methods <xref ref-type="bibr" rid="pcbi.1003919-Drummond2">[12]</xref> and, in some cases, the assumption that all sampled taxa are leaf nodes is not appropriate.</p>
<p>One case in point is when inferring epidemiological parameters from viral sequence data obtained from infected hosts <xref ref-type="bibr" rid="pcbi.1003919-Pybus1">[13]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Khnert1">[17]</xref>. Viral sequences are obtained from distinct hosts and treated as samples from the transmission process. Using standard phylogenetic models (such as coalescent or birth-death models) to describe the infectious disease transmission process entails the assumption that a host becomes uninfectious at sampling (where sampling is obtaining a sequence or sequences from the pathogen population residing in a single infected host). However in many cases, hosts remain infectious after sampling and, when sampling is sufficiently dense, the probability of sampling an individual that later infects another individual which is also sampled is not negligible <xref ref-type="bibr" rid="pcbi.1003919-Volz1">[18]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Vrancken1">[20]</xref>.</p>
<p>A recent analysis of a well-characterised HIV transmission chain <xref ref-type="bibr" rid="pcbi.1003919-Vrancken1">[20]</xref> employed a hierarchical model of a gene tree inside a transmission tree to infer the differences in evolutionary rates (substitution rates) within and among hosts. Hierarchical modelling of gene trees inside transmission trees has also been used to infer transmission events for small epidemic outbreaks where epidemiological data is available in the form of known infection and recovery times for each host <xref ref-type="bibr" rid="pcbi.1003919-Ypma1">[16]</xref>. In both cases the inference of transmission trees assumes complete sampling of the hosts involved, and the host sampling process is not explicitly modelled.</p>
<p>Incomplete sampling is explicitly accounted for by birth-death-sampling models <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Stadler2">[21]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref>, and the probability density functions of the trees are available in closed form, thus making these models tractable for use in Bayesian inference. The birth-death-sampling models do not assume that individuals are removed from the tree process after the sampling. However, using models that allow for infection after sampling has not been possible due to a lack of software, meaning that many analyses simply ignore the possibility of sampled ancestors <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref>.</p>
<p>Another problem that may require sampled ancestor models is inferring species divergence times using fossil data. Without the means to calibrate the times of divergences, the length of branches in the estimated molecular phylogeny of contemporaneous sequences are typically described in units of expected substitutions per site. Geologically dated fossil data can be employed to calibrate a phylogenetic tree, thus providing absolute branch lengths in calendar units. The most common approach here is to specify age limits or a probability density function on specific divergence times in the phylogeny, where the constraints are defined using the fossil data <xref ref-type="bibr" rid="pcbi.1003919-Sanderson1">[24]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Ho1">[28]</xref>. There are several drawbacks connected to this approach <xref ref-type="bibr" rid="pcbi.1003919-Ronquist2">[29]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>. First, there is potential for inconsistency when applying two priors on the phylogeny <xref ref-type="bibr" rid="pcbi.1003919-Heled1">[31]</xref>: a calibration prior on one or more divergence times and a tree process prior on the entire tree. Second, it is not obvious how to specify a calibration density so that it accurately reflects prior knowledge about divergence times <xref ref-type="bibr" rid="pcbi.1003919-Ronquist2">[29]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>. Finally, such densities usually only use the oldest fossil within a particular clade, thus discarding much of the information available in the fossil record <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>.</p>
<p>Other methods for dating with fossils have been developed recently <xref ref-type="bibr" rid="pcbi.1003919-Laurin1">[32]</xref>. One approach that addresses the problems of the node calibration method requires modelling fossilisation events as a part of the tree process prior. This allows for the joint analysis of fossil and recent taxa together in a unified framework <xref ref-type="bibr" rid="pcbi.1003919-Ronquist2">[29]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Pyron1">[33]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Silvestro1">[36]</xref>. Models that jointly describe the processes of macroevolution and fossilisation should account for possible ancestor-descendant relationships between fossil and living species <xref ref-type="bibr" rid="pcbi.1003919-Foote1">[37]</xref>, and thus include sampled ancestors.</p>
<p>Wilkinson and Tavaré <xref ref-type="bibr" rid="pcbi.1003919-Wilkinson1">[38]</xref> used the inhomogeneous birth-death process with sampled ancestors and approximate Bayesian computation methods to estimate divergence times from fossil records and known features of the extant phylogeny. A birth-death model with sampled ancestors has been used to estimate speciation and extinction rates from phylogenies in <xref ref-type="bibr" rid="pcbi.1003919-Didier1">[22]</xref>. Heath <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref> have used this model (they call it the <italic>fossilized birth-death process</italic>) to explicitly model fossilisation events and estimate divergence times from molecular data and fossil records in a Bayesian framework. In their approach, the tree topology relating the extant species has to be known for the inference <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>. So a method that simultaneously estimates the divergence times and tree topology while modelling incorporation of sampled fossil taxa is an obvious next step.</p>
<p>Full Bayesian MCMC inference using models with sampled ancestors is complicated by the fact that such models produce trees, which we call <italic>sampled ancestor trees</italic> <xref ref-type="bibr" rid="pcbi.1003919-Gavryushkina1">[11]</xref>, that are not strictly binary. They may have sampled nodes that lie on branches, forming an internal node with one direct ancestor and one direct descendent. Thus, modelling sampled ancestors induces a tree space where the tree has a variable number of dimensions (a function of the number of sampled ancestors), which necessitates extensions to the standard MCMC tree sampling algorithms.</p>
<p>Here we describe a reversible-jump MCMC proposal kernel <xref ref-type="bibr" rid="pcbi.1003919-Green1">[39]</xref> to effectively traverse the space of sampled ancestor trees and implement it within the BEAST2 software platform <xref ref-type="bibr" rid="pcbi.1003919-Bouckaert1">[6]</xref>. We study the limitations of birth-death models with sampled ancestors and extend the birth-death skyline model <xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref> to sampled ancestor trees. We apply the new posterior sampler to two types of data: a serially sampled viral data set (from HIV), and molecular phylogeny of bear sequences with fossil samples.</p>
</sec><sec id="s2" sec-type="methods">
<title>Methods</title>
<sec id="s2a">
<title>Tree models with sampled ancestors</title>
<p>In this section, we consider birth-death sampling models <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Stadler2">[21]</xref>–<xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref> under the assumption that sampled individuals are not necessarily removed from the process at sampling. This results in a type of phylogenetic tree that may contain degree two nodes called <italic>sampled ancestors</italic>.</p>
<p>An important characteristic of the models we consider here is incomplete sampling, i.e., we only observe a part of the tree produced by the process. Consider a birth-death process that starts at some point in time (the time of origin) with one lineage and then each existing lineage may bifurcate or go extinct. Further, the lineages are randomly sampled through time. An example of <italic>a full tree</italic> produced by such process is shown in <xref ref-type="fig" rid="pcbi-1003919-g001">Figure 1</xref> on the left. We have information only about the portion of the process that produces the samples, shown as labeled nodes, and do not observe the full tree. Thus we only consider this subtree relating to the sample, which is called the <italic>reconstructed tree</italic> (or the <italic>sampled tree</italic>) and is shown on the right of <xref ref-type="fig" rid="pcbi-1003919-g001">Figure 1</xref>.</p>
<fig id="pcbi-1003919-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g001</object-id><label>Figure 1</label><caption>
<title>Full tree versus reconstructed tree.</title>
<p>A full tree produced by the sampled ancestor birth-death process on the left and a reconstructed tree on the right. The sampled nodes are indicated by dots labeled by letters A through H. Nodes A, B and D are sampled ancestors. The reconstructed tree is represented by a sampled ancestor tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e001" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e002" xlink:type="simple"/></inline-formula> denotes the ranked tree topology and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e003" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e004" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e005" xlink:type="simple"/></inline-formula> denote the node ages. In the reconstructed tree the root is a sampled node. In the skyline model, birth-death parameters vary from interval to interval. There are two intervals in this figure bounded by the time of origin <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e006" xlink:type="simple"/></inline-formula>, parameter shift time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e007" xlink:type="simple"/></inline-formula>, and present time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e008" xlink:type="simple"/></inline-formula>. Between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e009" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e010" xlink:type="simple"/></inline-formula> parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e011" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e012" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e013" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e014" xlink:type="simple"/></inline-formula> apply and between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e015" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e016" xlink:type="simple"/></inline-formula> parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e017" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e018" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e019" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e020" xlink:type="simple"/></inline-formula>. There are additional sampling attempts at times <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e021" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e022" xlink:type="simple"/></inline-formula> with sampling probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e023" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e024" xlink:type="simple"/></inline-formula>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g001" position="float" xlink:type="simple"/></fig><sec id="s2a1">
<title>The sampled ancestor birth-death model</title>
<p>Here we describe a serially-sampled birth-death model with sampled ancestors <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Stadler2">[21]</xref>. First we describe a variant of the model suited to modelling transmission processes and then we extend the model to describe speciation and fossilization processes.</p>
<p>The process begins at the time of origin <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e025" xlink:type="simple"/></inline-formula> measured in time units before the present. Moving towards the present, each existing lineage bifurcates or goes extinct according to two independent Poisson processes with constant rates <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e026" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e027" xlink:type="simple"/></inline-formula>, respectively. Concurrently, each lineage is sampled with Poisson rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e028" xlink:type="simple"/></inline-formula> and is removed from the process at sampling with probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e029" xlink:type="simple"/></inline-formula>. The process is stopped at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e030" xlink:type="simple"/></inline-formula>. This process can be used to model the transmission of infectious disease and we call it <italic>the transmission birth-death process</italic>.</p>
<p>The transmission process involves sampling individuals and produces trees that have degree two nodes corresponding to sampling events when a lineage was sampled but was not removed. We call these trees <italic>sampled ancestor trees</italic> (whether or not any sampled ancestors are present). The reconstructed tree has degree-two nodes when a lineage is sampled but not removed and then it, or a descendent lineage, is sampled again. The reconstructed tree in <xref ref-type="fig" rid="pcbi-1003919-g001">Figure 1</xref> (on the right) is an example of a sampled ancestor tree. Note that the root of a sampled ancestor tree is the most recent common ancestor of the sampled nodes and therefore it may be a sampled node. There is no origin node in the tree because the time of origin is a model parameter and not an outcome of the process.</p>
<p>A tree (or genealogy) <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e031" xlink:type="simple"/></inline-formula> consists of the discrete component <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e032" xlink:type="simple"/></inline-formula>, which is called <italic>a tree topology</italic>, and the continuous component <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e033" xlink:type="simple"/></inline-formula>, which is called <italic>a time vector</italic>. The tree topology of a sampled ancestor tree is <italic>a sampled ancestor phylogenetic tree</italic>, which is a ranked labeled phylogenetic tree with labeled degree-two vertices (a rigorous definition of a sampled ancestor phylogenetic tree can be found in <xref ref-type="bibr" rid="pcbi.1003919-Gavryushkina1">[11]</xref>, where it is called an FRS tree). The time vector is a real-valued vector of the same dimension as the number of ranks (nodes) in the tree topology and with coordinates going in the descending order so that each node in the tree topology can be unambiguously assigned a time from the time vector.</p>
<p>Further, we have three types of nodes: bifurcation nodes, sampled tip nodes, sampled internal nodes. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e034" xlink:type="simple"/></inline-formula> be the number of leaves, then <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e035" xlink:type="simple"/></inline-formula> is the number of bifurcation events. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e036" xlink:type="simple"/></inline-formula> be a vector of bifurcation times, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e037" xlink:type="simple"/></inline-formula>. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e038" xlink:type="simple"/></inline-formula> be a vector of tip times, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e039" xlink:type="simple"/></inline-formula>. Further let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e040" xlink:type="simple"/></inline-formula> be a vector of times of sampled two degree nodes, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e041" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e042" xlink:type="simple"/></inline-formula> is the number of such nodes. Then <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e043" xlink:type="simple"/></inline-formula> can be obtained by combining elements of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e044" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e045" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e046" xlink:type="simple"/></inline-formula> and ordering them in the descending order (see also <xref ref-type="fig" rid="pcbi-1003919-g001">Figure 1</xref>). A genealogy may be written as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e047" xlink:type="simple"/></inline-formula>.</p>
<p>Stadler <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref> derived the density of a genealogy <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e048" xlink:type="simple"/></inline-formula> given the transmission birth-death process parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e049" xlink:type="simple"/></inline-formula> and time of origin <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e050" xlink:type="simple"/></inline-formula>. In <xref ref-type="bibr" rid="pcbi.1003919-Stadler2">[21]</xref>, it was indicated that we should also condition on the event, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e051" xlink:type="simple"/></inline-formula>, of sampling at least one individual because only non-empty samples are observed. The density is<disp-formula id="pcbi.1003919.e052"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e052" xlink:type="simple"/><label>(1)</label></disp-formula>where the function <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e053" xlink:type="simple"/></inline-formula> is the probability that an individual has no sampled descendants for a time span of length <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e054" xlink:type="simple"/></inline-formula> so that <disp-formula id="pcbi.1003919.e055"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e055" xlink:type="simple"/></disp-formula>where <disp-formula id="pcbi.1003919.e056"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e056" xlink:type="simple"/></disp-formula>and <disp-formula id="pcbi.1003919.e057"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e057" xlink:type="simple"/></disp-formula>Throughout this paper, we consider non-oriented labeled trees (in oriented trees, each non-root node is labeled as the left or right child of its parent). So <xref ref-type="disp-formula" rid="pcbi.1003919.e052">equation (1</xref>) differs from the equation on page 350 in <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref>, written for oriented trees, by a factor accounting for the switch from oriented to labeled trees and also by the term for conditioning on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e058" xlink:type="simple"/></inline-formula>. Note also that the definition of the function <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e059" xlink:type="simple"/></inline-formula> here is different from the definition in <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref>.</p>
<p>We show in the Supporting Information (Theorem 2 in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>) that function (1) depends only on three parameters: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e060" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e061" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e062" xlink:type="simple"/></inline-formula>, and does not depend on parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e063" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e064" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e065" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e066" xlink:type="simple"/></inline-formula> independently. This means that the tree model is unidentifiable but, as we show in simulation studies, if we specify one of the parameters we can estimate the others.</p>
<p>When applying this model to data, we typically shift time such that the most recent tip occurs at present, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e067" xlink:type="simple"/></inline-formula>, as we often do not have information about the length of time between the last sample and the end of the sampling effort. This is done to reduce our set of unknown quantities by one (namely setting <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e068" xlink:type="simple"/></inline-formula>).</p>
<p>We extend the model to allow the possibility of sampling individuals at present, where each lineage at time 0 is sampled with probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e069" xlink:type="simple"/></inline-formula>. This process, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e070" xlink:type="simple"/></inline-formula> set to zero (which implies that an individual is not removed from the process after sampling) can be used to model speciation processes with fossilisation events, hence it is called <italic>the fossilized birth-death process</italic> <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e071" xlink:type="simple"/></inline-formula> denote the event of sampling at least one individual at present then according to <xref ref-type="bibr" rid="pcbi.1003919-Stadler2">[21]</xref> and accounting for labeled trees: <disp-formula id="pcbi.1003919.e072"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e072" xlink:type="simple"/><label>(2)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e073" xlink:type="simple"/></inline-formula> is the number of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e074" xlink:type="simple"/></inline-formula>-sampled tips, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e075" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e076" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e077" xlink:type="simple"/></inline-formula> defined as above with <disp-formula id="pcbi.1003919.e078"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e078" xlink:type="simple"/></disp-formula>and <disp-formula id="pcbi.1003919.e079"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e079" xlink:type="simple"/></disp-formula>In contrast to the transmission birth-death process, where only three out of the four parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e080" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e081" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e082" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e083" xlink:type="simple"/></inline-formula> can be inferred, under the fossilized birth-death process, all four parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e084" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e085" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e086" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e087" xlink:type="simple"/></inline-formula> can be identified from the phylogeny as we show in simulation studies.</p>
<p>It is possible to re-write density (2) conditioning on the time of the most recent common ancestor of sampled individuals rather than conditioning on the time of origin. In this case, we discard trees in which the root is a sampled node. In other words, we assume that the process starts with a bifurcation event and we only consider trees with sampled nodes on both sides of the initial bifurcation event. Then the time of the most recent common ancestor of the sample is the time of the root, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e088" xlink:type="simple"/></inline-formula>. Accounting for labeled trees, the probability density function can thus be written <xref ref-type="bibr" rid="pcbi.1003919-Stadler2">[21]</xref> as:<disp-formula id="pcbi.1003919.e089"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e089" xlink:type="simple"/><label>(3)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e090" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e091" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e092" xlink:type="simple"/></inline-formula> are defined as in <xref ref-type="disp-formula" rid="pcbi.1003919.e072">equation (2</xref>).</p>
<p>The probability of an individual sampled at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e093" xlink:type="simple"/></inline-formula> before present to be a sampled ancestor is <disp-formula id="pcbi.1003919.e094"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e094" xlink:type="simple"/></disp-formula>Thus, the fact that an individual is a sampled ancestor depends on whether the individual stays in the process after it is sampled or not (determined by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e095" xlink:type="simple"/></inline-formula>), the rate of population growth (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e096" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e097" xlink:type="simple"/></inline-formula>), sampling rates (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e098" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e099" xlink:type="simple"/></inline-formula>) and the amount of time (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e100" xlink:type="simple"/></inline-formula>) elapsed until present. If the population grows fast and/or the sampling rate is high and/or the amount of time elapsed is large then the probability of an individual sampled at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e101" xlink:type="simple"/></inline-formula> (before present) leaving sampled descendants is high.</p>
</sec><sec id="s2a2">
<title>The sampled ancestor skyline model</title>
<p>Here we extend the sampled ancestor birth-death model so that parameters may change through time in a piecewise manner. This model combines two models from <xref ref-type="bibr" rid="pcbi.1003919-Stadler1">[15]</xref> and <xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref>.</p>
<p>Let there be <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e102" xlink:type="simple"/></inline-formula> time intervals <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e103" xlink:type="simple"/></inline-formula> for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e104" xlink:type="simple"/></inline-formula> defined by vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e105" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e106" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e107" xlink:type="simple"/></inline-formula> (where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e108" xlink:type="simple"/></inline-formula> plays the role of the origin time, i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e109" xlink:type="simple"/></inline-formula>). We use notation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e110" xlink:type="simple"/></inline-formula> for time zero only for convenience and do not include it as a model parameter. Within each interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e111" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e112" xlink:type="simple"/></inline-formula> the constant birth-death parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e113" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e114" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e115" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e116" xlink:type="simple"/></inline-formula> apply. At the end of each interval at times <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e117" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e118" xlink:type="simple"/></inline-formula>, each individual may be sampled with probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e119" xlink:type="simple"/></inline-formula> (see also <xref ref-type="fig" rid="pcbi-1003919-g001">Figure 1</xref>). Thus, the model has <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e120" xlink:type="simple"/></inline-formula> parameters: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e121" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e122" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e123" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e124" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e125" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e126" xlink:type="simple"/></inline-formula>. We prove in the Supporting Information (Theorem 1 in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>) that the probability density of a reconstructed sampled ancestor tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e127" xlink:type="simple"/></inline-formula> produced by this process is (not conditioned on survival), <disp-formula id="pcbi.1003919.e128"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e128" xlink:type="simple"/><label>(4)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e129" xlink:type="simple"/></inline-formula> is the number of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e130" xlink:type="simple"/></inline-formula>-sampled tips; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e131" xlink:type="simple"/></inline-formula> is the number of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e132" xlink:type="simple"/></inline-formula>-sampled nodes that have sampled descendants; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e133" xlink:type="simple"/></inline-formula> is the number of tips sampled at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e134" xlink:type="simple"/></inline-formula>; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e135" xlink:type="simple"/></inline-formula> is the number of nodes sampled at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e136" xlink:type="simple"/></inline-formula> and having sampled descendants; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e137" xlink:type="simple"/></inline-formula> is the total number of nodes sampled at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e138" xlink:type="simple"/></inline-formula>; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e139" xlink:type="simple"/></inline-formula> is the number of lineages present in the tree at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e140" xlink:type="simple"/></inline-formula> but not sampled at this time for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e141" xlink:type="simple"/></inline-formula>; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e142" xlink:type="simple"/></inline-formula>; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e143" xlink:type="simple"/></inline-formula>; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e144" xlink:type="simple"/></inline-formula> is an index such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e145" xlink:type="simple"/></inline-formula>; and functions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e146" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e147" xlink:type="simple"/></inline-formula> are defined presently.</p>
<p>The probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e148" xlink:type="simple"/></inline-formula> that an individual alive at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e149" xlink:type="simple"/></inline-formula> has no sampled descendants when the process is stopped (i.e., in the time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e150" xlink:type="simple"/></inline-formula>), with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e151" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e152" xlink:type="simple"/></inline-formula>) is <disp-formula id="pcbi.1003919.e153"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e153" xlink:type="simple"/></disp-formula>where <disp-formula id="pcbi.1003919.e154"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e154" xlink:type="simple"/></disp-formula>and <disp-formula id="pcbi.1003919.e155"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e155" xlink:type="simple"/></disp-formula>for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e156" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e157" xlink:type="simple"/></inline-formula>. Further, <disp-formula id="pcbi.1003919.e158"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e158" xlink:type="simple"/></disp-formula>for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e159" xlink:type="simple"/></inline-formula>. Note that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e160" xlink:type="simple"/></inline-formula> does not appear in the equation because <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e161" xlink:type="simple"/></inline-formula> (which is the number of lineages present in the tree at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e162" xlink:type="simple"/></inline-formula> but not sampled at that time) and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e163" xlink:type="simple"/></inline-formula> (which is the number of two degree nodes at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e164" xlink:type="simple"/></inline-formula>) are always zero. Also, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e165" xlink:type="simple"/></inline-formula> cancels out because <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e166" xlink:type="simple"/></inline-formula> is always zero and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e167" xlink:type="simple"/></inline-formula>.</p>
<p>We obtain two special cases of this general model that correspond to the skyline variants of the transmission and fossilized birth-death processes by setting some of the parameters to zero.</p>
<p>To obtain the skyline transmission process, we set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e168" xlink:type="simple"/></inline-formula>. This implies <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e169" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e170" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e171" xlink:type="simple"/></inline-formula> for all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e172" xlink:type="simple"/></inline-formula>. As before, we condition on the event, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e173" xlink:type="simple"/></inline-formula>, of sampling at least one individual, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e174" xlink:type="simple"/></inline-formula>. The tree density is <disp-formula id="pcbi.1003919.e175"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e175" xlink:type="simple"/><label>(5)</label></disp-formula>We show in the Supporting Information (Theorem 2 in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>) that (5) can be re-parameterised with <disp-formula id="pcbi.1003919.e176"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e176" xlink:type="simple"/><label>(6)</label></disp-formula>Thus, of the original <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e177" xlink:type="simple"/></inline-formula> parameters, only <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e178" xlink:type="simple"/></inline-formula> may be estimated.</p>
<p>For the skyline fossilized birth-death model, we set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e179" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e180" xlink:type="simple"/></inline-formula> and condition on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e181" xlink:type="simple"/></inline-formula>, the event of sampling at least one extant individual (i.e., at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e182" xlink:type="simple"/></inline-formula>). The tree density becomes<disp-formula id="pcbi.1003919.e183"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e183" xlink:type="simple"/><label>(7)</label></disp-formula>where <disp-formula id="pcbi.1003919.e184"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e184" xlink:type="simple"/></disp-formula>This probability density can be re-parameterised as in (6) with one additional equation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e185" xlink:type="simple"/></inline-formula> (see <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>). Now there are <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e186" xlink:type="simple"/></inline-formula> initial parameters: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e187" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e188" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e189" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e190" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e191" xlink:type="simple"/></inline-formula> equations defining the re-parameterisation. Since <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e192" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e193" xlink:type="simple"/></inline-formula> defines <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e194" xlink:type="simple"/></inline-formula>, then <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e195" xlink:type="simple"/></inline-formula> yields <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e196" xlink:type="simple"/></inline-formula>, then <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e197" xlink:type="simple"/></inline-formula> yields <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e198" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e199" xlink:type="simple"/></inline-formula> yields <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e200" xlink:type="simple"/></inline-formula> and the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e201" xlink:type="simple"/></inline-formula> equations for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e202" xlink:type="simple"/></inline-formula> are not needed at all, thus <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e203" xlink:type="simple"/></inline-formula> equations define the re-parameterisation of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e204" xlink:type="simple"/></inline-formula> parameters and this re-parameterisation does not reduce the number of parameters.</p>
</sec></sec><sec id="s2b">
<title>Markov chain Monte Carlo operators</title>
<p>We introduce a number of operators to explore the space of sampled ancestor trees with a fixed number of sampled nodes. Throughout this section, we denote the height (or the age) of a node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e205" xlink:type="simple"/></inline-formula> by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e206" xlink:type="simple"/></inline-formula>.</p>
<sec id="s2b1">
<title>Extension of the Wilson-Balding operator</title>
<p>We extend the Wilson-Balding operator (a type of subtree prune and regraft) <xref ref-type="bibr" rid="pcbi.1003919-Wilson1">[40]</xref> to sampled ancestor trees so that it is identical to the original implementation in BEAST <xref ref-type="bibr" rid="pcbi.1003919-Drummond4">[41]</xref> when it is restricted to trees with no sampled ancestors. The operator may propose a significant change to a tree and may change its dimension, that is, the number of nodes in the tree. We use the reversible jump formalism of <xref ref-type="bibr" rid="pcbi.1003919-Green1">[39]</xref>.</p>
<p>First, we describe a reduced version of the operator that does not change the root. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e207" xlink:type="simple"/></inline-formula> be a genealogy. There are three steps in proposing a new tree.</p>
<list list-type="order"><list-item>
<p>Choose edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e208" xlink:type="simple"/></inline-formula> uniformly at random such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e209" xlink:type="simple"/></inline-formula> is not the root (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e210" xlink:type="simple"/></inline-formula> is the parent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e211" xlink:type="simple"/></inline-formula>). Recall that we do not consider the origin as a node belonging to the tree.</p>
</list-item><list-item>
<p>Choose either edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e212" xlink:type="simple"/></inline-formula> or leaf <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e213" xlink:type="simple"/></inline-formula>. The method of selection depends on the type of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e214" xlink:type="simple"/></inline-formula>:</p>
<list list-type="alpha-lower"><list-item>
<p>if node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e215" xlink:type="simple"/></inline-formula> has a sibling then, uniformly at random from all possibilities, either choose edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e216" xlink:type="simple"/></inline-formula> which is not adjacent to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e217" xlink:type="simple"/></inline-formula> and at least one end of which is above <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e218" xlink:type="simple"/></inline-formula> (i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e219" xlink:type="simple"/></inline-formula> is older than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e220" xlink:type="simple"/></inline-formula>) or leaf <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e221" xlink:type="simple"/></inline-formula> which is older than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e222" xlink:type="simple"/></inline-formula>;</p>
</list-item><list-item>
<p>if node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e223" xlink:type="simple"/></inline-formula> does not have a sibling (so <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e224" xlink:type="simple"/></inline-formula> has only one child, i.e., it has degree two and thus is a sampled node) then choose edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e225" xlink:type="simple"/></inline-formula> such that at least one of its ends is older than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e226" xlink:type="simple"/></inline-formula> or a leaf which is older than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e227" xlink:type="simple"/></inline-formula> uniformly at random.</p>
</list-item></list>
</list-item></list>
<p>If there is no such edge nor leaf then the proposal is rejected.</p>
<list list-type="simple"><list-item>
<p>3. If an item was chosen in step 2, then prune the subtree rooted at node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e228" xlink:type="simple"/></inline-formula> and reattach it to edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e229" xlink:type="simple"/></inline-formula> or leaf <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e230" xlink:type="simple"/></inline-formula>. When attaching to an edge, we draw a new height for the parent of node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e231" xlink:type="simple"/></inline-formula> uniformly at random from the interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e232" xlink:type="simple"/></inline-formula>.</p>
</list-item></list>
<p><xref ref-type="fig" rid="pcbi-1003919-g002">Figure 2</xref> illustrates pruning from a branch (case 2a) and from a node (case 2b) and attaching to a branch and to a leaf. Let the resulting new genealogy be <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e233" xlink:type="simple"/></inline-formula>.</p>
<fig id="pcbi-1003919-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g002</object-id><label>Figure 2</label><caption>
<title>The Wilson Balding operator.</title>
<p>The operator proposes a sampled ancestor tree topology and node ages and may propose a tree of larger or smaller dimension (the number of nodes in the tree) than the original tree. First, it prunes a subtree rooted at edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e234" xlink:type="simple"/></inline-formula> (blue edge) either from a branch, coloured black, in case a.1 or from a node, coloured black, in case a.2. Then it attaches the subtree either to an edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e235" xlink:type="simple"/></inline-formula> (black edge) at a random height in case b.1 or to a leaf <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e236" xlink:type="simple"/></inline-formula> (black node) in case b.2. Case a.1 followed by b.2 removes a node from the tree and case a.2 followed by b.1 introduces a new node into the tree.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g002" position="float" xlink:type="simple"/></fig>
<p>Now we extend this move to add the possibility of changing the root. We modify the described procedure as follows. We allow <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e237" xlink:type="simple"/></inline-formula> for which <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e238" xlink:type="simple"/></inline-formula> is the root to be chosen at the first step, and we allow the root edge (i.e., the edge which connects the root with the origin) to be chosen at the second step. Although we do not usually consider this edge as a part of the tree, for convenience we assume we can choose it. In this case, the parent of node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e239" xlink:type="simple"/></inline-formula> becomes a new root with the height obtained by drawing a difference between the new root height and the old root height from the exponential distribution with rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e240" xlink:type="simple"/></inline-formula>.</p>
<p>To calculate the Hastings ratio, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e241" xlink:type="simple"/></inline-formula>, for this move we derive the proposal density, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e242" xlink:type="simple"/></inline-formula>. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e243" xlink:type="simple"/></inline-formula> is a product of the probability of choosing edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e244" xlink:type="simple"/></inline-formula> at the first step, the probability of choosing edge <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e245" xlink:type="simple"/></inline-formula> (or leaf <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e246" xlink:type="simple"/></inline-formula>) at the second step, and the probability density of choosing a new age at the third stage (or one if we attach to a leaf).</p>
<p>Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e247" xlink:type="simple"/></inline-formula> denote the number of edges in tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e248" xlink:type="simple"/></inline-formula>. Then the contribution of the first step to the proposal density is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e249" xlink:type="simple"/></inline-formula>. The probability at the second step depends on the number of choices there. However, since we choose the same subtree to prune in the forward and backward moves and then, at step two, choose from the items remaining in the tree after pruning the subtree, the second terms in the product will cancel in the ratio and we do not calculate them.</p>
<p>The contribution of the third step depends on the type of move. When attaching to a leaf it is equal to one. When attaching to a branch it is equal to the probability density of a random variable <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e250" xlink:type="simple"/></inline-formula> which defines a new age for the parent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e251" xlink:type="simple"/></inline-formula>. So it is either <disp-formula id="pcbi.1003919.e252"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e252" xlink:type="simple"/></disp-formula>or <disp-formula id="pcbi.1003919.e253"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e253" xlink:type="simple"/></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e254" xlink:type="simple"/></inline-formula> denotes the height of node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e255" xlink:type="simple"/></inline-formula>. The Hastings ratio for the different cases is summarised in <xref ref-type="table" rid="pcbi-1003919-t001">Table 1</xref>.</p>
<table-wrap id="pcbi-1003919-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.t001</object-id><label>Table 1</label><caption>
<title>Hastings ratio for the extension of the Wilson Balding operator.</title>
</caption><alternatives><graphic id="pcbi-1003919-t001-1" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.t001" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" rowspan="1" colspan="1">Pruning from/Attaching to</td>
<td align="left" rowspan="1" colspan="1">internal branch</td>
<td align="left" rowspan="1" colspan="1">leaf</td>
<td align="left" rowspan="1" colspan="1">root branch</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">internal branch</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e256" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e257" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e258" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">internal node</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e259" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e260" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e261" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">root branch</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e262" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e263" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">-</td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt101"><label/><p>The table summarises the Hastings ratio <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e264" xlink:type="simple"/></inline-formula> for the extended Wilson Balding operator.</p></fn></table-wrap-foot></table-wrap></sec><sec id="s2b2">
<title>Leaf to sampled ancestor jump</title>
<p>This is a dimension changing move that jumps between two trees where a particular sampled node is a sampled ancestor in one tree and a leaf in the other. The proposal starts by randomly choosing a sampled node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e265" xlink:type="simple"/></inline-formula>. If <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e266" xlink:type="simple"/></inline-formula> is a sampled ancestor, we propose a new tree where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e267" xlink:type="simple"/></inline-formula> is a leaf as follows. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e268" xlink:type="simple"/></inline-formula> be the parent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e269" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e270" xlink:type="simple"/></inline-formula> be the child of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e271" xlink:type="simple"/></inline-formula>. Create a new node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e272" xlink:type="simple"/></inline-formula> with height chosen uniformly at random from the interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e273" xlink:type="simple"/></inline-formula>. Make <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e274" xlink:type="simple"/></inline-formula> the parent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e275" xlink:type="simple"/></inline-formula> and make <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e276" xlink:type="simple"/></inline-formula> (now a leaf) and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e277" xlink:type="simple"/></inline-formula> the children of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e278" xlink:type="simple"/></inline-formula>.</p>
<p>If <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e279" xlink:type="simple"/></inline-formula> is a leaf then it becomes a sampled ancestor replacing its parent if possible. It is not possible if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e280" xlink:type="simple"/></inline-formula> has no sibling or the sibling of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e281" xlink:type="simple"/></inline-formula> is older than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e282" xlink:type="simple"/></inline-formula>. When this is possible, let node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e283" xlink:type="simple"/></inline-formula> be the parent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e284" xlink:type="simple"/></inline-formula> in the proposed tree. The Hastings ratio for this move is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e285" xlink:type="simple"/></inline-formula> when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e286" xlink:type="simple"/></inline-formula> is a sampled ancestor and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e287" xlink:type="simple"/></inline-formula> when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e288" xlink:type="simple"/></inline-formula> is a leaf.</p>
<p>Note that these same trees can be proposed under the extended Wilson-Balding operator. We introduce this more specific, or local, operator to improve mixing.</p>
</sec><sec id="s2b3">
<title>Other operators</title>
<p>We extend the narrow and wide exchange operators used in BEAST2 <xref ref-type="bibr" rid="pcbi.1003919-Bouckaert1">[6]</xref> to sampled ancestor trees. The narrow exchange operator swaps a randomly chosen node with its aunt if possible. It chooses a non-root node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e289" xlink:type="simple"/></inline-formula> such that its parent <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e290" xlink:type="simple"/></inline-formula> is not the root either. If the parent <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e291" xlink:type="simple"/></inline-formula> of node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e292" xlink:type="simple"/></inline-formula> is not a sampled node and, therefore, has another child <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e293" xlink:type="simple"/></inline-formula> and the height of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e294" xlink:type="simple"/></inline-formula> is less than the height of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e295" xlink:type="simple"/></inline-formula> then we remove edges <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e296" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e297" xlink:type="simple"/></inline-formula> and add edges <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e298" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e299" xlink:type="simple"/></inline-formula>. Otherwise the proposal is rejected. The wide exchange operator swaps two randomly chosen nodes along with the subtrees descendant from these nodes if none of them is a parent to another one and the ages of the parents allow to swap the children. The Hastings ratio is 1 for both operators.</p>
<p>To propose height changes we use a scale operator and a uniform operator. The scale operator scales non-sampled internal nodes by a scale factor drawn from the uniform distribution on the interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e300" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e301" xlink:type="simple"/></inline-formula>. If the scaling makes some parent node younger than either of its children then the proposal is rejected. The Hastings ratio for this operator is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e302" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e303" xlink:type="simple"/></inline-formula> is the scale factor and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e304" xlink:type="simple"/></inline-formula> is the number of internal non-sampled nodes (the number of scaled dimensions). The uniform operator proposes a new height for internal nodes chosen uniformly at random from the interval bounded by the heights of the parent and the oldest child of the chosen node. The Hastings ratio for this operator is 1.</p>
</sec></sec><sec id="s2c">
<title>Simulations and empirical data analysis</title>
<sec id="s2c1">
<title>Simulating the fossilized birth-death process</title>
<p>We simulated 100 trees under the fossilized birth-death model (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e305" xlink:type="simple"/></inline-formula>-sampling and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e306" xlink:type="simple"/></inline-formula>). We fix the tree model parameters in this simulation:<disp-formula id="pcbi.1003919.e307"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e307" xlink:type="simple"/></disp-formula><disp-formula id="pcbi.1003919.e308"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e308" xlink:type="simple"/></disp-formula><disp-formula id="pcbi.1003919.e309"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e309" xlink:type="simple"/></disp-formula>Since the time of the origin is one of the model parameters, we simulate each tree on the time interval of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e310" xlink:type="simple"/></inline-formula>. We discard trees with less than five sampled nodes, which constitute 8% of the simulated trees. The remaining trees have 55 sampled nodes on average. Then we simulated sequences along each tree under the GTR model with a strict molecular clock model and ran the MCMC with the sequences and sampled node dates as the input data. Note that the simulated data includes sequences for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e311" xlink:type="simple"/></inline-formula>-sampled nodes. For these runs, we use the re-parameterisation: <disp-formula id="pcbi.1003919.e312"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e312" xlink:type="simple"/><label>(8)</label></disp-formula>along with the time of origin, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e313" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e314" xlink:type="simple"/></inline-formula>. The sampling proportion is the proportion of individuals which are sampled before they are removed, meaning it is the proportion of sampled individuals out of all individuals in the full tree. In this parameterisation there are only two parameters (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e315" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e316" xlink:type="simple"/></inline-formula>) on the unbounded interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e317" xlink:type="simple"/></inline-formula> with the others are defined on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e318" xlink:type="simple"/></inline-formula>, making it a convenient parametrisation for defining uninformative priors. For the tree prior distribution we use the distribution with probability density function (2) multiplied by priors for hyper parameters: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e319" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e320" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e321" xlink:type="simple"/></inline-formula> Uniform(0,1) for and Uniform(0,1000) for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e322" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e323" xlink:type="simple"/></inline-formula>.</p>
<p>We estimate a tree, macroevolutionary parameters, GTR rates, and the clock rate. The parameters of interest include the macroevolutionary parameters (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e324" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e325" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e326" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e327" xlink:type="simple"/></inline-formula>) and features of the tree including the time of the origin (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e328" xlink:type="simple"/></inline-formula>), tree height and the number of sampled ancestors.</p>
<p>Further, we use the same simulated data to investigate the inferential power of the fossilised birth-death model in the absence of molecular data for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e329" xlink:type="simple"/></inline-formula>-sampled nodes (e.g. to represent fossil samples in real data sets). We ran the MCMC with sequence data from contemporaneously sampled nodes and only sampling dates (but not sequences) for the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e330" xlink:type="simple"/></inline-formula>-sampled nodes. Since the input data does not contain the topological locations of fossil nodes, we also need to fix one of the parameters to the truth. We chose to fix sampling probability, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e331" xlink:type="simple"/></inline-formula>, because it is likely to be known in analyses of real datasets. Note that we sample full genealogies, which include both extant and fossil samples. It is impossible to estimate the topological position of the fossil nodes without sequence or morphological data but sampling full genealogies accounts for this uncertainty.</p>
</sec><sec id="s2c2">
<title>Simulating the transmission birth-death process</title>
<p>In our second set of simulations, there is no <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e332" xlink:type="simple"/></inline-formula>-sampling but <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e333" xlink:type="simple"/></inline-formula>. Here we again use <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e334" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e335" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e336" xlink:type="simple"/></inline-formula> parametrisation defined by <xref ref-type="disp-formula" rid="pcbi.1003919.e312">Equations (8</xref>). We fix the time of the origin, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e337" xlink:type="simple"/></inline-formula>, and draw the tree model parameters from the distributions <disp-formula id="pcbi.1003919.e338"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e338" xlink:type="simple"/></disp-formula>and simulate a tree under the transmission birth-death process with drawn parameters on the fixed time interval. We choose these prior distributions because they cover a wide range of parameter combinations of interest and produce trees of reasonable size. We discard trees with less than 5 or greater than 250 sampled nodes, which constitute 21% of the sample. In total, we report the results on 100 trees with the mean number of sampled nodes being 53. We simulate sequences along each tree under the GTR model with a strict molecular clock.</p>
<p>In the MCMC runs, we fix the sampling proportion, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e339" xlink:type="simple"/></inline-formula>, to its true value as only three out of the four transmission birth-death parameters can be inferred. We chose to fix <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e340" xlink:type="simple"/></inline-formula> because it is one of the parameters about which there is likely strong prior knowledge in a typical epidemiological study. The tree prior distribution is (1) with uniform prior distributions for hyper parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e341" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e342" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e343" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e344" xlink:type="simple"/></inline-formula>, on the same intervals as above and Uniform(0,1000) prior distribution for the time of the origin. We estimate the tree, tree model parameters, GTR rates and clock rate and assess the estimates of the tree model parameters and properties of the tree.</p>
<p>To assess the bias introduced by model misspecification we also analyse these simulated datasets under the tree prior model without sampled ancestors, that is, we fix the removal probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e345" xlink:type="simple"/></inline-formula> to one for the inference. Fixing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e346" xlink:type="simple"/></inline-formula> to one results in any tree with sampled ancestors having probability density zero. Thus any proposed tree with sampled ancestors is rejected in the MCMC which is equivalent to not allowing sampled ancestor trees.</p>
</sec><sec id="s2c3">
<title>Simulating under the sampled ancestor skyline model</title>
<p>We simulated the skyline transmission process under three different sets of parameters and then estimated the parameters in MCMC with fixed trees and with some parameters fixed. We have tried scenarios with two and three intervals, fixing either <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e347" xlink:type="simple"/></inline-formula> or <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e348" xlink:type="simple"/></inline-formula>. In one scenario, only <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e349" xlink:type="simple"/></inline-formula> changes through time from zero to a non-zero value and the other parameters stay constant. In the second scenario, all parameters except <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e350" xlink:type="simple"/></inline-formula> change through time. In the final scenario, all parameters change through time and the whole vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e351" xlink:type="simple"/></inline-formula> is fixed in the inference. For a full description of the parameter and prior settings see <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>.</p>
</sec><sec id="s2c4">
<title>Bear dataset analysis</title>
<p>We re-analyzed the bear dataset from <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref> comprised of sequence data of 10 extant species and occurrence dates of 24 fossil samples, assigned to six clades. Heath <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref> assume that the tree topology on the extant species is known and each fossil sample is assigned to a clade in the tree, i.e., each fossil sample is constrained to be a descendant of a particular node in the extant tree. Here, we replicate this analysis using the MCMC implementation of the fossilized birth-death model in BEAST2.</p>
<p>The fossilized birth-death model we use is the same model as in the original analysis by Heath <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref> but we use a strict clock instead of a relaxed molecular clock model. We perform two analyses, both with a strict clock, using our implementation in BEAST2 and the implementation in DPPDiv by Heath <italic>et al</italic>.</p>
<p>The tree prior density is (3) with transformed parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e352" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e353" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e354" xlink:type="simple"/></inline-formula> for which we chose uniform priors and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e355" xlink:type="simple"/></inline-formula> is fixed. We use the strict molecular clock with an exponential prior for the clock rate and the GTR model with gamma categories with uniform priors for GTR rates and gamma shape.</p>
<p>The prior distributions in both analyses (in BEAST2 and DPPDiv) are all the same except the priors for GTR rates and gamma shape. In DPPDiv, <disp-formula id="pcbi.1003919.e356"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e356" xlink:type="simple"/></disp-formula>In BEAST2, we fix <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e357" xlink:type="simple"/></inline-formula> to one and use Uniform(0, 100) priors for other rates. We used a uniform prior for the gamma shape parameter in BEAST2 and an exponential prior in DPPDiv.</p>
</sec><sec id="s2c5">
<title>HIV 1 dataset analysis</title>
<p>We re-analyzed UK HIV-1 subtype B data from <xref ref-type="bibr" rid="pcbi.1003919-Hu1">[42]</xref> consisting of viral sequences obtained from 62 patients (one sequence per patient). We use the skyline model without <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e358" xlink:type="simple"/></inline-formula>-sampling and with one rate shift time (in 1999) because no samples were taken before this time. The tree prior density is (5). We use the following parameterisation and prior distributions: <disp-formula id="pcbi.1003919.e359"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e359" xlink:type="simple"/></disp-formula></p>
<p><disp-formula id="pcbi.1003919.e360"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e360" xlink:type="simple"/></disp-formula><disp-formula id="pcbi.1003919.e361"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e361" xlink:type="simple"/></disp-formula><disp-formula id="pcbi.1003919.e362"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e362" xlink:type="simple"/></disp-formula><disp-formula id="pcbi.1003919.e363"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003919.e363" xlink:type="simple"/></disp-formula>The leaf sampling proportion is the proportion of individuals who are removed by sampling out of all removed individuals, thus it is the proportion of sampled tips out of all tips in the full tree. The parameterisation and prior distributions are different from the distributions used in simulation studies. We chose the prior distributions for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e364" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e365" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e366" xlink:type="simple"/></inline-formula> following <xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref> and the prior distribution for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e367" xlink:type="simple"/></inline-formula> assuming that diagnosed patients are likely to change their behaviour. Recall that this model is unidentifiable and we need to have a good prior knowledge about at least one of the parameters.</p>
<p>We suppose that only leaf sampling proportion changes through time and it changes from zero to a non-zero value in year 1999. Other parameters stay constant through time. We use a GTR model with gamma categories and a molecular clock model with the substitution rate fixed to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e368" xlink:type="simple"/></inline-formula> as was estimated in <xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref>.</p>
</sec></sec></sec><sec id="s3">
<title>Results</title>
<p>We developed a Bayesian MCMC framework for phylogenetic inference with models that allow sampled ancestors. We implemented a sampled ancestor MCMC algorithm as an add-on to software package BEAST2 <xref ref-type="bibr" rid="pcbi.1003919-Bouckaert1">[6]</xref> thereby making several sampled ancestor birth-death prior models available to users. We test the accuracy and limitations of these models in simulation studies and apply the sampler to infer divergence times for a biological dataset comprised of extant species and fossil samples and to an HIV dataset. In the case of the fossil-bear dataset, we compare the results obtained from our implementation to the result obtained from an alternative implementation <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>.</p>
<sec id="s3a">
<title>Simulation of sampled ancestor models</title>
<p>We simulated the sampled ancestor birth-death process and sampled ancestor skyline process under different scenarios. In all cases, the simulations show that we can recover the tree and model parameters from sequence data and sampling times. In the analyses where sampled ancestors were not accounted for, the estimates of the tree branching model parameters and clock rate were biased. The bias and low accuracy were the most pronounced for the birth rate (or diversification rate in the alternative parameterisation).</p>
<p>For some variants of the model, one of the tree model parameters has to be fixed for the inference to its true value as was discussed in the <xref ref-type="sec" rid="s2">Methods</xref> section. Simulation studies show that fixing one of the parameters allows the recovery of the remaining parameter values. In particular, we showed that function (1) depends exactly on three parameters because fixing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e369" xlink:type="simple"/></inline-formula> allows recovery of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e370" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e371" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e372" xlink:type="simple"/></inline-formula> while function (2) depends on all four parameters: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e373" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e374" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e375" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e376" xlink:type="simple"/></inline-formula>. We also simulated scenarios where we fixed different parameters, for example, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e377" xlink:type="simple"/></inline-formula> or <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e378" xlink:type="simple"/></inline-formula>. All scenarios give accurate estimates of the remaining parameter values.</p>
<p>We present here detailed results of two sets of simulations: one for the fossilized birth-death process and another one for the transmission birth-death process. Further simulation results can be found in the Supporting Information (Tables 2–6 in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>).</p>
<p>In these two scenarios, we first simulated trees and then sequences along the trees. Then we ran the sampler to recover tree model parameters and genealogies from simulated data comprised of sequences and sampling times. For the simulated fossilised birth-death process, we also performed analyses where only extant sequences are used. In this case, we still estimate full topologies that include fossil and extant samples to account for the uncertainty in topological locations of the fossil samples. We assess the results by calculating summary statistics including: the median estimate of a parameter, the relative error and relative bias of the median estimate, and the relative width of the 95% highest posterior density (HPD) interval. We assess whether the true value belongs to the 95% HPD interval. To summarise the results from a collection of runs we calculate the medians of the summary statistics (i.e, the median of the estimated medians, the median of the relative errors and so forth) and count the number of times when the true value belongs to the 95% HPD interval <xref ref-type="bibr" rid="pcbi.1003919-Dawid1">[43]</xref>. To assess the power of the method with regard to estimation of sampled ancestors we performed the receiver operating characteristic analysis <xref ref-type="bibr" rid="pcbi.1003919-Swets1">[44]</xref> which estimates false positive and false negative error rates under different decision rules.</p>
<p>For the fossilized birth-death process (the process with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e379" xlink:type="simple"/></inline-formula>-sampling and zero removal probability), we simulated a set of trees under a fixed set of the tree model parameters. In the case when we analysed sequence data of all sampled nodes, each parameter was estimated and, in the worst case, the median of the relative errors for all runs was 0.22 (0.24 for the analyses without <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e380" xlink:type="simple"/></inline-formula>-sampled sequences). The median of the relative errors for tree properties, such as the time of origin, tree height and number of sampled ancestors, was at most 0.09 (0.14 without <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e381" xlink:type="simple"/></inline-formula>-sampled sequences). The true parameters and tree properties were within the estimated 95% HPD intervals at least 95% (93% without <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e382" xlink:type="simple"/></inline-formula>-sampled sequences) of the time in all cases. The estimates of the number of sampled ancestors and the tree height for both cases are shown in <xref ref-type="fig" rid="pcbi-1003919-g003">Figure 3</xref>. <xref ref-type="fig" rid="pcbi-1003919-g004">Figure 4</xref> shows how the amount of uncertainty in estimates of turnover rate decreases with the size of the tree (i.e., with the number of sampled nodes) and increases when the sequences of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e383" xlink:type="simple"/></inline-formula>-sampled nodes are discarded. Overall removing sequence data of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e384" xlink:type="simple"/></inline-formula>-sampled nodes led to larger errors and increased 95% intervals. The median of errors for the turnover rate and sampling proportion were comparable as was the coverage for all macroevolutionary parameters. This might be due to fixing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e385" xlink:type="simple"/></inline-formula> to the truth. The detailed results of this set of simulations can be found in Supporting Information (Table 4 in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>).</p>
<fig id="pcbi-1003919-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g003</object-id><label>Figure 3</label><caption>
<title>Properties of the tree estimated from simulated data (fossilized birth-death process).</title>
<p>The graph shows median estimates (black dots) and 95% HPD intervals (grey lines) against true values for the tree height (on the left) and number of sampled ancestors (on the right). The upper row shows the estimates obtained from the analyses of simulated sequence data of all sampled nodes and the bottom row shows the estimates from the analyses where only sequence data from the extant samples was used.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g003" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003919-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g004</object-id><label>Figure 4</label><caption>
<title>Uncertainty in estimates for simulated data (fossilized birth-death process).</title>
<p>The graph shows the widths of relative 95% HPD intervals of the turnover rate, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e386" xlink:type="simple"/></inline-formula>, against tree sizes for simulated fossilized birth-death process. The black dots are the interval widths for posterior distributions obtained from the analyses of simulated sequence data of all sampled nodes and the red triangles are the interval widths from the analyses of sequence data of only extant samples.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g004" position="float" xlink:type="simple"/></fig>
<p>To simulate from the transmission birth-death process, i.e., the sampled ancestor birth-death process without <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e387" xlink:type="simple"/></inline-formula>-sampling and with non-zero removal probability, we draw tree model parameters from uniform distributions for each simulation. The tree model parameters were estimated with a maximum median of relative errors of 0.28 and, for the tree properties, of 0.06. In the worst case a parameter or a tree property was inside the 95% HPD interval 92% of the time. The estimates of the parameters are shown in <xref ref-type="fig" rid="pcbi-1003919-g005">Figure 5</xref>. When sampled ancestors were not accounted for the time of origin was accurately estimated but the tree height and model parameters were substantially biased. The median of the relative biases of the tree height increased from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e388" xlink:type="simple"/></inline-formula> to 0.01, for the diversification rate from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e389" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e390" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pcbi-1003919-g001">Figure 1</xref> in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>). When sampled ancestors were not accounted for in the inference the true tree height was inside 95% HPD interval 82% of the time, diversification rate 69%, and turnover rate 85%. More detailed results are presented in Table 5 in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>.</p>
<fig id="pcbi-1003919-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g005</object-id><label>Figure 5</label><caption>
<title>Parameter estimates for simulated data (transmission process).</title>
<p>The graph shows median estimates (black dots) and 95% HPD intervals (grey lines) against true values for the turnover rate, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e391" xlink:type="simple"/></inline-formula>, (on the left) and removal probability, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e392" xlink:type="simple"/></inline-formula>, (on the right).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g005" position="float" xlink:type="simple"/></fig>
<p>We used the data simulated from the transmission process to perform the receiver operating characteristic (ROC) analysis of the sampled ancestor predictor, which makes a prediction relying on the posterior distribution of genealogies. A node is predicted to be a sampled ancestor with a probability calculated as a fraction of trees in the posterior sample in which the node is a sampled ancestor. Out of the 5225 total sampled nodes in all simulated trees (excluding the last sample in each tree because this cannot be a sampled ancestor), 1814 were sampled ancestors. The ROC curve constructed from this data and predictions obtained from the MCMC runs is shown in <xref ref-type="fig" rid="pcbi-1003919-g006">Figure 6</xref>.</p>
<fig id="pcbi-1003919-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g006</object-id><label>Figure 6</label><caption>
<title>ROC curve for identifying sampled ancestors based on simulated data (transmission process).</title>
<p>The posterior distribution of trees obtained from a Bayesian MCMC analysis of simulated sequence data can be used to detect sampled ancestors. We identify a node as being a sampled ancestor if the posterior probability that the node is a sampled ancestor is greater than some threshold. The curve is parameterised by the threshold and shows the trade-off between true positive rate (sensitivity) and false positive rate (specificity) for different values of the threshold (any increase in sensitivity will be accompanied by a decrease in specificity). The dashed diagonal line corresponds to a ‘random guess’ test. The closer the ROC curve to the upper-left boarder of the ROC space (the whole area of the graph), the more accurate the test. The optimal value of the threshold for this curve is 0.45.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g006" position="float" xlink:type="simple"/></fig></sec><sec id="s3b">
<title>Application of the fossilized birth-death model to a bear dataset</title>
<p>We ran two analyses of the bear dataset originally analysed in <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref> with BEAST2 and with the DPPDiv implementation by Heath <italic>et al.</italic> under the same model. The tree topology relating all living bear species and two outgroup species is fixed in the analyses and we estimate the divergence times and three tree model parameters: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e393" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e394" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e395" xlink:type="simple"/></inline-formula> since the sampling probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e396" xlink:type="simple"/></inline-formula> was fixed to one in the inference. The estimates are the same in both analyses as expected. The estimated divergence times are shown in <xref ref-type="fig" rid="pcbi-1003919-g007">Figure 7</xref>. The median estimate and 95% HPD interval for the net diversification rate, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e397" xlink:type="simple"/></inline-formula>, were 0.027 per million years and [0.002, 0.058]; for the turnover rate, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e398" xlink:type="simple"/></inline-formula>, 0.51 and [0.1, 0.9]; and for the sampling proportion, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e399" xlink:type="simple"/></inline-formula>, 0.77 and [0.46, 0.98]. Most of the fossil samples were estimated to be direct ancestors of extant species or other fossil species, that is, the median estimate of the number of sampled ancestors was 22 with 95% HPD interval <xref ref-type="bibr" rid="pcbi.1003919-Khnert1">[17]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Sanderson1">[24]</xref>.</p>
<fig id="pcbi-1003919-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g007</object-id><label>Figure 7</label><caption>
<title>Divergence time estimates for the bear dataset.</title>
<p>The estimates are obtained from the analyses with DPPDiv <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref> (left bars with blue dots) and BEAST2 (right bars with red dots) implementations of the fossilised birth-death model, which give the same results. The bars are 95% HPD intervals and the dots are mean estimates. The node numbering follows the original analysis <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>: nodes 1 and 2 represent the most recent common ancestors of the bear clade and two outgroups (gray wolf and spotted seal). Node 3 is the most recent common ancestor of all living bear species and nodes 4-9 are the divergence times within the bear clade.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g007" position="float" xlink:type="simple"/></fig></sec><sec id="s3c">
<title>Application of sampled ancestor skyline model to HIV dataset</title>
<p>We analysed an HIV-1 subtype B dataset from the United Kingdom, consisting of 62 sequences that were originally analysed in <xref ref-type="bibr" rid="pcbi.1003919-Hu1">[42]</xref> and later analysed using the skyline model without sampled ancestors in <xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref>. For three of the sampled nodes the posterior probability of being a sampled ancestor was 61%, 59%, and 49%, respectively. For all other sampled nodes the posterior probability was less than 4%. There is positive evidence that the three sampled nodes with high posterior probabilities are sampled ancestors. The Bayes factors are 5.9, 8.7, and 4.2, respectively.</p>
<p>We chose a random tree among the trees in the posterior sample that have exactly these three nodes as sampled ancestors. The tree is shown in <xref ref-type="fig" rid="pcbi-1003919-g008">Figure 8</xref>. All three sampled ancestors are clustered within a clade of 16 (out of 62) samples, suggesting that this clade was more extensively sampled. The median of the posterior distribution of the number of sampled ancestors was 2 with 95% HPD interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e400" xlink:type="simple"/></inline-formula>. The removal probability was estimated to be 0.74 with 95% HPD interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e401" xlink:type="simple"/></inline-formula>, indicating a substantial reduction in the probability that infected patients remained able to cause further infections after they were diagnosed.</p>
<fig id="pcbi-1003919-g008" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003919.g008</object-id><label>Figure 8</label><caption>
<title>A tree sampled from the posterior of the HIV 1 dataset analysis.</title>
<p>The tree exhibits three estimated sampled ancestors shown as red circles. The samples with positive posterior probabilities of being sampled ancestors are shown in colour (red for the nodes with evidence of being sampled ancestors and blue for other nodes with non-zero probabilities) with the posterior probabilities in round brackets.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003919.g008" position="float" xlink:type="simple"/></fig></sec></sec><sec id="s4">
<title>Discussion</title>
<p>The MCMC sampler developed here enables analyses under models in which the probability of one sample being the direct ancestor of another sample is not negligible. These models are useful for describing infectious transmission processes, including identifying transmission chains. They are also useful for estimating divergence times for macroevolutionary data in the presence of fossil samples.</p>
<p>In the analysis of a phylogeny of bears we show that the sampler can be applied to data comprised of both fossil and recent taxa to infer divergence times. This dataset was previously analysed using the <italic>fossilized birth-death model</italic> by Heath <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003919-Heath1">[30]</xref>. While the underlying model is the same and thus produces the same results, there is a conceptual difference between the two MCMC frameworks. In the analysis by Heath <italic>et al.</italic>, MCMC was used to integrate over fossil attachment times while the topological attachment of the fossils was integrated out analytically. To achieve this, the topology of the phylogeny relating the extant taxa had to be assumed to be known. In our implementation, we average over the trees relating fossil and extant taxa, i.e., over both the fossil attachment times and topological attachment points, using MCMC. To facilitate a direct comparison we constrained the topology of the extant species, however, our implementation does not require this. For datasets where the tree topology is well resolved, analytical calculation results in faster mixing but when there is uncertainty in the extant phylogeny, which is the more common case, our sampler can account for it. Since the two implementations of the method were made completely independently of one another, this result also provides strong evidence that both implementations are sampling from the correct posterior distribution.</p>
<p>A natural extension to the analysis of the bear phylogeny would be to include morphological data to inform the inference regarding the precise placement of fossils on the tree <xref ref-type="bibr" rid="pcbi.1003919-Pyron1">[33]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Wood1">[34]</xref>, however this requires probabilistic models of morphological character evolution <xref ref-type="bibr" rid="pcbi.1003919-Ronquist2">[29]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Lewis2">[45]</xref>. Another direction for application of the sampler is using the skyline version of the fossilized birth-death model to analyse datasets where fossil samples come from different stratigraphic layers, so that rates of fossilisation and discovery may change through time. Fossils are better preserved in some layers than in other layers and therefore the sampling rate varies from layer to layer (see, for example, <xref ref-type="bibr" rid="pcbi.1003919-Tavar1">[46]</xref>) and this can be modelled as a skyline plot.</p>
<p>Simulation studies show that the MCMC sampler for sampled ancestor trees allows for the detection of direct ancestors within the sample given sequence data and sampling dates. The simulation scenario where sequences were removed from the fossil samples demonstrates that the tree model is informative about sampled ancestors given that the sequence data from contemporaneous samples, sampling dates of fossils and sampling probability, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e402" xlink:type="simple"/></inline-formula>, are known.</p>
<p>The posterior probability that a sample is a sampled ancestor is comprised of two components. For the simple two sequence case, one component is the probability that the amount of difference observed in two sequences with time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e403" xlink:type="simple"/></inline-formula> between sampling is a result of the underlying substitution process that lasted for a period of time close to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e404" xlink:type="simple"/></inline-formula>. The second component is the prior probability, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e405" xlink:type="simple"/></inline-formula>, that the earlier sample is a sampled ancestor. The two probabilities depend on the substitution rate and tree model parameters, respectively, that are jointly estimated. We have shown that these parameters, and therefore which samples are sampled ancestors, can be accurately inferred given sufficiently many and sufficiently long sequences and sampling dates.</p>
<p>In epidemiological studies, sampled ancestors can be interpreted as sampled individuals that have later infected other individuals. In the analysis of the HIV dataset, we equated the transmission tree directly with the viral gene tree. This approximation is good enough to demonstrate the method. But for chronic infectious diseases such as Hepatitis C and HIV where the genetic diversity of the pathogen population within a single host can be substantial (e.g. <xref ref-type="bibr" rid="pcbi.1003919-Vrancken1">[20]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Shankarappa1">[47]</xref>) the inferential power would be improved by a hierarchical model that explicitly models the difference between the sampled ancestor transmission tree and the (binary) viral gene tree. Regardless of the modelling details, such analyses allow for the estimation of the removal at sampling parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e406" xlink:type="simple"/></inline-formula>, which controls the prevalence of sampled ancestors. In most situations this parameter reflects the probability with which patients remain able to cause further infections after they were diagnosed.</p>
<p>Even if the sampled ancestors are not of specific interest in an analysis it is important to model sampled ancestors when the data is likely to contain them because failing to do so introduces a bias to the estimates of the parameters. The birth rate, diversification rate and clock rate were all substantially biased when sampled ancestors were not accounted for.</p>
<p>Analytic calculations (presented in <xref ref-type="supplementary-material" rid="pcbi.1003919.s001">Text S1</xref>) and simulation studies show that there is a degree of non-identifiably of parameters in the transmission birth-death models that include the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e407" xlink:type="simple"/></inline-formula> parameter. In other words, these models require one of the parameters to be fixed or strongly constrained by prior information to achieve unambiguous inference. In epidemiological studies with a known sampling scheme, a candidate parameter to fix is the sampling proportion. For epidemics with a well-characterised period of infection, such as influenza, the total removal rate, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e408" xlink:type="simple"/></inline-formula>, could be fixed. Under the fossilized birth-death model, it is possible to infer all the parameters of the tree process prior when time-stamped comparative data is available. This is an interesting insight: if no fossils are available, we can only infer two out of the three parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e409" xlink:type="simple"/></inline-formula> (as the likelihood only depends on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e410" xlink:type="simple"/></inline-formula>) while in presence of fossils we can estimate all four parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e411" xlink:type="simple"/></inline-formula> (as the likelihood depends on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e412" xlink:type="simple"/></inline-formula>).</p>
<p>The fossilised birth-death model allows the inference of tree model parameters given the phylogeny or time-stamped comparative data. The simulation study showed that without comparative data for fossil samples and assuming the sampling probability, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e413" xlink:type="simple"/></inline-formula>, is known, it is still possible to infer the tree model parameters and phylogenies (excluding the phylogenetic positions of the fossil nodes) albeit with increased uncertainty. In the bear data analysis, we used this type of input data (extant sequences, fossil occurrence dates and fixed <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e414" xlink:type="simple"/></inline-formula>) and additionally imposing monophyletic constraints on the fossils. Including comparative data for the fossil samples would have allowed inference about their precise phylogenetic placement without imposing monophyletic constraints. As sequence data for fossil organisms is rarely available information about fossil locations on the tree obtained by phylogenetic modelling of morphological data <xref ref-type="bibr" rid="pcbi.1003919-Ronquist2">[29]</xref>, <xref ref-type="bibr" rid="pcbi.1003919-Lewis2">[45]</xref> may become important to enable effective inference. This approach has been termed <italic>total evidence fossil dating</italic> <xref ref-type="bibr" rid="pcbi.1003919-Ronquist2">[29]</xref> and is the subject of active research.</p>
<p>The implementation of the sampled ancestor skyline model assumes that the rate shift times are known <italic>a priori</italic>. However, there are methods that relax this assumption for the skyline model without sampled ancestors. In one such method, the change-points are considered to be equidistant and only the number of the intervening intervals needs to be known prior to the inference <xref ref-type="bibr" rid="pcbi.1003919-Stadler3">[23]</xref>. Another method infers both the rate shift times and the number of shifts <xref ref-type="bibr" rid="pcbi.1003919-Wu1">[48]</xref>. Similar methods are yet to be developed for the skyline model with sampled ancestors. The identifiability of parameters (including or excluding times of the rate shifts) of the skyline model also remains to be investigated.</p>
<p>To our knowledge this is the first full implementation of an MCMC sampler for sampled ancestor trees and we anticipate that such samplers will form the computational basis for further developments in fossil-calibrated divergence time dating, total-evidence fossil dating and phylodynamics.</p>
</sec><sec id="s5">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1003919.s001" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s001" position="float" xlink:type="simple"><label>Text S1</label><caption>
<p><bold>Supporting information.</bold> The text describes equation derivations, details of simulation studies presented in the main text and additional simulation studies, and other supporting information.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003919.s002" mimetype="text/plain" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s002" position="float" xlink:type="simple"><label>File S1</label><caption>
<p><bold>Sampled ancestor package setup instructions.</bold></p>
<p>(TXT)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003919.s003" mimetype="text/xml" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s003" position="float" xlink:type="simple"><label>File S2</label><caption>
<p><bold>XML file for the bear dataset analysis.</bold></p>
<p>(XML)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003919.s004" mimetype="text/xml" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s004" position="float" xlink:type="simple"><label>File S3</label><caption>
<p><bold>XML file for the HIV-1 dataset analysis.</bold></p>
<p>(XML)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003919.s005" mimetype="application/zip" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s005" position="float" xlink:type="simple"><label>File S4</label><caption>
<p><bold>XML files for simulated fossilized birth-death process.</bold></p>
<p>(ZIP)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003919.s006" mimetype="application/zip" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s006" position="float" xlink:type="simple"><label>File S5</label><caption>
<p><bold>XML files for simulated transmission process.</bold></p>
<p>(ZIP)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003919.s007" mimetype="application/zip" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s007" position="float" xlink:type="simple"><label>File S6</label><caption>
<p><bold>XML files for simulated fossilized birth-death process without </bold><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e415" xlink:type="simple"/></inline-formula><bold>-sampled sequences.</bold></p>
<p>(ZIP)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003919.s008" mimetype="application/zip" xlink:href="info:doi/10.1371/journal.pcbi.1003919.s008" position="float" xlink:type="simple"><label>File S7</label><caption>
<p><bold>XML files for simulated transmission process with </bold><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003919.e416" xlink:type="simple"/></inline-formula><bold> fixed to one.</bold></p>
<p>(ZIP)</p>
</caption></supplementary-material></sec></body>
<back>
<ack>
<p>We would like to thank Tracy Heath for assistance with her implementation. We also acknowledge the New Zealand eScience Infrastructure (NeSI) for use of their high-performance computing facilities.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1003919-Yang1"><label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name>, <name name-style="western"><surname>Rannala</surname><given-names>B</given-names></name> (<year>1997</year>) <article-title>Bayesian phylogenetic inference using DNA sequences: a Markov chain Monte Carlo method</article-title>. <source>Mol Biol Evol</source> <volume>14</volume>: <fpage>717</fpage>–<lpage>24</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Mau1"><label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mau</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Newton</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Larget</surname><given-names>B</given-names></name> (<year>1999</year>) <article-title>Bayesian phylogenetic inference via Markov chain Monte Carlo methods</article-title>. <source>Biometrics</source> <volume>55</volume>: <fpage>1</fpage>–<lpage>12</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Huelsenbeck1"><label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Ronquist</surname><given-names>F</given-names></name> (<year>2001</year>) <article-title>MRBAYES: Bayesian inference of phylogenetic trees</article-title>. <source>Bioinformatics</source> <volume>17</volume>: <fpage>754</fpage>–<lpage>755</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Drummond1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Xie</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name> (<year>2012</year>) <article-title>Bayesian phylogenetics with BEAUti and the BEAST 1.7</article-title>. <source>Mol Biol Evol</source> <volume>29</volume>: <fpage>1969</fpage>–<lpage>73</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Ronquist1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ronquist</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Teslenko</surname><given-names>M</given-names></name>, <name name-style="western"><surname>van der Mark</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Ayres</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Darling</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>MrBayes 3.2: efficient Bayesian phylogenetic inference and model choice across a large model space</article-title>. <source>Syst Biol</source> <volume>61</volume>: <fpage>539</fpage>–<lpage>42</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Bouckaert1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bouckaert</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Heled</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Kühnert</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Vaughan</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Wu</surname><given-names>CH</given-names></name>, <etal>et al</etal>. (<year>2014</year>) <article-title>BEAST2: A software platform for Bayesian evolutionary analysis</article-title>. <source>PLoS Comput Biol</source> <volume>10</volume>: <fpage>e1003537</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Lartillot1"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lartillot</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Lepage</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Blanquart</surname><given-names>S</given-names></name> (<year>2009</year>) <article-title>PhyloBayes 3: a Bayesian software package for phylogenetic reconstruction and molecular dating</article-title>. <source>Bioinformatics</source> <volume>25</volume>: <fpage>2286</fpage>–<lpage>8</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Metropolis1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Metropolis</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Rosenbluth</surname><given-names>AW</given-names></name>, <name name-style="western"><surname>Rosenbluth</surname><given-names>MN</given-names></name>, <name name-style="western"><surname>Teller</surname><given-names>AH</given-names></name>, <name name-style="western"><surname>Teller</surname><given-names>E</given-names></name> (<year>1953</year>) <article-title>Equations of state calculations by fast computing machines</article-title>. <source>The Journal of Chemical Physics</source> <volume>21</volume>: <fpage>1087</fpage>–<lpage>1092</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Hastings1"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hastings</surname><given-names>W</given-names></name> (<year>1970</year>) <article-title>Monte Carlo sampling methods using Markov chains and their applications</article-title>. <source>Biometrika</source> <volume>57</volume>: <fpage>97</fpage>–<lpage>109</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Lewis1"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lewis</surname><given-names>PO</given-names></name>, <name name-style="western"><surname>Holder</surname><given-names>MT</given-names></name>, <name name-style="western"><surname>Holsinger</surname><given-names>KE</given-names></name> (<year>2005</year>) <article-title>Polytomies and Bayesian phylogenetic inference</article-title>. <source>Syst Biol</source> <volume>54</volume>: <fpage>241</fpage>–<lpage>253</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Gavryushkina1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gavryushkina</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Welch</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name> (<year>2013</year>) <article-title>Recursive algorithms for phylogenetic tree counting</article-title>. <source>Algorithms for Molecular Biology</source> <volume>8</volume>: <fpage>26</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Drummond2"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Forsberg</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Rodrigo</surname><given-names>AG</given-names></name> (<year>2003</year>) <article-title>Measurably evolving populations</article-title>. <source>Trends in Ecology &amp; Evolution</source> <volume>18</volume>: <fpage>481</fpage>–<lpage>488</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Pybus1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name>, <name name-style="western"><surname>Charleston</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Gupta</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name>, <etal>et al</etal>. (<year>2001</year>) <article-title>The epidemic behavior of the hepatitis C virus</article-title>. <source>Science</source> <volume>292</volume>: <fpage>2323</fpage>–<lpage>2325</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Grenfell1"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Grenfell</surname><given-names>BT</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name>, <name name-style="western"><surname>Gog</surname><given-names>JR</given-names></name>, <name name-style="western"><surname>Wood</surname><given-names>JL</given-names></name>, <name name-style="western"><surname>Daly</surname><given-names>JM</given-names></name>, <etal>et al</etal>. (<year>2004</year>) <article-title>Unifying the epidemiological and evolutionary dynamics of pathogens</article-title>. <source>Science</source> <volume>303</volume>: <fpage>327</fpage>–<lpage>32</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Stadler1"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Kouyos</surname><given-names>R</given-names></name>, <name name-style="western"><surname>von Wyl</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Yerly</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Böni</surname><given-names>J</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Estimating the basic reproductive number from viral sequence data</article-title>. <source>Mol Biol Evol</source> <volume>29</volume>: <fpage>347</fpage>–<lpage>357</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Ypma1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ypma</surname><given-names>RJ</given-names></name>, <name name-style="western"><surname>van Ballegooijen</surname><given-names>WM</given-names></name>, <name name-style="western"><surname>Wallinga</surname><given-names>J</given-names></name> (<year>2013</year>) <article-title>Relating phylogenetic trees to transmission trees of infectious disease outbreaks</article-title>. <source>Genetics</source> <volume>195</volume>: <fpage>1055</fpage>–<lpage>1062</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Khnert1"><label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kühnert</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Vaughan</surname><given-names>TG</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name> (<year>2014</year>) <article-title>Simultaneous reconstruction of evolutionary history and epidemiological dynamics from viral sequences with the birth-death SIR model</article-title>. <source>J R Soc Interface</source> <volume>11</volume>: <fpage>20131106</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Volz1"><label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>EM</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>SD</given-names></name> (<year>2013</year>) <article-title>Inferring the source of transmission with phylogenetic data</article-title>. <source>PLoS Comput Biol</source> <volume>9</volume>: <fpage>e1003397</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Teunis1"><label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Teunis</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Heijne</surname><given-names>JCM</given-names></name>, <name name-style="western"><surname>Sukhrie</surname><given-names>F</given-names></name>, <name name-style="western"><surname>van Eijkeren</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Koopmans</surname><given-names>M</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Infectious disease transmission as a forensic problem: who infected whom</article-title>? <source>J R Soc Interface</source> <volume>10</volume>: <fpage>20120955</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Vrancken1"><label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Vrancken</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Baele</surname><given-names>G</given-names></name>, <etal>et al</etal>. (<year>2014</year>) <article-title>The genealogical population dynamics of HIV-1 in a large transmission chain: Bridging within and among host evolutionary rates</article-title>. <source>PLoS Comput Biol</source> <volume>10</volume>: <fpage>e1003505</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Stadler2"><label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name> (<year>2010</year>) <article-title>Sampling-through-time in birth-death trees</article-title>. <source>Journal of Theoretical Biology</source> <volume>267</volume>: <fpage>396</fpage>–<lpage>404</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Didier1"><label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Didier</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Royer-Carenzi</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Laurin</surname><given-names>M</given-names></name> (<year>2012</year>) <article-title>The reconstructed evolutionary process with the fossil record</article-title>. <source>J Theor Biol</source> <volume>315</volume>: <fpage>26</fpage>–<lpage>37</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Stadler3"><label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Kühnert</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Bonhoeffer</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name> (<year>2013</year>) <article-title>Birth-death skyline plot reveals temporal changes of epidemic spread in HIV and hepatitis C virus (HCV)</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>110</volume>: <fpage>228</fpage>–<lpage>33</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Sanderson1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sanderson</surname><given-names>MJ</given-names></name> (<year>1997</year>) <article-title>A nonparametric approach to estimating divergence times in the absence of rate consistency</article-title>. <source>Mol Biol Evol</source> <volume>14</volume>: <fpage>1218</fpage>–<lpage>1231</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Thorne1"><label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Thorne</surname><given-names>JL</given-names></name>, <name name-style="western"><surname>Kishino</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Painter</surname><given-names>IS</given-names></name> (<year>1998</year>) <article-title>Estimating the rate of evolution of the rate of molecular evolution</article-title>. <source>Mol Biol Evol</source> <volume>15</volume>: <fpage>1647</fpage>–<lpage>1657</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Drummond3"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Ho</surname><given-names>SY</given-names></name>, <name name-style="western"><surname>Phillips</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name> (<year>2006</year>) <article-title>Relaxed phylogenetics and dating with confidence</article-title>. <source>PLoS Biol</source> <volume>4</volume>: <fpage>e88</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Rannala1"><label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rannala</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name> (<year>2007</year>) <article-title>Inferring speciation times under an episodic molecular clock</article-title>. <source>Syst Biol</source> <volume>56</volume>: <fpage>453</fpage>–<lpage>466</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Ho1"><label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ho</surname><given-names>SY</given-names></name>, <name name-style="western"><surname>Phillips</surname><given-names>MJ</given-names></name> (<year>2009</year>) <article-title>Accounting for calibration uncertainty in phylogenetic estimation of evolutionary divergence times</article-title>. <source>Syst Biol</source> <volume>58</volume>: <fpage>367</fpage>–<lpage>380</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Ronquist2"><label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ronquist</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Klopfstein</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Vilhelmsen</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Schulmeister</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Murray</surname><given-names>DL</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>A total-evidence approach to dating with fossils, applied to the early radiation of the hymenoptera</article-title>. <source>Syst Biol</source> <volume>61</volume>: <fpage>973</fpage>–<lpage>999</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Heath1"><label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Heath</surname><given-names>TA</given-names></name>, <name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name> (<year>2014</year>) <article-title>The fossilized birth–death process for coherent calibration of divergence-time estimates</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>111</volume>: <fpage>E2957</fpage>–<lpage>E2966</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Heled1"><label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Heled</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name> (<year>2012</year>) <article-title>Calibrated tree priors for relaxed phylogenetics and divergence time estimation</article-title>. <source>Syst Biol</source> <volume>61</volume>: <fpage>138</fpage>–<lpage>49</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Laurin1"><label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Laurin</surname><given-names>M</given-names></name> (<year>2012</year>) <article-title>Recent progress in paleontological methods for dating the Tree of Life</article-title>. <source>Front Genet</source> <volume>3</volume>: <fpage>130</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Pyron1"><label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pyron</surname><given-names>RA</given-names></name> (<year>2011</year>) <article-title>Divergence time estimation using fossils as terminal taxa and the origins of Lissamphibia</article-title>. <source>Syst Biol</source> <volume>60</volume>: <fpage>466</fpage>–<lpage>81</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Wood1"><label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wood</surname><given-names>HM</given-names></name>, <name name-style="western"><surname>Matzke</surname><given-names>NJ</given-names></name>, <name name-style="western"><surname>Gillespie</surname><given-names>RG</given-names></name>, <name name-style="western"><surname>Griswold</surname><given-names>CE</given-names></name> (<year>2013</year>) <article-title>Treating fossils as terminal taxa in divergence time estimation reveals ancient vicariance patterns in the palpimanoid spiders</article-title>. <source>Syst Biol</source> <volume>62</volume>: <fpage>264</fpage>–<lpage>284</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Schrago1"><label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Schrago</surname><given-names>CG</given-names></name>, <name name-style="western"><surname>Mello</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Soares</surname><given-names>AER</given-names></name> (<year>2013</year>) <article-title>Combining fossil and molecular data to date the diversification of New World Primates</article-title>. <source>J Evol Biol</source> <volume>26</volume>: <fpage>2438</fpage>–<lpage>2446</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Silvestro1"><label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Silvestro</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Schnitzler</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Liow</surname><given-names>LH</given-names></name>, <name name-style="western"><surname>Antonelli</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Salamin</surname><given-names>N</given-names></name> (<year>2014</year>) <article-title>Bayesian estimation of speciation and extinction from incomplete fossil occurrence data</article-title>. <source>Syst Biol</source> <volume>63</volume>: <fpage>349</fpage>–<lpage>367</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Foote1"><label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Foote</surname><given-names>M</given-names></name> (<year>1996</year>) <article-title>On the probability of ancestors in the fossil record</article-title>. <source>Paleobiology</source> <volume>22</volume>: <fpage>141</fpage>–<lpage>151</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Wilkinson1"><label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wilkinson</surname><given-names>RD</given-names></name>, <name name-style="western"><surname>Tavaré</surname><given-names>S</given-names></name> (<year>2009</year>) <article-title>Estimating primate divergence times by using conditioned birth-and-death processes</article-title>. <source>Theor Popul Biol</source> <volume>75</volume>: <fpage>278</fpage>–<lpage>285</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Green1"><label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Green</surname><given-names>PJ</given-names></name> (<year>1995</year>) <article-title>Reversible jump Markov chain Monte Carlo computation and Bayesian model determination</article-title>. <source>Biometrica</source> <volume>82</volume>: <fpage>771</fpage>–<lpage>732</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Wilson1"><label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wilson</surname><given-names>IJ</given-names></name>, <name name-style="western"><surname>Balding</surname><given-names>DJ</given-names></name> (<year>1998</year>) <article-title>Genealogical inference from microsatellite data</article-title>. <source>Genetics</source> <volume>150</volume>: <fpage>499</fpage>–<lpage>510</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Drummond4"><label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Nicholls</surname><given-names>GK</given-names></name>, <name name-style="western"><surname>Rodrigo</surname><given-names>AG</given-names></name>, <name name-style="western"><surname>Solomon</surname><given-names>W</given-names></name> (<year>2002</year>) <article-title>Estimating mutation parameters, population history and genealogy simultaneously from temporally spaced sequence data</article-title>. <source>Genetics</source> <volume>161</volume>: <fpage>1307</fpage>–<lpage>20</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Hu1"><label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hué</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Pillay</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Clewley</surname><given-names>JP</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name> (<year>2005</year>) <article-title>Genetic analysis reveals the complex structure of HIV-1 transmission within defined risk groups</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>102</volume>: <fpage>4425</fpage>–<lpage>4429</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Dawid1"><label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Dawid</surname><given-names>AP</given-names></name> (<year>1982</year>) <article-title>The well-calibrated Bayesian</article-title>. <source>J Am Stat Assoc</source> <volume>77</volume>: <fpage>605</fpage>–<lpage>610</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Swets1"><label>44</label>
<mixed-citation publication-type="other" xlink:type="simple">Swets JA (1996) Signal detection theory and ROC analysis in psychology and diagnostics: collected papers. Lawrence Erlbaum Associates, Mahwah, NJ.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Lewis2"><label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lewis</surname><given-names>PO</given-names></name> (<year>2001</year>) <article-title>A likelihood approach to estimating phylogeny from discrete morphological character data</article-title>. <source>Syst Biol</source> <volume>50</volume>: <fpage>913</fpage>–<lpage>25</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Tavar1"><label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tavaré</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Marshall</surname><given-names>CR</given-names></name>, <name name-style="western"><surname>Will</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Soligo</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Martin</surname><given-names>RD</given-names></name> (<year>2002</year>) <article-title>Using the fossil record to estimate the age of the last common ancestor of extant primates</article-title>. <source>Nature</source> <volume>416</volume>: <fpage>726</fpage>–<lpage>9</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Shankarappa1"><label>47</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Shankarappa</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Margolick</surname><given-names>JB</given-names></name>, <name name-style="western"><surname>Gange</surname><given-names>SJ</given-names></name>, <name name-style="western"><surname>Rodrigo</surname><given-names>AG</given-names></name>, <name name-style="western"><surname>Upchurch</surname><given-names>D</given-names></name>, <etal>et al</etal>. (<year>1999</year>) <article-title>Consistent viral evolutionary changes associated with the disease progression of human immunodeficiency virus type 1 infection</article-title>. <source>Journal of virology</source> <volume>73</volume>: <fpage>10489</fpage>–<lpage>10502</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003919-Wu1"><label>48</label>
<mixed-citation publication-type="book" xlink:type="simple">Wu CH (2014) Bayesian approaches to model uncertainty in phylogenetics. Ph.D. thesis, University of Auckland, Auckland, New Zealand.</mixed-citation>
</ref>
</ref-list></back>
</article>