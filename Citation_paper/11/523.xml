<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN" "http://jats.nlm.nih.gov/publishing/1.1d3/JATS-journalpublishing1.dtd">
<article article-type="research-article" dtd-version="1.1d3" xml:lang="en" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-17-00907</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1005932</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Evolutionary systematics</subject><subj-group><subject>Phylogenetics</subject><subj-group><subject>Phylogenetic analysis</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Taxonomy</subject><subj-group><subject>Evolutionary systematics</subject><subj-group><subject>Phylogenetics</subject><subj-group><subject>Phylogenetic analysis</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Computer and information sciences</subject><subj-group><subject>Data management</subject><subj-group><subject>Taxonomy</subject><subj-group><subject>Evolutionary systematics</subject><subj-group><subject>Phylogenetics</subject><subj-group><subject>Phylogenetic analysis</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Evolutionary systematics</subject><subj-group><subject>Phylogenetics</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Taxonomy</subject><subj-group><subject>Evolutionary systematics</subject><subj-group><subject>Phylogenetics</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Computer and information sciences</subject><subj-group><subject>Data management</subject><subj-group><subject>Taxonomy</subject><subj-group><subject>Evolutionary systematics</subject><subj-group><subject>Phylogenetics</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Computer and information sciences</subject><subj-group><subject>Network analysis</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Applied mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Genetics</subject><subj-group><subject>Genetic loci</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Genetics</subject><subj-group><subject>Gene identification and analysis</subject><subj-group><subject>Genetic networks</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Computer and information sciences</subject><subj-group><subject>Network analysis</subject><subj-group><subject>Genetic networks</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Computational biology</subject><subj-group><subject>Genome evolution</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Genetics</subject><subj-group><subject>Genomics</subject><subj-group><subject>Genome evolution</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Molecular evolution</subject><subj-group><subject>Genome evolution</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Bayesian inference of phylogenetic networks from bi-allelic genetic markers</article-title>
<alt-title alt-title-type="running-head">Bayesian inference of phylogenetic networks from bi-allelic genetic markers</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Zhu</surname> <given-names>Jiafan</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Wen</surname> <given-names>Dingqiao</given-names></name>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Yu</surname> <given-names>Yun</given-names></name>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Meudt</surname> <given-names>Heidi M.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-3288-6769</contrib-id>
<name name-style="western">
<surname>Nakhleh</surname> <given-names>Luay</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Project administration</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Computer Science, Rice University, Houston, Texas, United States of America</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Museum of New Zealand Te Papa Tongarewa, Wellington, New Zealand</addr-line>
</aff>
<aff id="aff003">
<label>3</label>
<addr-line>BioSciences, Rice University, Houston, Texas, United States of America</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Matsen</surname> <given-names>Frederick A</given-names> <suffix>IV</suffix></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>Fred Hutchinson Cancer Research Center, UNITED STATES</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">nakhleh@rice.edu</email></corresp>
</author-notes>
<pub-date pub-type="collection">
<month>1</month>
<year>2018</year>
</pub-date>
<pub-date pub-type="epub">
<day>10</day>
<month>1</month>
<year>2018</year>
</pub-date>
<volume>14</volume>
<issue>1</issue>
<elocation-id>e1005932</elocation-id>
<history>
<date date-type="received">
<day>6</day>
<month>6</month>
<year>2017</year>
</date>
<date date-type="accepted">
<day>14</day>
<month>12</month>
<year>2017</year>
</date>
</history>
<permissions>
<copyright-year>2018</copyright-year>
<copyright-holder>Zhu et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1005932"/>
<abstract>
<p>Phylogenetic networks are rooted, directed, acyclic graphs that model reticulate evolutionary histories. Recently, statistical methods were devised for inferring such networks from either gene tree estimates or the sequence alignments of multiple unlinked loci. Bi-allelic markers, most notably single nucleotide polymorphisms (SNPs) and amplified fragment length polymorphisms (AFLPs), provide a powerful source of genome-wide data. In a recent paper, a method called SNAPP was introduced for statistical inference of species trees from unlinked bi-allelic markers. The generative process assumed by the method combined both a model of evolution for the bi-allelic markers, as well as the multispecies coalescent. A novel component of the method was a polynomial-time algorithm for exact computation of the likelihood of a fixed species tree via integration over all possible gene trees for a given marker. Here we report on a method for Bayesian inference of phylogenetic networks from bi-allelic markers. Our method significantly extends the algorithm for exact computation of phylogenetic network likelihood via integration over all possible gene trees. Unlike the case of species trees, the algorithm is no longer polynomial-time on all instances of phylogenetic networks. Furthermore, the method utilizes a reversible-jump MCMC technique to sample the posterior of phylogenetic networks given bi-allelic marker data. Our method has a very good performance in terms of accuracy and robustness as we demonstrate on simulated data, as well as a data set of multiple New Zealand species of the plant genus <italic>Ourisia</italic> (Plantaginaceae). We implemented the method in the publicly available, open-source PhyloNet software package.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>The availability of genomic data has revolutionized the study of evolutionary histories and phylogeny inference. Inferring evolutionary histories from genomic data requires, in most cases, accounting for the fact that different genomic regions could have evolutionary histories that differ from each other as well as from that of the species from which the genomes were sampled. In this paper, we introduce a method for inferring evolutionary histories while accounting for two processes that could give rise to such differences across the genomes, namely incomplete lineage sorting and hybridization. We introduce a novel algorithm for computing the likelihood of phylogenetic networks from bi-allelic genetic markers and use it in a Bayesian inference method. Analyses of synthetic and empirical data sets show a very good performance of the method in terms of the estimates it obtains.</p>
</abstract>
<funding-group>
<award-group id="award001">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000001</institution-id>
<institution>National Science Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>DBI-1355998</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-3288-6769</contrib-id>
<name name-style="western">
<surname>Nakhleh</surname> <given-names>Luay</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award002">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000001</institution-id>
<institution>National Science Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>CCF-1302179</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-3288-6769</contrib-id>
<name name-style="western">
<surname>Nakhleh</surname> <given-names>Luay</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award003">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000001</institution-id>
<institution>National Science Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>CNS-1338099</award-id>
</award-group>
<funding-statement>This work was supported by DBI-1355998 and CCF-1302179 to LN from the National Science Foundation (<ext-link ext-link-type="uri" xlink:href="http://www.nsf.gov" xlink:type="simple">http://www.nsf.gov</ext-link>). This work was supported in part by the Data Analysis and Visualization Cyberinfrastructure funded by NSF under grant OCI-0959097 and Rice University, and by the Big-Data Private-Cloud Research Cyberinfrastructure MRI-award funded by NSF under grant CNS-1338099 and Rice University. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="20"/>
<table-count count="0"/>
<page-count count="32"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2018-01-23</meta-value>
</custom-meta><custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>Data files are available at <ext-link ext-link-type="uri" xlink:href="http://www.cs.rice.edu/~nakhleh/ZhuEtAl-PLoSCB-OurisianInputFiles.zip" xlink:type="simple">http://www.cs.rice.edu/~nakhleh/ZhuEtAl-PLoSCB-OurisianInputFiles.zip</ext-link>.</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<disp-quote><p>This is a PLoS Computational Biology Methods paper.</p></disp-quote>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>The availability of genome-wide data from many species and, in some cases, many individuals per species, has transformed the study of evolutionary histories, and given rise to phylogenomics—the inference of gene and species evolutionary histories from genome-wide data. Consider a data set <italic>S</italic> = {<italic>S</italic><sub>1</sub>, …, <italic>S</italic><sub><italic>m</italic></sub>} consisting of the molecular sequences of <italic>m</italic> loci under the assumptions of free recombination between loci and no recombination within a locus. The likelihood of a species phylogeny Ψ (topology and parameters) is given by
<disp-formula id="pcbi.1005932.e001"><alternatives><graphic id="pcbi.1005932.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e001" xlink:type="simple"/><mml:math display="block" id="M1"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi mathvariant="script">L</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>S</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>m</mml:mi></mml:munderover> <mml:mi mathvariant="script">L</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:msub><mml:mi>S</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>m</mml:mi></mml:munderover> <mml:msub><mml:mo>∫</mml:mo> <mml:mi>G</mml:mi></mml:msub> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>S</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:mi>g</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>g</mml:mi> <mml:mo>|</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="normal">d</mml:mi> <mml:mi>g</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(1)</label></disp-formula>
where the integration is taken over all possible gene trees. The term <italic>p</italic>(<italic>S</italic><sub><italic>i</italic></sub>|<italic>g</italic>) is the likelihood of gene tree <italic>g</italic> given the sequence data of locus <italic>i</italic> [<xref ref-type="bibr" rid="pcbi.1005932.ref001">1</xref>]. The term <italic>p</italic>(<italic>g</italic>|Ψ) is the density function (pdf) of gene trees given the species phylogeny and its parameters. For example, Rannala and Yang [<xref ref-type="bibr" rid="pcbi.1005932.ref002">2</xref>] derived this pdf under the multispecies coalescent (MSC). This formulation underlies the Bayesian inference methods of [<xref ref-type="bibr" rid="pcbi.1005932.ref002">2</xref>–<xref ref-type="bibr" rid="pcbi.1005932.ref004">4</xref>].</p>
<p>Debate has recently ensued regarding the size of genomic regions that would be recombination-free (or almost recombination-free) and could truly have a single underlying evolutionary tree [<xref ref-type="bibr" rid="pcbi.1005932.ref005">5</xref>, <xref ref-type="bibr" rid="pcbi.1005932.ref006">6</xref>]. One way to overcome this issue is to use unlinked single nucleotide polymorphisms (SNPs) or amplified fragment length polymorphisms (AFLPs). Such data provide a powerful signal for inferring species phylogenies and the issue of recombination within a locus becomes irrelevant. Furthermore, as long as those markers are sampled far enough from each other the assumption of free recombination among loci holds. Indeed, this is the basis of the SNAPP method that was recently introduced in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>]. Since a bi-allelic SNP or AFLP marker has no signal by itself to resolve much of the branching patterns of a gene genealogy, a major contribution of Bryant <italic>et al.</italic> was an algorithm for analytically computing the integration in <xref ref-type="disp-formula" rid="pcbi.1005932.e001">Eq (1)</xref> for bi-allelic markers.</p>
<p>While trees constitute an appropriate model of the evolutionary histories of many groups of species, it is well known that other groups of species have evolutionary histories that are reticulate [<xref ref-type="bibr" rid="pcbi.1005932.ref008">8</xref>]. Horizontal gene transfer is ubiquitous in prokaryotes [<xref ref-type="bibr" rid="pcbi.1005932.ref009">9</xref>, <xref ref-type="bibr" rid="pcbi.1005932.ref010">10</xref>], and several bodies of work are pointing to much larger extent and role of hybridization in eukaryotic evolution than once thought [<xref ref-type="bibr" rid="pcbi.1005932.ref008">8</xref>, <xref ref-type="bibr" rid="pcbi.1005932.ref011">11</xref>–<xref ref-type="bibr" rid="pcbi.1005932.ref015">15</xref>]. Not only does hybridization play an important role in the genomic diversification of several eukaryotic groups, but increasing evidence is pointing to the adaptive role it has played, for example, in wild sunflowers [<xref ref-type="bibr" rid="pcbi.1005932.ref016">16</xref>], humans [<xref ref-type="bibr" rid="pcbi.1005932.ref017">17</xref>], macaques [<xref ref-type="bibr" rid="pcbi.1005932.ref018">18</xref>], mice [<xref ref-type="bibr" rid="pcbi.1005932.ref019">19</xref>], butterflies [<xref ref-type="bibr" rid="pcbi.1005932.ref020">20</xref>], and mosquitoes [<xref ref-type="bibr" rid="pcbi.1005932.ref021">21</xref>, <xref ref-type="bibr" rid="pcbi.1005932.ref022">22</xref>].</p>
<p>Reticulate evolutionary histories are best modeled by <italic>phylogenetic networks</italic>. Two statistical methods were recently introduced for inference under the formulation given by <xref ref-type="disp-formula" rid="pcbi.1005932.e001">Eq (1)</xref>, when Ψ is a phylogenetic network [<xref ref-type="bibr" rid="pcbi.1005932.ref023">23</xref>, <xref ref-type="bibr" rid="pcbi.1005932.ref024">24</xref>], and other methods were also introduced for statistical inference of phylogenetic networks using gene tree estimates as the input data [<xref ref-type="bibr" rid="pcbi.1005932.ref025">25</xref>–<xref ref-type="bibr" rid="pcbi.1005932.ref029">29</xref>].</p>
<p>The methods of [<xref ref-type="bibr" rid="pcbi.1005932.ref023">23</xref>, <xref ref-type="bibr" rid="pcbi.1005932.ref024">24</xref>] assume that the data for each locus consists of a sequence alignment that has no recombination. In this paper, we devise an algorithm that builds on the algorithm of [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>] for analytically computing the integral in <xref ref-type="disp-formula" rid="pcbi.1005932.e001">Eq (1)</xref> when Ψ is a phylogenetic network. In other words, our algorithm allows for computing the likelihood of a phylogenetic network from unlinked bi-allelic markers while analytically integrating out the gene trees for the individual markers. We couple this likelihood function with priors on the phylogenetic network and its parameters to obtain a Bayesian formulation, and then employ the reversible-jump MCMC (RJMCMC) kernel from [<xref ref-type="bibr" rid="pcbi.1005932.ref023">23</xref>] to sample the posterior of the phylogenetic networks and their associated parameters given the bi-allelic data.</p>
<p>We implemented our algorithm and the RJMCMC sampler in PhyloNet [<xref ref-type="bibr" rid="pcbi.1005932.ref030">30</xref>], which is a publicly available open-source software package for inferring and analyzing reticulate evolutionary histories. We studied the performance of our method on simulated and biological data. For simulations, we extended the framework of [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>] so that the evolution of bi-allelic markers could be simulated within the branches of a phylogenetic network. For the biological data, we analyzed two data sets of multiple New Zealand species of the plant genus <italic>Ourisia</italic> (Plantaginaceae). The results on the simulated data show very good accuracy and robustness as reflected by the method’s ability to recover the true phylogenetic networks and their associated parameters even when the underlying assumptions of the method are violated. For the biological data, the method recovers two established hybrids and their putative parents correctly.</p>
<p>The proposed method and Bayesian sampler provide a new tool for biologists to infer reticulate evolutionary histories, while also account for the complexity arising from incomplete lineage sorting, from bi-allelic markers, thus complementing existing tools that use gene tree estimates or sequence alignments of the individual loci as the input data. The use of such bi-allelic markers, particularly when they are sampled far enough across the genome, completely sidesteps potential problems that could arise due to the presence of recombination within loci.</p>
</sec>
<sec id="sec002" sec-type="materials|methods">
<title>Materials and methods</title>
<sec id="sec003">
<title>Phylogenetic networks and gene trees</title>
<p>A <italic>phylogenetic <inline-formula id="pcbi.1005932.e002"><alternatives><graphic id="pcbi.1005932.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e002" xlink:type="simple"/><mml:math display="inline" id="M2"><mml:mi mathvariant="script">X</mml:mi></mml:math></alternatives></inline-formula> -network</italic>, or <inline-formula id="pcbi.1005932.e003"><alternatives><graphic id="pcbi.1005932.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e003" xlink:type="simple"/><mml:math display="inline" id="M3"><mml:mi mathvariant="script">X</mml:mi></mml:math></alternatives></inline-formula> -network for short, Ψ is a rooted, directed, acyclic graph (DAG) whose leaves are bijectively labeled by set <inline-formula id="pcbi.1005932.e004"><alternatives><graphic id="pcbi.1005932.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e004" xlink:type="simple"/><mml:math display="inline" id="M4"><mml:mi mathvariant="script">X</mml:mi></mml:math></alternatives></inline-formula> of taxa. We denote by <italic>V</italic>(Ψ) and <italic>E</italic>(Ψ) the sets of nodes and edges, respectively, of the phylogenetic network Ψ. Every node of the network has in-degree 1, which we call a <italic>tree node</italic>, or in-degree 2, which we call a <italic>reticulation node</italic>. The only exception is special node <italic>s</italic> whose in-degree is 0 and out-degree is 1; the edge (<italic>s</italic>, <italic>r</italic>) defines the branch above the root. The edges whose head is a reticulation node are the <italic>reticulation edges</italic> of the network; all other edges constitute the <italic>tree edges</italic> of the network. Every edge is directed forward in time. We assume all phylogenies considered here (trees and networks) are binary—no node has out-degree higher than 2.</p>
<p>Here, we use the bottom of a branch to refer to the end of the branch that is farther from the root of the network, and use the top of a branch to refer to the end of the branch that is closer to the root. Given that the coalescent views the evolution of alleles backward in time, we say that a lineage enters a branch to mean a lineage that exists at the bottom of that branch. Similarly, we say a lineage exits a branch to mean a lineage that exists at the top of that branch.</p>
<p>Each node in the network has a species divergence time and each edge <italic>b</italic> has an associated population mutation rate <italic>θ</italic><sub><italic>b</italic></sub> = 4<italic>N</italic><sub><italic>b</italic></sub><italic>μ</italic>. This parameter is typically referred to in the literature as the (rescaled) population size. Given the length <italic>τ</italic> of a branch in units of expected number of mutations per site, the length of that branch in coalescent units is 2<italic>τ</italic>/<italic>θ</italic>, assuming diploid individuals. The branch above the root, (<italic>s</italic>, <italic>r</italic>), is infinite in length so that all lineages that enter it coalesce on it eventually.</p>
<p>For every pair of reticulation edges <italic>e</italic><sub>1</sub> and <italic>e</italic><sub>2</sub> that share the same reticulation node, we associate an inheritance probability, <italic>γ</italic>, such that <inline-formula id="pcbi.1005932.e005"><alternatives><graphic id="pcbi.1005932.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e005" xlink:type="simple"/><mml:math display="inline" id="M5"><mml:mrow><mml:msub><mml:mi>γ</mml:mi> <mml:mrow><mml:msub><mml:mi>e</mml:mi> <mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>γ</mml:mi> <mml:mrow><mml:msub><mml:mi>e</mml:mi> <mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub> <mml:mo>∈</mml:mo> <mml:mo stretchy="false">[</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mn>1</mml:mn> <mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> with <inline-formula id="pcbi.1005932.e006"><alternatives><graphic id="pcbi.1005932.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e006" xlink:type="simple"/><mml:math display="inline" id="M6"><mml:mrow><mml:msub><mml:mi>γ</mml:mi> <mml:mrow><mml:msub><mml:mi>e</mml:mi> <mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi>γ</mml:mi> <mml:mrow><mml:msub><mml:mi>e</mml:mi> <mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. We denote by Γ the vector of inheritance probabilities corresponding to all the reticulation nodes in the phylogenetic network.</p>
<p>We use Ψ to refer to the topology, species divergence times, population mutation rates, and inheritance probabilities of the phylogenetic network. That is, here we include Γ as part of Ψ.</p>
<p>An <inline-formula id="pcbi.1005932.e007"><alternatives><graphic id="pcbi.1005932.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e007" xlink:type="simple"/><mml:math display="inline" id="M7"><mml:mi mathvariant="script">X</mml:mi></mml:math></alternatives></inline-formula> -phylogenetic tree, or <inline-formula id="pcbi.1005932.e008"><alternatives><graphic id="pcbi.1005932.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e008" xlink:type="simple"/><mml:math display="inline" id="M8"><mml:mi mathvariant="script">X</mml:mi></mml:math></alternatives></inline-formula> -tree, is an <inline-formula id="pcbi.1005932.e009"><alternatives><graphic id="pcbi.1005932.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e009" xlink:type="simple"/><mml:math display="inline" id="M9"><mml:mi mathvariant="script">X</mml:mi></mml:math></alternatives></inline-formula> -network with no reticulation nodes. A gene tree is an <inline-formula id="pcbi.1005932.e010"><alternatives><graphic id="pcbi.1005932.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e010" xlink:type="simple"/><mml:math display="inline" id="M10"><mml:mi mathvariant="script">X</mml:mi></mml:math></alternatives></inline-formula> -tree. Each node in the gene tree has an associated coalescence time. In the algorithm below, we make use of a coloring function <italic>c</italic>: (<italic>E</italic>(<italic>g</italic>), <italic>t</italic>) → {0, 1}, similar to that used in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>], where <italic>c</italic>(<italic>e</italic>, <italic>t</italic>) indicates the color, or allele, at time <italic>t</italic> along the branch <italic>e</italic> of gene tree <italic>g</italic>. We will follow [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>] in calling the two colors red and green.</p>
</sec>
<sec id="sec004">
<title>Labeled partial likelihoods</title>
<p>Looking forward in time (from the root toward the leaves), let <italic>u</italic> and <italic>v</italic> be the mutation rate from red allele to green allele and the mutation rate from green allele to red allele, respectively. The stationary distribution of the red and green alleles at the root is given by <italic>v</italic>/(<italic>u</italic> + <italic>v</italic>) and <italic>u</italic>/(<italic>u</italic> + <italic>v</italic>), respectively. Observed alleles are indicated by values of the coloring function <italic>c</italic> at gene tree leaves.</p>
<p>Given a gene history embedded within the branches of the network, the numbers and types of lineages at both ends of each branch of the network are needed to compute the likelihood. Let <italic>x</italic> be a branch in the phylogenetic network. We denote by <inline-formula id="pcbi.1005932.e011"><alternatives><graphic id="pcbi.1005932.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e012"><alternatives><graphic id="pcbi.1005932.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e012" xlink:type="simple"/><mml:math display="inline" id="M12"><mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> the total numbers of lineages at the top and bottom of <italic>x</italic>, respectively, and by <inline-formula id="pcbi.1005932.e013"><alternatives><graphic id="pcbi.1005932.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:msubsup><mml:mi>r</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e014"><alternatives><graphic id="pcbi.1005932.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e014" xlink:type="simple"/><mml:math display="inline" id="M14"><mml:msubsup><mml:mi>r</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> the numbers of red lineages at the top and bottom of <italic>x</italic>, respectively. See <xref ref-type="fig" rid="pcbi.1005932.g001">Fig 1</xref> for an illustration.</p>
<fig id="pcbi.1005932.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Illustrating the “growth” of lineages of a gene tree in a phylogenetic network.</title>
<p>The histories of green and red alleles are shown as solid (green) lines and dashed (red) lines, respectively.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g001" xlink:type="simple"/>
</fig>
<p>Let <italic>x</italic> be an arbitrary branch in the phylogenetic network and let <inline-formula id="pcbi.1005932.e015"><alternatives><graphic id="pcbi.1005932.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e015" xlink:type="simple"/><mml:math display="inline" id="M15"><mml:msub><mml:mi mathvariant="script">R</mml:mi> <mml:mi>x</mml:mi></mml:msub></mml:math></alternatives></inline-formula> be the event that for every external branch <italic>z</italic> that is a descendant of <italic>x</italic>, the actual number of red alleles in <italic>z</italic> equals to <inline-formula id="pcbi.1005932.e016"><alternatives><graphic id="pcbi.1005932.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e016" xlink:type="simple"/><mml:math display="inline" id="M16"><mml:msubsup><mml:mi>r</mml:mi> <mml:mi>z</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>.</p>
<p>We define two partial likelihoods: <inline-formula id="pcbi.1005932.e017"><alternatives><graphic id="pcbi.1005932.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e017" xlink:type="simple"/><mml:math display="inline" id="M17"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> is the product of the likelihood of a subtree rooted at the bottom of <italic>x</italic> and the probability <inline-formula id="pcbi.1005932.e018"><alternatives><graphic id="pcbi.1005932.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e018" xlink:type="simple"/><mml:math display="inline" id="M18"><mml:mrow><mml:mi>P</mml:mi> <mml:mi>r</mml:mi> <mml:mo>[</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>n</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, and <inline-formula id="pcbi.1005932.e019"><alternatives><graphic id="pcbi.1005932.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e019" xlink:type="simple"/><mml:math display="inline" id="M19"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> is the product of the likelihood at the top of branch <italic>x</italic> and the probability <inline-formula id="pcbi.1005932.e020"><alternatives><graphic id="pcbi.1005932.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e020" xlink:type="simple"/><mml:math display="inline" id="M20"><mml:mrow><mml:mi>P</mml:mi> <mml:mi>r</mml:mi> <mml:mo>[</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>n</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. In the case of a species tree (i.e., no reticulation nodes in the species phylogeny), the partial likelihood vectors <inline-formula id="pcbi.1005932.e021"><alternatives><graphic id="pcbi.1005932.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e021" xlink:type="simple"/><mml:math display="inline" id="M21"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e022"><alternatives><graphic id="pcbi.1005932.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e022" xlink:type="simple"/><mml:math display="inline" id="M22"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> are given by [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>]
<disp-formula id="pcbi.1005932.e023"><alternatives><graphic id="pcbi.1005932.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e023" xlink:type="simple"/><mml:math display="block" id="M23"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mi>P</mml:mi> <mml:mi>r</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:msub><mml:mi mathvariant="script">R</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>r</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>r</mml:mi> <mml:mo>]</mml:mo></mml:mrow> <mml:mi>P</mml:mi> <mml:mi>r</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>n</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(2)</label></disp-formula>
and
<disp-formula id="pcbi.1005932.e024"><alternatives><graphic id="pcbi.1005932.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e024" xlink:type="simple"/><mml:math display="block" id="M24"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mi>P</mml:mi> <mml:mi>r</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:msub><mml:mi mathvariant="script">R</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>r</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>r</mml:mi> <mml:mo>]</mml:mo></mml:mrow> <mml:mi>P</mml:mi> <mml:mi>r</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>n</mml:mi> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(3)</label></disp-formula></p>
<p>Here <inline-formula id="pcbi.1005932.e025"><alternatives><graphic id="pcbi.1005932.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e025" xlink:type="simple"/><mml:math display="inline" id="M25"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e026"><alternatives><graphic id="pcbi.1005932.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e026" xlink:type="simple"/><mml:math display="inline" id="M26"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> are indexed by nonnegative integers <italic>n</italic> and <italic>r</italic>, where <italic>r</italic> ≤ <italic>n</italic>. Let <italic>M</italic> be the maximum possible value of <inline-formula id="pcbi.1005932.e027"><alternatives><graphic id="pcbi.1005932.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e028"><alternatives><graphic id="pcbi.1005932.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e028" xlink:type="simple"/><mml:math display="inline" id="M28"><mml:msubsup><mml:mi>n</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> over all branches. Then, each of <inline-formula id="pcbi.1005932.e029"><alternatives><graphic id="pcbi.1005932.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e029" xlink:type="simple"/><mml:math display="inline" id="M29"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e030"><alternatives><graphic id="pcbi.1005932.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e030" xlink:type="simple"/><mml:math display="inline" id="M30"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> has at most <italic>l</italic> = (1 + (<italic>M</italic> + 1))(<italic>M</italic> + 1)/2 entries.</p>
<p>In the case of a species tree, the path from a leaf to the root is unique. However, this might not be the case for phylogenetic networks: If there is a reticulation node on a path from a leaf to the root, then multiple paths exist between that leaf and the root. This is the issue that necessitates modifying the algorithm of [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>] significantly, and that leads to much larger computational requirements in the case of phylogenetic networks. The key idea behind the modification is as follows. As the algorithm proceeds to compute the likelihood in a bottom-up fashion from the leaves to the root, whenever a reticulation node is encountered, the current set of lineages is bipartitioned in every possible way so that one side of the bipartition tracks one parent of the reticulation node and the other side tracks the other parent. As the network has a unique root, the two sides of each bipartition eventually come back together at an ancestral node. At that point, these two sides are merged properly.</p>
<p>To achieve this proper merger, we introduce “labeled partial likelihoods,” or LPL. Like the case of [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>], LPLs are not “real” partial likelihoods. The reason for this is that when partial likelihood vectors are split (described below), those become symbolic terms that do not evaluate to partial likelihoods until they are merged later. This is analogous to the difference between <italic>ancestral configurations</italic> on species trees [<xref ref-type="bibr" rid="pcbi.1005932.ref031">31</xref>] and their labeled counterparts on phylogenetic networks [<xref ref-type="bibr" rid="pcbi.1005932.ref032">32</xref>], where the latter are in many cases just symbolic terms that do not evaluate to true (partial) likelihood values.</p>
<p>Given a phylogenetic network Ψ with <italic>k</italic> reticulation nodes numbered 0, 1, ⋯, <italic>k</italic> − 1, an LPL <italic>P</italic> is an element of <inline-formula id="pcbi.1005932.e031"><alternatives><graphic id="pcbi.1005932.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e031" xlink:type="simple"/><mml:math display="inline" id="M31"><mml:mrow><mml:msup><mml:mrow><mml:mo>[</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mn>1</mml:mn> <mml:mo>]</mml:mo></mml:mrow> <mml:mi>l</mml:mi></mml:msup> <mml:mo>×</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">Z</mml:mi> <mml:mi>k</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, where the first element of the pair is a partial likelihood as in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>]. The second element is the label to keep track of partial likelihoods that originated from a split of the same partial likelihood at a reticulation node so that these two could be merged. More formally, we say two LPLs <italic>P</italic><sub>1</sub> = (<bold>F</bold><sub>1</sub>, <bold>s</bold><sub>1</sub>) and <italic>P</italic><sub>2</sub> = (<bold>F</bold><sub>2</sub>, <bold>s</bold><sub>2</sub>), where |<bold>s</bold><sub>1</sub>| = |<bold>s</bold><sub>2</sub>|, are compatible if and only if for every 0 ≤ <italic>i</italic> &lt; |<bold>s</bold><sub>1</sub>|, either <bold>s</bold><sub>1</sub>(<italic>i</italic>) = <bold>s</bold><sub>2</sub>(<italic>i</italic>) or <bold>s</bold><sub>1</sub>(<italic>i</italic>) ⋅ <bold>s</bold><sub>2</sub>(<italic>i</italic>) = 0.</p>
<p>We denote by <inline-formula id="pcbi.1005932.e032"><alternatives><graphic id="pcbi.1005932.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e032" xlink:type="simple"/><mml:math display="inline" id="M32"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e033"><alternatives><graphic id="pcbi.1005932.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e033" xlink:type="simple"/><mml:math display="inline" id="M33"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> the sets of LPLs that are associated with the top and bottom of branch <italic>x</italic>, respectively. These two quantities are computed in a bottom-up fashion, proceeding from the leaves of the network towards its root. Once the LPLs at the root are computed, the overall likelihood of a given site is computed. As the algorithm proceeds from the leaves towards the root, it needs to compute LPLs at the leaves, the top of a branch, the bottom of reticulation edges, and the bottom of tree edges. We now describe each of those computations; the overall algorithm is simply a bottom-up traversal of the network while applying the appropriate computation as a node is encountered.</p>
<sec id="sec005">
<title>Computing LPLs for leaf nodes</title>
<p>Consider an external branch <italic>x</italic> that is connected to a leaf node. Let <italic>n</italic><sub><italic>x</italic></sub> denote the number of individuals sampled from the species associated with that leaf, and let <italic>r</italic><sub><italic>x</italic></sub> be the number of red lineages among those individuals. We create LPL <inline-formula id="pcbi.1005932.e034"><alternatives><graphic id="pcbi.1005932.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, where
<disp-formula id="pcbi.1005932.e035"><alternatives><graphic id="pcbi.1005932.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e035" xlink:type="simple"/><mml:math display="block" id="M35"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mn>1</mml:mn> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>r</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mn>0</mml:mn> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(4)</label></disp-formula> <inline-formula id="pcbi.1005932.e036"><alternatives><graphic id="pcbi.1005932.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e036" xlink:type="simple"/><mml:math display="inline" id="M36"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. Finally, we associate <inline-formula id="pcbi.1005932.e037"><alternatives><graphic id="pcbi.1005932.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:msubsup><mml:mi>P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> with the bottom of branch <italic>x</italic>.</p>
<p>As pointed out in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>], the input data may contain dominant markers like AFLPs, which means heterozygotes and homozygotes are not distinguishable for the dominant band. If there are dominant markers in the data, and the red allele is dominant, <inline-formula id="pcbi.1005932.e038"><alternatives><graphic id="pcbi.1005932.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e038" xlink:type="simple"/><mml:math display="inline" id="M38"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> is computed by
<disp-formula id="pcbi.1005932.e039"><alternatives><graphic id="pcbi.1005932.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e039" xlink:type="simple"/><mml:math display="block" id="M39"><mml:msubsup><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>n</mml:mi> <mml:mo>!</mml:mo></mml:mrow> <mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mi>r</mml:mi> <mml:mo>−</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>x</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>!</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mn>2</mml:mn> <mml:msub><mml:mi>r</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mo>−</mml:mo> <mml:mi>r</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>!</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>−</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>x</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>!</mml:mo></mml:mrow></mml:mfrac> <mml:msup><mml:mn>2</mml:mn> <mml:mrow><mml:mn>2</mml:mn> <mml:msub><mml:mi>r</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mo>−</mml:mo> <mml:mi>r</mml:mi></mml:mrow></mml:msup> <mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mn>2</mml:mn> <mml:mi>n</mml:mi></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mi>r</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="right"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="1pt"/> <mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:mn>2</mml:mn> <mml:msub><mml:mi>n</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mspace width="1pt"/> <mml:mtext>and</mml:mtext> <mml:mspace width="1pt"/> <mml:msub><mml:mi>r</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mo>≤</mml:mo> <mml:mi>r</mml:mi> <mml:mo>≤</mml:mo> <mml:mn>2</mml:mn> <mml:msub><mml:mi>r</mml:mi> <mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mn>0</mml:mn> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="right"><mml:mrow><mml:mtext>otherwise</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo>.</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(5)</label></disp-formula>
instead of using <xref ref-type="disp-formula" rid="pcbi.1005932.e035">Eq (4)</xref>, where <italic>r</italic> − <italic>r</italic><sub><italic>x</italic></sub> is the number of homozygous red individuals, 2<italic>r</italic><sub><italic>x</italic></sub> − <italic>r</italic> is the number of heterozygous individuals (red and green), and <italic>n</italic> − <italic>r</italic><sub><italic>x</italic></sub> is the number of homozygous green individuals. There are more details about this computation in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>].</p>
</sec>
<sec id="sec006">
<title>Computing LPLs at the top of a branch</title>
<p>Bryant <italic>et al.</italic> [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>] computed partial likelihoods using a continuous-time Markov chain whose transition rate matrix <inline-formula id="pcbi.1005932.e040"><alternatives><graphic id="pcbi.1005932.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:mi mathvariant="double-struck">Q</mml:mi></mml:math></alternatives></inline-formula> is indexed by ((<italic>n</italic>, <italic>r</italic>); (<italic>n</italic>′, <italic>r</italic>′)) for transitioning from <italic>n</italic> lineages <italic>r</italic> of which are red alleles to <italic>n</italic>′ individuals <italic>r</italic>′ of which are red alleles, and its entries are given by
<disp-formula id="pcbi.1005932.e041"><alternatives><graphic id="pcbi.1005932.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e041" xlink:type="simple"/><mml:math display="block" id="M41"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">Q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo> <mml:mo>;</mml:mo> <mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>-</mml:mo> <mml:mi>r</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>v</mml:mi></mml:mrow></mml:mtd> <mml:mtd/></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">Q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo> <mml:mo>;</mml:mo> <mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>r</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>u</mml:mi></mml:mrow></mml:mtd> <mml:mtd/></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">Q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo> <mml:mo>;</mml:mo> <mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>-</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>n</mml:mi> <mml:mo>/</mml:mo> <mml:mi>θ</mml:mi></mml:mrow></mml:mtd> <mml:mtd/></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">Q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo> <mml:mo>;</mml:mo> <mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>r</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>n</mml:mi> <mml:mo>/</mml:mo> <mml:mi>θ</mml:mi></mml:mrow></mml:mtd> <mml:mtd/></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">Q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo> <mml:mo>;</mml:mo> <mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mo>-</mml:mo> <mml:mi>n</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>/</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>-</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>-</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>v</mml:mi> <mml:mo>-</mml:mo> <mml:mi>r</mml:mi> <mml:mi>u</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(6)</label></disp-formula>
Let <italic>x</italic> be any branch in the phylogenetic network, with <italic>θ</italic> and <italic>t</italic> being the population mutation rate and branch length of <italic>x</italic>, respectively, and assume <inline-formula id="pcbi.1005932.e042"><alternatives><graphic id="pcbi.1005932.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e042" xlink:type="simple"/><mml:math display="inline" id="M42"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> has already been computed. Then,
<disp-formula id="pcbi.1005932.e043"><alternatives><graphic id="pcbi.1005932.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e043" xlink:type="simple"/><mml:math display="block" id="M43"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">F</mml:mi> <mml:mo form="prefix">exp</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="double-struck">Q</mml:mi> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold">s</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>:</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">F</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold">s</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>}</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(7)</label></disp-formula></p>
</sec>
<sec id="sec007">
<title>Computing LPLs at the bottom of reticulation edges</title>
<p>Consider a reticulation node given by two reticulation edges <italic>y</italic> and <italic>z</italic>, with inheritance probabilities <italic>γ</italic> and 1 − <italic>γ</italic>, respectively, and branch <italic>x</italic> emanating from the reticulation node, as illustrated by <xref ref-type="fig" rid="pcbi.1005932.g002">Fig 2</xref>. The main idea in this part is as follows. Given a set of lineages at the top of branch <italic>x</italic>, a subset of those lineages is inherited along branch <italic>y</italic> and the remaining lineages is inherited along branch <italic>z</italic>. Since there are multiple ways of bipartitioning the set of lineages, the labels in an LPL allow the algorithm to keep track of the subsets of lineages that originated from the same split. We now describe this formally.</p>
<fig id="pcbi.1005932.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g002</object-id>
<label>Fig 2</label>
<caption>
<title>An illustration of the decompose-and-split operation.</title>
<p>In this example, partial likelihood <inline-formula id="pcbi.1005932.e044"><alternatives><graphic id="pcbi.1005932.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e044" xlink:type="simple"/><mml:math display="inline" id="M44"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> is decomposed into six vectors <bold>F</bold><sub>0</sub> to <bold>F</bold><sub>5</sub>. An illustration of how <bold>F</bold><sub>4</sub> is split in the four possible ways to trace branches <italic>y</italic> and <italic>z</italic> is shown, and every split is assigned a unique label.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g002" xlink:type="simple"/>
</fig>
<p><bold>Decomposing</bold>: Let (<bold>F</bold>, <bold>s</bold>) be an LPL in <inline-formula id="pcbi.1005932.e045"><alternatives><graphic id="pcbi.1005932.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>. Given that <bold>F</bold> has <italic>l</italic> entries, we decompose <bold>F</bold> into <italic>l</italic> vectors, each with <italic>l</italic> entries: <bold>F</bold><sub>0</sub>, <bold>F</bold><sub>1</sub>, ⋯, <bold>F</bold><sub><italic>l</italic>−1</sub>. Let <inline-formula id="pcbi.1005932.e046"><alternatives><graphic id="pcbi.1005932.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e046" xlink:type="simple"/><mml:math display="inline" id="M46"><mml:mrow><mml:mi>ϕ</mml:mi> <mml:mo>:</mml:mo> <mml:mo>{</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>n</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>r</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>:</mml:mo> <mml:msup><mml:mi>n</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>r</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>∈</mml:mo> <mml:mi mathvariant="double-struck">N</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>r</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>≤</mml:mo> <mml:msup><mml:mi>n</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>≤</mml:mo> <mml:mi>m</mml:mi> <mml:mo>}</mml:mo> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> be given by <italic>ϕ</italic>(<italic>n</italic>′, <italic>r</italic>′) = <italic>n</italic>′(<italic>m</italic> + 1) + <italic>r</italic>′. The entries of <bold>F</bold><sub><italic>i</italic></sub> are set according to
<disp-formula id="pcbi.1005932.e047"><alternatives><graphic id="pcbi.1005932.e047g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e047" xlink:type="simple"/><mml:math display="block" id="M47"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>n</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>r</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mi mathvariant="bold">F</mml:mi> <mml:mo>(</mml:mo> <mml:msup><mml:mi>n</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>r</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mi>ϕ</mml:mi> <mml:mo>(</mml:mo> <mml:msup><mml:mi>n</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>r</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd> <mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable> <mml:mo/> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(8)</label></disp-formula></p>
<p><bold>Splitting</bold>: Consider vector <bold>F</bold><sub><italic>i</italic></sub> and assume <italic>i</italic> = <italic>ϕ</italic>(<italic>n</italic><sub><italic>i</italic></sub>, <italic>r</italic><sub><italic>i</italic></sub>). The existence of <italic>n</italic><sub><italic>i</italic></sub> lineages out of which <italic>r</italic><sub><italic>i</italic></sub> are red at the top of branch <italic>x</italic> means that any 0 ≤ <italic>n</italic><sub><italic>y</italic></sub> ≤ <italic>n</italic><sub><italic>i</italic></sub> lineages of those could be inherited along branch <italic>y</italic>, and out of those 0 ≤ <italic>r</italic><sub><italic>y</italic></sub> ≤ min(<italic>r</italic><sub><italic>i</italic></sub>, <italic>n</italic><sub><italic>y</italic></sub>) could be red; the remaining <italic>n</italic><sub><italic>z</italic></sub> = <italic>n</italic><sub><italic>i</italic></sub> − <italic>n</italic><sub><italic>y</italic></sub> lineages, out of which <italic>r</italic><sub><italic>z</italic></sub> = <italic>r</italic><sub><italic>i</italic></sub> − <italic>r</italic><sub><italic>y</italic></sub> are red, are inherited along branch <italic>z</italic>. Such a split gives rise to two LPLs: <inline-formula id="pcbi.1005932.e048"><alternatives><graphic id="pcbi.1005932.e048g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e048" xlink:type="simple"/><mml:math display="inline" id="M48"><mml:mrow><mml:msub><mml:mi>P</mml:mi> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e049"><alternatives><graphic id="pcbi.1005932.e049g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e049" xlink:type="simple"/><mml:math display="inline" id="M49"><mml:mrow><mml:msub><mml:mi>P</mml:mi> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> with <inline-formula id="pcbi.1005932.e050"><alternatives><graphic id="pcbi.1005932.e050g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e050" xlink:type="simple"/><mml:math display="inline" id="M50"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e051"><alternatives><graphic id="pcbi.1005932.e051g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e051" xlink:type="simple"/><mml:math display="inline" id="M51"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> assigned the same value that is unique to the specific split. For this specific split we define
<disp-formula id="pcbi.1005932.e052"><alternatives><graphic id="pcbi.1005932.e052g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e052" xlink:type="simple"/><mml:math display="block" id="M52"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>δ</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>(</mml:mo> <mml:mfrac linethickness="0pt"><mml:msub><mml:mi>n</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mfrac> <mml:mo>)</mml:mo> <mml:msup><mml:mi>γ</mml:mi> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:msup> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn>1</mml:mn> <mml:mo>-</mml:mo> <mml:mi>γ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msup> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(9)</label></disp-formula>
and compute <inline-formula id="pcbi.1005932.e053"><alternatives><graphic id="pcbi.1005932.e053g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e053" xlink:type="simple"/><mml:math display="inline" id="M53"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e054"><alternatives><graphic id="pcbi.1005932.e054g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e054" xlink:type="simple"/><mml:math display="inline" id="M54"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> by
<disp-formula id="pcbi.1005932.e055"><alternatives><graphic id="pcbi.1005932.e055g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e055" xlink:type="simple"/><mml:math display="block" id="M55"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold">F</mml:mi> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>δ</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>r</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mn>0</mml:mn> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable> <mml:mo/> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(10)</label></disp-formula>
and
<disp-formula id="pcbi.1005932.e056"><alternatives><graphic id="pcbi.1005932.e056g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e056" xlink:type="simple"/><mml:math display="block" id="M56"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold">F</mml:mi> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mn>1</mml:mn> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>r</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mn>0</mml:mn> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable> <mml:mo/> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(11)</label></disp-formula>
The resulting <italic>P</italic><sub><italic>y</italic></sub> and <italic>P</italic><sub><italic>z</italic></sub> from all possible splits constitute the elements of the sets <inline-formula id="pcbi.1005932.e057"><alternatives><graphic id="pcbi.1005932.e057g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e057" xlink:type="simple"/><mml:math display="inline" id="M57"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>y</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e058"><alternatives><graphic id="pcbi.1005932.e058g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e058" xlink:type="simple"/><mml:math display="inline" id="M58"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>, respectively. The full procedure for executing the decompose-and-split operations is given in Algorithm 1.</p>
<p><bold>Algorithm 1:</bold> <bold>Compute LPLs at Bottom of Reticulation Edges</bold>.</p>
<p specific-use="line"><bold>Input:</bold> Reticulation node <italic>j</italic> and the three distinct branches <italic>y</italic> = (<italic>u</italic>, <italic>j</italic>), <italic>z</italic> = (<italic>v</italic>, <italic>j</italic>) and <italic>x</italic> = (<italic>j</italic>, <italic>w</italic>) associated with it; set <inline-formula id="pcbi.1005932.e059"><alternatives><graphic id="pcbi.1005932.e059g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e059" xlink:type="simple"/><mml:math display="inline" id="M59"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>.</p>
<p specific-use="line"><bold>Output:</bold> Sets <inline-formula id="pcbi.1005932.e060"><alternatives><graphic id="pcbi.1005932.e060g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e060" xlink:type="simple"/><mml:math display="inline" id="M60"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>y</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005932.e061"><alternatives><graphic id="pcbi.1005932.e061g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e061" xlink:type="simple"/><mml:math display="inline" id="M61"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>.</p>
<p specific-use="line"><italic>o</italic><sub><italic>j</italic></sub> ← 0;</p>
<p specific-use="line">
<inline-formula id="pcbi.1005932.e062">
<alternatives>
<graphic id="pcbi.1005932.e062g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e062" xlink:type="simple"/>
<mml:math display="inline" id="M62">
<mml:mrow>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>y</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>←</mml:mo>
<mml:mi>∅</mml:mi>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>
;</p>
<p specific-use="line">
<inline-formula id="pcbi.1005932.e063">
<alternatives>
<graphic id="pcbi.1005932.e063g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e063" xlink:type="simple"/>
<mml:math display="inline" id="M63">
<mml:mrow>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>z</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>←</mml:mo>
<mml:mi>∅</mml:mi>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>
;</p>
<p specific-use="line"><bold>foreach</bold> <inline-formula id="pcbi.1005932.e064"><alternatives><graphic id="pcbi.1005932.e064g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e064" xlink:type="simple"/><mml:math display="inline" id="M64"><mml:mrow><mml:mo>(</mml:mo> <mml:mtext mathvariant="bold">F</mml:mtext> <mml:mo>,</mml:mo> <mml:mtext mathvariant="bold">s</mml:mtext> <mml:mo>)</mml:mo> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> <bold>do</bold></p>
<p specific-use="line"> <italic>l</italic> ← number of entries in <bold>F</bold>;</p>
<p specific-use="line"> <bold>if</bold> <italic>l</italic> = 0 <bold>then</bold></p>
<p specific-use="line">  <inline-formula id="pcbi.1005932.e065">
<alternatives>
<graphic id="pcbi.1005932.e065g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e065" xlink:type="simple"/>
<mml:math display="inline" id="M65">
<mml:mrow>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>y</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>←</mml:mo>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>y</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>∪</mml:mo>
<mml:mrow>
<mml:mo>{</mml:mo>
<mml:mo>(</mml:mo>
</mml:mrow>
<mml:mi mathvariant="bold">F</mml:mi>
<mml:mo>,</mml:mo>
<mml:mtext mathvariant="bold">s</mml:mtext>
<mml:mo>)</mml:mo>
<mml:mo>}</mml:mo>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>;</p>
<p specific-use="line">  <inline-formula id="pcbi.1005932.e066">
<alternatives>
<graphic id="pcbi.1005932.e066g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e066" xlink:type="simple"/>
<mml:math display="inline" id="M66">
<mml:mrow>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>z</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>←</mml:mo>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>z</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>∪</mml:mo>
<mml:mrow>
<mml:mo>{</mml:mo>
<mml:mo>(</mml:mo>
</mml:mrow>
<mml:mi mathvariant="bold">F</mml:mi>
<mml:mo>,</mml:mo>
<mml:mtext mathvariant="bold">s</mml:mtext>
<mml:mo>)</mml:mo>
<mml:mo>}</mml:mo>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>;</p>
<p specific-use="line"> <bold>end</bold></p>
<p specific-use="line"> <bold>// decompose</bold></p>
<p specific-use="line"> <bold>for</bold> <italic>i</italic> = 1 → <italic>l</italic> − 1 <bold>do</bold></p>
<p specific-use="line">  (<italic>n</italic><sub><italic>i</italic></sub>, <italic>r</italic><sub><italic>i</italic></sub>) ← <italic>ϕ</italic><sup>−1</sup>(<italic>i</italic>);</p>
<p specific-use="line">  Compute <bold>F</bold><sub><italic>i</italic></sub> using <xref ref-type="disp-formula" rid="pcbi.1005932.e047">Eq (8)</xref>;</p>
<p specific-use="line">  <bold>// split</bold></p>
<p specific-use="line">  <bold>foreach</bold> 0 ≤ <italic>n</italic><sub><italic>y</italic></sub> ≤ <italic>n</italic><sub><italic>i</italic></sub> <italic>and</italic> 0 ≤ <italic>r</italic><sub><italic>y</italic></sub> ≤ min(<italic>r</italic><sub><italic>i</italic></sub>, <italic>n</italic><sub><italic>y</italic></sub>) <bold>do</bold></p>
<p specific-use="line">   (<italic>n</italic><sub><italic>z</italic></sub>, <italic>r</italic><sub><italic>z</italic></sub>) ← (<italic>n</italic><sub><italic>i</italic></sub> − <italic>n</italic><sub><italic>y</italic></sub>, <italic>r</italic><sub><italic>i</italic></sub> − <italic>r</italic><sub><italic>y</italic></sub>);</p>
<p specific-use="line">   <inline-formula id="pcbi.1005932.e067"><alternatives><graphic id="pcbi.1005932.e067g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e067" xlink:type="simple"/><mml:math display="inline" id="M67"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>←</mml:mo> <mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>; <inline-formula id="pcbi.1005932.e068"><alternatives><graphic id="pcbi.1005932.e068g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e068" xlink:type="simple"/><mml:math display="inline" id="M68"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>←</mml:mo> <mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>;</p>
<p specific-use="line">   <inline-formula id="pcbi.1005932.e069"><alternatives><graphic id="pcbi.1005932.e069g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e069" xlink:type="simple"/><mml:math display="inline" id="M69"><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo stretchy="false">(</mml:mo> <mml:mi>j</mml:mi> <mml:mo stretchy="false">)</mml:mo> <mml:mo>←</mml:mo> <mml:msub><mml:mi>o</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:math></alternatives></inline-formula>; <inline-formula id="pcbi.1005932.e070"><alternatives><graphic id="pcbi.1005932.e070g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e070" xlink:type="simple"/><mml:math display="inline" id="M70"><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo stretchy="false">(</mml:mo> <mml:mi>j</mml:mi> <mml:mo stretchy="false">)</mml:mo> <mml:mo>←</mml:mo> <mml:msub><mml:mi>o</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:math></alternatives></inline-formula>;</p>
<p specific-use="line">   Compute <inline-formula id="pcbi.1005932.e071"><alternatives><graphic id="pcbi.1005932.e071g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e071" xlink:type="simple"/><mml:math display="inline" id="M71"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e072"><alternatives><graphic id="pcbi.1005932.e072g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e072" xlink:type="simple"/><mml:math display="inline" id="M72"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> Eqs <xref ref-type="disp-formula" rid="pcbi.1005932.e055">(10)</xref> and <xref ref-type="disp-formula" rid="pcbi.1005932.e056">(11)</xref>;</p>
<p specific-use="line">   <inline-formula id="pcbi.1005932.e073"><alternatives><graphic id="pcbi.1005932.e073g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e073" xlink:type="simple"/><mml:math display="inline" id="M73"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>y</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>←</mml:mo> <mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>y</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>∪</mml:mo> <mml:mo>{</mml:mo> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:mspace width="1pt"/> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo stretchy="false">)</mml:mo> <mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>;</p>
<p specific-use="line">   <inline-formula id="pcbi.1005932.e074"><alternatives><graphic id="pcbi.1005932.e074g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e074" xlink:type="simple"/><mml:math display="inline" id="M74"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>←</mml:mo> <mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>∪</mml:mo> <mml:mo>{</mml:mo> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:mspace width="1pt"/> <mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>s</mml:mi></mml:mstyle> <mml:mrow><mml:mi>z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mo stretchy="false">)</mml:mo> <mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>;</p>
<p specific-use="line">   <italic>o</italic><sub><italic>j</italic></sub> ← <italic>o</italic><sub><italic>j</italic></sub> + 1;</p>
<p specific-use="line">  <bold>end</bold></p>
<p specific-use="line"> <bold>end</bold></p>
<p specific-use="line"><bold>end</bold></p>
<p specific-use="line"><bold>return</bold> <inline-formula id="pcbi.1005932.e075">
<alternatives>
<graphic id="pcbi.1005932.e075g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e075" xlink:type="simple"/>
<mml:math display="inline" id="M75">
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>y</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
</mml:math>
</alternatives>
</inline-formula>, <inline-formula id="pcbi.1005932.e076"><alternatives><graphic id="pcbi.1005932.e076g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e076" xlink:type="simple"/><mml:math display="inline" id="M76"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>;</p>
<p>Let <italic>n</italic> be the number of individuals in branch <italic>x</italic> and all its descendants. In the middle for loop, <italic>l</italic>, which is the number of entries in each <bold>F</bold>, equals to <italic>O</italic>(<italic>n</italic><sup>2</sup>). The inner foreach loop over <italic>n</italic><sub><italic>i</italic></sub> and <italic>r</italic><sub><italic>i</italic></sub> runs for <italic>O</italic>(<italic>n</italic><sup>2</sup>) times. Therefore the number of pairs of new LPLs generated is <italic>O</italic>(<italic>n</italic><sup>4</sup>) for each LPL in branch <italic>x</italic>.</p>
</sec>
<sec id="sec008">
<title>Computing LPLs at the bottom of a tree edge</title>
<p>Consider an internal tree node <italic>j</italic> with its three associated edges <italic>x</italic> = (<italic>u</italic>, <italic>j</italic>), <italic>y</italic> = (<italic>j</italic>, <italic>v</italic>), and <italic>z</italic> = (<italic>j</italic>, <italic>w</italic>). We are interested in computing the set <inline-formula id="pcbi.1005932.e077"><alternatives><graphic id="pcbi.1005932.e077g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e077" xlink:type="simple"/><mml:math display="inline" id="M77"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> in terms of the two sets <inline-formula id="pcbi.1005932.e078"><alternatives><graphic id="pcbi.1005932.e078g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e078" xlink:type="simple"/><mml:math display="inline" id="M78"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>y</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e079"><alternatives><graphic id="pcbi.1005932.e079g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e079" xlink:type="simple"/><mml:math display="inline" id="M79"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>. The labels in LPLs allow the algorithm to determine whether two LPLs originated from a split at a descendant reticulation node or not (including the case of no descendant reticulation nodes of node <italic>j</italic>). Let <italic>P</italic><sub><italic>y</italic></sub> = (<bold>F</bold><sub><italic>y</italic></sub>, <bold>s</bold><sub><italic>y</italic></sub>) and <italic>P</italic><sub><italic>z</italic></sub> = (<bold>F</bold><sub><italic>z</italic></sub>, <bold>s</bold><sub><italic>z</italic></sub>) be two elements of <inline-formula id="pcbi.1005932.e080"><alternatives><graphic id="pcbi.1005932.e080g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e080" xlink:type="simple"/><mml:math display="inline" id="M80"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>y</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005932.e081"><alternatives><graphic id="pcbi.1005932.e081g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e081" xlink:type="simple"/><mml:math display="inline" id="M81"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>, respectively, that are compatible. A label <bold>s</bold><sub><italic>x</italic></sub> is computed by
<disp-formula id="pcbi.1005932.e082"><alternatives><graphic id="pcbi.1005932.e082g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e082" xlink:type="simple"/><mml:math display="block" id="M82"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="0.277778em"/><mml:msub><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="4pt"/><mml:mi>o</mml:mi> <mml:mi>r</mml:mi> <mml:mspace width="4pt"/><mml:msub><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>z</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="0.277778em"/><mml:msub><mml:mi mathvariant="bold">s</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(12)</label></disp-formula>
for 0 ≤ <italic>i</italic> ≤ |<bold>s</bold><sub><italic>y</italic></sub>|. Furthermore, <bold>F</bold><sub><italic>x</italic></sub> is computed by
<disp-formula id="pcbi.1005932.e083"><alternatives><graphic id="pcbi.1005932.e083g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e083" xlink:type="simple"/><mml:math display="block" id="M83"><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mi>x</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:munderover></mml:mstyle> <mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow> <mml:mi>r</mml:mi></mml:munderover></mml:mstyle> <mml:msubsup><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mi>y</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:msubsup><mml:mstyle mathsize="normal" mathvariant="bold"><mml:mi>F</mml:mi></mml:mstyle> <mml:mi>z</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>−</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>r</mml:mi> <mml:mo>−</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow/></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>×</mml:mo> <mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>r</mml:mi></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>n</mml:mi> <mml:mo>−</mml:mo> <mml:mi>r</mml:mi></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>−</mml:mo> <mml:msub><mml:mi>r</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>n</mml:mi></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(13)</label></disp-formula>
The LPL (<bold>F</bold><sub><italic>x</italic></sub>, <bold>s</bold><sub><italic>x</italic></sub>) is added to <inline-formula id="pcbi.1005932.e084"><alternatives><graphic id="pcbi.1005932.e084g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e084" xlink:type="simple"/><mml:math display="inline" id="M84"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>. The full procedure for computing set <inline-formula id="pcbi.1005932.e085"><alternatives><graphic id="pcbi.1005932.e085g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e085" xlink:type="simple"/><mml:math display="inline" id="M85"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> is given in Algorithm 2.</p>
<p><bold>Algorithm 2:</bold> <bold>Compute LPLs at Bottom of Tree Edge.</bold></p>
<p specific-use="line"><bold>Input:</bold> Internal tree node <italic>j</italic> and the three distinct branches <italic>y</italic> = (<italic>j</italic>, <italic>v</italic>), <italic>z</italic> = (<italic>j</italic>, <italic>w</italic>) and <italic>x</italic> = (<italic>u</italic>, <italic>j</italic>) associated with it; sets <inline-formula id="pcbi.1005932.e086"><alternatives><graphic id="pcbi.1005932.e086g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e086" xlink:type="simple"/><mml:math display="inline" id="M86"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>y</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005932.e087"><alternatives><graphic id="pcbi.1005932.e087g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e087" xlink:type="simple"/><mml:math display="inline" id="M87"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>z</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>.</p>
<p specific-use="line"><bold>Output:</bold> Set <inline-formula id="pcbi.1005932.e088"><alternatives><graphic id="pcbi.1005932.e088g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e088" xlink:type="simple"/><mml:math display="inline" id="M88"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mi>x</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>.</p>
<p specific-use="line">
<inline-formula id="pcbi.1005932.e089">
<alternatives>
<graphic id="pcbi.1005932.e089g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e089" xlink:type="simple"/>
<mml:math display="inline" id="M89">
<mml:mrow>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>x</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>←</mml:mo>
<mml:mi>∅</mml:mi>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>;</p>
<p specific-use="line"><bold>foreach</bold> <inline-formula id="pcbi.1005932.e090">
<alternatives>
<graphic id="pcbi.1005932.e090g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e090" xlink:type="simple"/>
<mml:math display="inline" id="M90">
<mml:mrow>
<mml:mrow>
<mml:mo>(</mml:mo>
<mml:msub>
<mml:mi mathvariant="bold">F</mml:mi>
<mml:mi>y</mml:mi>
</mml:msub>
<mml:mo>,</mml:mo>
<mml:msub>
<mml:mi mathvariant="bold">s</mml:mi>
<mml:mi>y</mml:mi>
</mml:msub>
<mml:mo>)</mml:mo>
</mml:mrow>
<mml:mo>∈</mml:mo>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>y</mml:mi>
<mml:mi>T</mml:mi>
</mml:msubsup>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula> <bold>do</bold></p>
<p specific-use="line"> <bold>foreach</bold> <inline-formula id="pcbi.1005932.e091">
<alternatives>
<graphic id="pcbi.1005932.e091g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e091" xlink:type="simple"/>
<mml:math display="inline" id="M91">
<mml:mrow>
<mml:mrow>
<mml:mo>(</mml:mo>
<mml:msub>
<mml:mi mathvariant="bold">F</mml:mi>
<mml:mi>z</mml:mi>
</mml:msub>
<mml:mo>,</mml:mo>
<mml:msub>
<mml:mi mathvariant="bold">s</mml:mi>
<mml:mi>z</mml:mi>
</mml:msub>
<mml:mo>)</mml:mo>
</mml:mrow>
<mml:mo>∈</mml:mo>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>z</mml:mi>
<mml:mi>T</mml:mi>
</mml:msubsup>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula> <bold>do</bold></p>
<p specific-use="line">  <bold>if</bold> <bold>s</bold><sub><italic>y</italic></sub> <italic>and</italic> <bold>s</bold><sub><italic>z</italic></sub> <italic>are compatible</italic> <bold>then</bold></p>
<p specific-use="line">   Compute <bold>s</bold><sub><italic>x</italic></sub> using <xref ref-type="disp-formula" rid="pcbi.1005932.e082">Eq (12)</xref>;</p>
<p specific-use="line">   Compute <bold>F</bold><sub><italic>x</italic></sub> using <xref ref-type="disp-formula" rid="pcbi.1005932.e083">Eq (13)</xref>;</p>
<p specific-use="line">   <inline-formula id="pcbi.1005932.e092">
<alternatives>
<graphic id="pcbi.1005932.e092g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e092" xlink:type="simple"/>
<mml:math display="inline" id="M92">
<mml:mrow>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>x</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>←</mml:mo>
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>x</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
<mml:mo>∪</mml:mo>
<mml:mrow>
<mml:mo>{</mml:mo>
<mml:mrow>
<mml:mo>(</mml:mo>
<mml:msub>
<mml:mi mathvariant="bold">F</mml:mi>
<mml:mi>x</mml:mi>
</mml:msub>
<mml:mo>,</mml:mo>
<mml:msub>
<mml:mi mathvariant="bold">s</mml:mi>
<mml:mi>x</mml:mi>
</mml:msub>
<mml:mo>)</mml:mo>
</mml:mrow>
<mml:mo>}</mml:mo>
</mml:mrow>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>;</p>
<p specific-use="line">  <bold>end</bold></p>
<p specific-use="line"> <bold>end</bold></p>
<p specific-use="line"><bold>end</bold></p>
<p specific-use="line"><bold>return</bold> <inline-formula id="pcbi.1005932.e093">
<alternatives>
<graphic id="pcbi.1005932.e093g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e093" xlink:type="simple"/>
<mml:math display="inline" id="M93">
<mml:msubsup>
<mml:mi mathvariant="script">P</mml:mi>
<mml:mi>x</mml:mi>
<mml:mi>B</mml:mi>
</mml:msubsup>
</mml:math>
</alternatives>
</inline-formula>;</p>
</sec>
<sec id="sec009">
<title>Termination: Computation above root node</title>
<p>Let the infinite-length branch associated with root be <italic>ρ</italic>. Then, we let <inline-formula id="pcbi.1005932.e094"><alternatives><graphic id="pcbi.1005932.e094g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e094" xlink:type="simple"/><mml:math display="inline" id="M94"><mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mi>ρ</mml:mi> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> be the sum of all vectors <bold>F</bold> in elements (<bold>F</bold>, <bold>s</bold>) of set <inline-formula id="pcbi.1005932.e095"><alternatives><graphic id="pcbi.1005932.e095g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e095" xlink:type="simple"/><mml:math display="inline" id="M95"><mml:msubsup><mml:mi mathvariant="script">P</mml:mi> <mml:mrow><mml:mi>ρ</mml:mi></mml:mrow> <mml:mi>B</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>.</p>
<p>To obtain the overall likelihood <inline-formula id="pcbi.1005932.e096"><alternatives><graphic id="pcbi.1005932.e096g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e096" xlink:type="simple"/><mml:math display="inline" id="M96"><mml:mrow><mml:mi mathvariant="script">L</mml:mi> <mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:msub><mml:mi>S</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> given the data <italic>S</italic><sub><italic>i</italic></sub> for site <italic>i</italic>, vector <bold>x</bold> is obtained as a nonzero solution of <inline-formula id="pcbi.1005932.e097"><alternatives><graphic id="pcbi.1005932.e097g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e097" xlink:type="simple"/><mml:math display="inline" id="M97"><mml:mrow><mml:mi mathvariant="double-struck">Q</mml:mi> <mml:mi mathvariant="bold">x</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. Like in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>], <bold>x</bold> is indexed by (<italic>n</italic>, <italic>r</italic>) pairs, such that <bold>x</bold>(1, 0) + <bold>x</bold>(1, 1) = 1. Hence we have <bold>x</bold>(<italic>n</italic>, <italic>r</italic>) = <italic>Pr</italic>[<italic>R</italic> = <italic>r</italic>|<italic>N</italic> = <italic>n</italic>], where <italic>N</italic> is the number of lineages and <italic>R</italic> is the number of red lineages, if we sample from a single population of constant size with same distribution for the root allele probabilities and allele frequencies as in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>]. The likelihood is given by
<disp-formula id="pcbi.1005932.e098"><alternatives><graphic id="pcbi.1005932.e098g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e098" xlink:type="simple"/><mml:math display="block" id="M98"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi mathvariant="script">L</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:msub><mml:mi>S</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">F</mml:mi> <mml:mrow><mml:mi>ρ</mml:mi></mml:mrow> <mml:mi>B</mml:mi></mml:msubsup> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold">x</mml:mi> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(14)</label></disp-formula></p>
</sec>
<sec id="sec010">
<title>Optimizing the computation</title>
<p>As described above, the partial likelihood vectors are split to follow every possible way
of bipartitioning a set of lineages at a reticulation node. It is this operation that leads to a significant increase in the running time and memory requirement of the likelihood computation as compared to the case of species trees. Here we describe an optimization step that we employ to improve performance in terms of computational requirements, without affecting the correctness of the likelihood computation.</p>
<p>An <italic>articulation node</italic> in a graph is a node whose removal disconnects the graph into two or more components. In a directed graph, a <italic>lowest articulation node</italic> is an articulation node that has at least one child that is neither an articulation node nor a leaf. For example, in a tree, every node is an articulation node. However, in a phylogenetic network that is not necessarily the case. For example, in the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g001">Fig 1</xref>, the reticulation node is an articulation node. However, the root of the network is the only lowest articulation node (its removal disconnects the special node <italic>s</italic>—the parent of the infinite-length branch above the root—from the rest of the network). The reticulation node is not a lowest articulation node since it has one child and that child is a leaf.</p>
<p>The main idea of the optimization is that all LPLs at a lowest articulation node could be merged into a single LPL, thus avoiding carrying forth all that information. More formally, given a set of LPLs at the bottom of a lowest articulation node, a new LPL is produced by summing all the partial likelihood vectors in the LPLs, and assigning it an empty label. This new LPL is the only one assigned to the bottom of the articulation node; all other LPLs are deleted.</p>
</sec>
</sec>
<sec id="sec011">
<title>Time complexity</title>
<p>Our algorithm computes the likelihood of a phylogenetic network given a set of biallelic markers. This algorithm computes matrix exponential along every branch, and processes the network’s nodes in a post-order traversal. Computation at a leaf takes <italic>O</italic>(1) time.</p>
<p>At a reticulation node, the time consumption increases after each reticulation node is processed, due to the accumulation of (split) LPLs. In the last processed reticulation node, the number of LPLs in its descendant is at most <italic>O</italic>(<italic>n</italic><sup>4(<italic>k</italic>−1)</sup>). There are at most <italic>O</italic>(<italic>n</italic><sup>4</sup>) new LPLs generated due to decompose-and-split operation for each original LPL. Therefore the time complexity of processing a reticulation node is at most <italic>O</italic>(<italic>n</italic><sup>4<italic>k</italic></sup>). We adopted the same approximation of matrix exponential as in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>], so the time complexity of computing matrix exponentiation is <italic>O</italic>(<italic>n</italic><sup>2</sup>), and computation along every branch is at most <italic>O</italic>(<italic>n</italic><sup>4<italic>k</italic>+2</sup>).</p>
<p>At a tree node, computation is mostly spent on evaluating <xref ref-type="disp-formula" rid="pcbi.1005932.e083">Eq (13)</xref>. Let <italic>n</italic> be the number of individuals present under an internal tree node. Then, this evaluation takes <italic>O</italic>(<italic>n</italic><sup>4</sup>) time for a pair of compatible LPLs. The total time consumption of processing tree nodes also depends on the number of LPLs. Assuming <italic>k</italic> reticulation nodes in the phylogenetic network, there are at most <italic>O</italic>(<italic>n</italic><sup>4<italic>k</italic></sup>) pairs of compatible LPLs. Therefore the time complexity of processing a tree node is <italic>O</italic>(<italic>n</italic><sup>4<italic>k</italic>+4</sup>).</p>
<p>In total, the time complexity of the algorithm is <italic>O</italic>(<italic>mn</italic><sup>4<italic>k</italic>+4</sup>), where <italic>m</italic> is the number of species, <italic>n</italic> is the total number of lineages sampled from the species, and <italic>k</italic> is the number of reticulation nodes. Notice that when <italic>k</italic> = 0, which means the species phylogeny is a tree, the time complexity is <italic>O</italic>(<italic>mn</italic><sup>4</sup>), which is the running time of the SNAPP algorithm without fast Fourier transforms.</p>
<p>To speed up computation, and since markers are independent, computations for the individual markers are parallelized by multi-threading. Furthermore, the data is preprocessed so that the unique marker patterns are identified and their probabilities are computed only once and reused for for all markers with the same patterns (states for the taxa).</p>
</sec>
<sec id="sec012">
<title>Bayesian inference</title>
<p>The prior on the phylogenetic network is the same as that employed in [<xref ref-type="bibr" rid="pcbi.1005932.ref023">23</xref>], which we review briefly here. The prior is given by
<disp-formula id="pcbi.1005932.e099"><alternatives><graphic id="pcbi.1005932.e099g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e099" xlink:type="simple"/><mml:math display="block" id="M99"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>ν</mml:mi> <mml:mo>,</mml:mo> <mml:mi>δ</mml:mi> <mml:mo>,</mml:mo> <mml:mi>η</mml:mi> <mml:mo>,</mml:mo> <mml:mi>ζ</mml:mi> <mml:mo>,</mml:mo> <mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>u</mml:mi> <mml:mi>m</mml:mi> <mml:mi>r</mml:mi> <mml:mi>e</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>ν</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>×</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mi>i</mml:mi> <mml:mi>a</mml:mi> <mml:mi>m</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>η</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>×</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mi>i</mml:mi> <mml:mi>v</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>δ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>×</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>p</mml:mi> <mml:mi>o</mml:mi> <mml:mi>p</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>ζ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>×</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>n</mml:mi> <mml:mi>h</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(15)</label></disp-formula>
Here, <italic>p</italic>(Ψ|<italic>ν</italic>) is a Poisson prior on the number of reticulation nodes, normalized by the number of networks with the same number of reticulation nodes as Ψ. <italic>p</italic><sub><italic>diam</italic></sub>(Ψ|<italic>η</italic>) is an exponential prior on the diameters of reticulation nodes. The diameter of a reticulation node is the sum of the branch lengths on the cycle that contains the reticulation node in the underlying undirected graph of the network. <italic>p</italic><sub><italic>div</italic></sub>(Ψ|<italic>δ</italic>) is an exponential prior on the divergence times. Rannala and Yang used independent Gamma distributions for time intervals (branch lengths) instead of divergence times. However, in the absence of any information on the number of edges of the species network as well as the time intervals, it is computationally intensive to infer the hyperparameters of independent Gamma distributions. Currently, we use a uniform distribution (as in BEST [<xref ref-type="bibr" rid="pcbi.1005932.ref033">33</xref>]). <italic>p</italic><sub><italic>pop</italic></sub>(Ψ|<italic>ζ</italic>) is a Gamma prior on the population mutation rate. For <italic>p</italic><sub><italic>pop</italic></sub>, we use the Gamma distribution Γ(2, <italic>ζ</italic>) with mean value 2<italic>ζ</italic> and shape parameter 2. <italic>p</italic><sub><italic>inh</italic></sub>(Ψ|<italic>α</italic>, <italic>β</italic>) is a Beta prior, with parameters <italic>α</italic> and <italic>β</italic>, on the inheritance probabilities. Unless there is some specific knowledge on the inheritance probabilities, a uniform prior on [0, 1] is adopted by setting <italic>α</italic> = <italic>β</italic> = 1.</p>
<p>It is important to note here that if the topology of Ψ does not follow the phylogenetic network definition (e.g., has a cycle), then <italic>p</italic>(Ψ|<italic>ν</italic>, <italic>δ</italic>, <italic>η</italic>, <italic>ψ</italic>) = 0. This is crucial since, in the MCMC kernels we employ for sampling the posterior distribution, we allow the moves to produce directed graphs that slightly deviate from the definition; in this case, having the prior be 0 guarantees that the proposal is rejected. Using the strategy, rather than defining only “legal” moves simplifies the calculation of the Hastings ratios. However, the sampler always guarantees that the divergence times are consistent; that is, no node has a divergence time smaller than or equal to the divergence time of any of its descendants.</p>
<p>We employed the reversible-jump MCMC, or RJMCMC [<xref ref-type="bibr" rid="pcbi.1005932.ref034">34</xref>] algorithm implemented in PhyloNet [<xref ref-type="bibr" rid="pcbi.1005932.ref030">30</xref>] to sample from the posterior distribution given by
<disp-formula id="pcbi.1005932.e100"><alternatives><graphic id="pcbi.1005932.e100g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005932.e100" xlink:type="simple"/><mml:math display="block" id="M100"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>S</mml:mi> <mml:mo>)</mml:mo> <mml:mo>∝</mml:mo> <mml:mi mathvariant="script">L</mml:mi> <mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>|</mml:mo> <mml:mi>S</mml:mi> <mml:mo>)</mml:mo> <mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:mo>Ψ</mml:mo> <mml:mo>)</mml:mo> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(16)</label></disp-formula>
where Ψ here denotes the topology of the network and all its parameters, and <italic>p</italic>(Ψ) is the prior on the network and its parameters as described above.</p>
<p>We make use of only the 12 proposals designed for sampling phylogenetic networks and their parameters described in [<xref ref-type="bibr" rid="pcbi.1005932.ref023">23</xref>], but not the proposals aimed at sampling gene trees, as gene trees are integrated out.</p>
</sec>
<sec id="sec013">
<title>Synthetic data generation</title>
<p>We implemented in PhyloNet [<xref ref-type="bibr" rid="pcbi.1005932.ref030">30</xref>] a program to simulate bi-allelic markers on a given phylogenetic network. Bryant <italic>et al.</italic> [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>] simulated bi-allelic markers by first generating gene trees inside a species tree (under the multispecies coalescent model), and then simulating the markers down the gene trees. In our case, we replaced the first step by generating gene trees inside a phylogenetic network under the multispecies network coalescent [<xref ref-type="bibr" rid="pcbi.1005932.ref026">26</xref>]; the second step of simulating bi-allelic markers down gene trees remains the same as that employed in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>]. When requiring the data set to contain only polymorphic sites, if the generated site is not polymorphic, we discard both gene tree and markers, and repeat until a polymorphic site is generated.</p>
</sec>
</sec>
<sec id="sec014" sec-type="results">
<title>Results</title>
<sec id="sec015">
<title>Simulations</title>
<sec id="sec016">
<title>The method’s ability to infer the phylogenetic network topology</title>
<p>We used the following commands in PhyloNet to generate 200 data sets, 20 replicates for each of the two model phylogenetic networks in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3</xref> and each number of sites (<italic>numsites</italic> ∈ {100, 1000, 10000, 100000, 1000000)}:</p>
<list list-type="simple">
<list-item><p><monospace>SimBiMarkersinNetwork -pi0 0.5 -sd seed -num numsites -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt; -truenet “[0.006](((((Q:0.004:0.006)I5#H1:0.002:0.005:0.7,A:0.006:0.006)I3:0.016:0.005,L:0.022:0.006)I2:0.02:0.005,(I5#H1:0.003:0.005:0.3,R:0.007:0.006)I4:0.035:0.005)I1:0.038:0.005,C:0.08:0.006);” -out “markers.txt”;</monospace></p></list-item>
<list-item><p><monospace>SimBiMarkersinNetwork -pi0 0.5 -sd seed -num numsites -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt; -truenet “[0.006](((((Q:0.004:0.006)I5#H1:0.002:0.005:0.7,(A:0.003:0.006)I6 H2:0.003:0.005:0.6)I3:0.016:0.005,L:0.022:0.006)I2:0.02:0.005,(I5#H1:0.003:0.005:0.3,R:0.014:0.006)I4:0.028:0.005)I1:0.038:0.005,(C:0.005:0.006,I6#H2:0.002:0.005:0.4)I7:0.075:0.005);” -out “markers.txt”;</monospace></p></list-item>
</list>
<p specific-use="continuation">For the value of <italic>seed</italic> in the “-sd” option, we used a different 8-digit integer for each of the 20 replicates.</p>
<fig id="pcbi.1005932.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g003</object-id>
<label>Fig 3</label>
<caption>
<title>The two model phylogenetic networks used to generate the simulated data sets.</title>
<p>The branch lengths of the phylogenetic networks are measured in units of expected number of mutations per site (scale is shown). The inheritance probabilities are marked in blue. Both networks are based on the same “backbone” tree: Removing the R→Q reticulation edge in (A) and the C→A and R→Q reticulation edges in (B) gives rise to the tree (C,(R,(L,(A,Q)))). The hybridization events in the panel can be viewed as involving pairs of branches of this tree: (A) The hybridization is from R to Q. (B) One hybridization is from R to Q and another is from C to A.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g003" xlink:type="simple"/>
</fig>
<p>The true networks of those commands correspond to two models, given by the two phylogenetic networks, their branch lengths, and inheritance probabilities, shown in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3</xref>. These networks and parameters were inspired by the phylogenetic networks inferred from an empirical genomic data set in [<xref ref-type="bibr" rid="pcbi.1005932.ref021">21</xref>, <xref ref-type="bibr" rid="pcbi.1005932.ref022">22</xref>].</p>
<p>For each of the two models, we simulated data sets consisting of 100, 1000, 10000, 100000, and 1000000 bi-allelic sites, with one haploid generated for every taxon. In the simulations, we set <italic>u</italic> = 1 and <italic>v</italic> = 1 as the mutation rates. Furthermore, similar to [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>], we used <italic>θ</italic> = 0.006 as the population mutation rate for the external branches and the branch above the root, and <italic>θ</italic> = 0.005 for the internal branches, both in the unit of population mutation rate per site. Under these settings, we observed that each of the 200 data sets contained between 19% and 21% polymorphic sites; the remaining sites were all monomorphic.</p>
<p>To test the ability of our algorithm to recover the topology of the true phylogenetic network, we ran the RJMCMC sampler on the simulated data sets. To test how robust the method is to the setting of the prior on the population mutation rate, we ran the sampler under both the “correct” (<italic>α</italic> = 2, <italic>β</italic> = 0.003) and “incorrect” (<italic>α</italic> = 2, <italic>β</italic> = 0.0003) prior settings as in the following commands:</p>
<list list-type="simple">
<list-item><p><monospace>MCMC_BiMarkers -cl 1500000 -bl 200000 -sf 500 -prebl 10000 -premc3 (2.0,4.0) -premr 1 -pi0 0.5 -varytheta -dd -pp 1.0 -ee 2.0 -mr 2 -pl 8 -ptheta 0.006 -thetawindow 0.006 -sd seed -taxa (A_0,C_0,L_0,R_0,Q_0) -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt;;</monospace></p></list-item>
<list-item><p><monospace>MCMC_BiMarkers -cl 1500000 -bl 200000 -sf 500 -prebl 10000 -premc3 (2.0,4.0) -premr 1 -pi0 0.5 -varytheta -dd -pp 1.0 -ee 2.0 -mr 2 -pl 8 -ptheta 0.0006 -thetawindow 0.006 -sd seed -taxa (A_0,C_0,L_0,R_0,Q_0) -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt;;</monospace></p></list-item>
</list>
<p specific-use="continuation">To speed up convergence, we used a pre-burn-in phase before we ran the actual sampling process. The pre-burn-in phase consisted of 3 chains with temperatures 1.0, 2.0, and 4.0, respectively, and each with 10,000 iterations. Following that, the actual sampling phase consisted of an MCMC chain for 1.5 × 10<sup>6</sup> iterations, with a burn-in period of 2 × 10<sup>5</sup> iterations, and one sample was collected from every 500 iterations. We used the network with the highest likelihood from the pre-burn-in phase as the starting network for the actual sampling phase. A maximum number of reticulations in this pre-burn-in phase was set at 1 and 2 for the data sets simulated on the networks in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A) and 3(B)</xref>, respectively. In the actual sampling phase, the maximum number of reticulations was set to 2 and 3, respectively.</p>
<p>We summarized the results based on 1,040,000 samples (20 replicates, 2 networks, 2 prior settings, 5 different numbers of sites, and 2600 samples per chain). <xref ref-type="fig" rid="pcbi.1005932.g004">Fig 4</xref> shows the method’s performance in terms of the number of reticulation it infers. In this figure, for each number of sites, each bar corresponds to the ratio of networks (out of 52,000) with the specified number of reticulations. As the results show, the method almost always infers a tree when the number of sites is 100, for both true networks and regardless of the prior setting on the population mutation rate. When 1000 sites are used, the method infers the correct number of reticulations in almost 75% of the samples in the case of the true 1-reticulation network, whereas the rest of the samples are almost all trees. However, when 10,000 sites or more are used, almost all samples have the correct number of reticulations, for both model networks and regardless of the prior setting on the population mutation rate. In the case of the true 2-reticulation network, when 1,000 sites are used, the method almost always infers a 1-reticulation network.</p>
<fig id="pcbi.1005932.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g004</object-id>
<label>Fig 4</label>
<caption>
<title>The ratio of trees (blue), 1-reticulation networks (green), 2-reticulation networks (black), and 3-reticulation networks (purple) sampled under different simulation settings.</title>
<p>Top row: The true network is the 1-reticulation network in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>. Bottom row: The true network is the 2-reticulation network in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(B)</xref>. Left column: The correct prior hyperparameters for the population mutation rate were used. Right column: The incorrect prior hyperparameters for the population mutation rate were used.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g004" xlink:type="simple"/>
</fig>
<p>While the method performs well in terms of estimating the number of reticulations, the next natural question is: Does the method infer the correct topology of the network? To answer this question, we assessed the topological differences between the sampled networks and the true ones in two different ways. When the method infers a network with at least one reticulation node, we compared the topology of the network to the true network topology using the topological distance measure of [<xref ref-type="bibr" rid="pcbi.1005932.ref035">35</xref>]. Furthermore, when the method infers a tree, we compared the tree to the “backbone tree” of the true network using the Robinson-Foulds metric [<xref ref-type="bibr" rid="pcbi.1005932.ref036">36</xref>]. Given a phylogenetic network with inheritance probabilities on its reticulation edges, removing for each reticulation node the incoming edge with the smaller inheritance probability results in a tree, which we call the backbone tree. For example, for the network in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(B)</xref>, the reticulation edges with inheritance probabilities 0.3 and 0.4 would be removed, resulting in the backbone tree (C,((L,(A,Q)),R)). It is important to note that in the presence of deep coalescence, it is extremely hard to capture the relationship between a phylogenetic network and its parental trees by a backbone tree [<xref ref-type="bibr" rid="pcbi.1005932.ref037">37</xref>]. The results for the simulated data sets are shown in <xref ref-type="fig" rid="pcbi.1005932.g005">Fig 5</xref>.</p>
<fig id="pcbi.1005932.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g005</object-id>
<label>Fig 5</label>
<caption>
<title>The topological distance (pink) between sampled networks and true network, and the Robinson-Foulds distance (orange) between sampled trees and true backbone tree, under different simulation settings.</title>
<p>Top row: The true network is the 1-reticulation network in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>. Bottom row: The true network is the 2-reticulation network in <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(B)</xref>. Left column: The correct prior hyperparameters for the population mutation rate were used. Right column: The incorrect prior hyperparameters for the population mutation rate were used. The samples underlying the orange points correspond to those
underlying the blue bars in <xref ref-type="fig" rid="pcbi.1005932.g004">Fig 4</xref>, whereas the samples underlying the pink points correspond to all other samples in <xref ref-type="fig" rid="pcbi.1005932.g004">Fig 4</xref>.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g005" xlink:type="simple"/>
</fig>
<p>Considering first the data sets simulated on the 1-reticulation network, the results indicate a very good performance. When a network is sampled, it is almost always the true network, as reflected by the topological distance close to 0. The only exception is the network inferred when using the incorrect prior hyperparameters on 100 sites. However, it is important to note that in most cases under this setting, a tree was sampled. Furthermore, when a tree was sampled by our method, its distance to the backbone tree is almost 0. In other words, when our methods failed to infer the true network, its because of lack of signal to infer the reticulation event, but it still inferred the underlying backbone tree.</p>
<p>In the case of the data sets simulated on the 2-reticulation network, the results differ. When the correct prior hyperparameters are used, 10,000 sites or more are needed to infer the true network. When the incorrect prior hyperparameters were used, the true network was sampled almost exclusively when 1,000,000 sites were used. When the method sampled a tree, that tree did not exactly match the backbone tree in this case, but was very close to it.</p>
<p>These results combined demonstrate a natural aspect of network inference: The more reticulate the evolutionary history, the more sites are needed for accurate inference of the network’s topology. In general, when the method makes a wrong inference, it is mostly in inferring the reticulation events themselves. However, in some cases, the tree inferred by the method does not match exactly the backbone tree, which is not unexpected given that the network in many cases is more than the sum of a backbone tree and a set of reticulation edges [<xref ref-type="bibr" rid="pcbi.1005932.ref037">37</xref>]. It is worth noting that while not many empirical AFLP- or SNP-based studies currently include as many as 10,000 loci, such large data sets may become commonplace as genomic technologies continue to advance.</p>
</sec>
<sec id="sec017">
<title>The method’s ability to estimate the continuous parameters</title>
<p>We used the following command in PhyloNet [<xref ref-type="bibr" rid="pcbi.1005932.ref030">30</xref>] to generate 80 data sets on the network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref> to test the ability of our algorithm to estimate the continuous parameters (branch lengths, inheritance probabilities, and population mutation rates):</p>
<list list-type="simple">
<list-item><p><monospace>SimBiMarkersinNetwork -diploid -dominant -op -pi0 0.5 -sd 12345678 -num numsites -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt; -truenet “[0.006](((((Q:0.004:0.006)I5 H1:0.002:0.005:0.7,A:0.006:0.006)I3:0.016:0.005,L:0.022:0.006)I2:0.02:0.005,(I5#H1:0.003:0.005:0.3,R:0.007:0.006)I4:0.035:0.005)I1:0.038:0.005,C:0.08:0.006);” -out “markers.txt”;</monospace></p></list-item></list>
<p specific-use="continuation">We used <italic>numsites</italic> ∈ {1000, 10000, 100000, 1000000} given that the method almost never inferred a network when using only 100 sites. As before, we varied the value of <italic>seed</italic> for each of the 20 replicates. Here, we assumed one diploid genome per taxon, with dominant markers.</p>
<p>For the analysis, we first used a pre-burn-in phase with the exact same setting as above, and then started an RJMCMC chain from the network with the highest likelihood, using the following command:</p>
<list list-type="simple">
<list-item><p><monospace>MCMC_BiMarkers -cl 1500000 -bl 200000 -sf 500 -prebl 10000 -premc3 (2.0,4.0) -premr 1 -pi0 0.5 -diploid -dominant 0 -op -varytheta -dd -pp 3.0 -ee 2.0 -mr 2 -pl 8 -ptheta 0.006 -thetawindow 0.006 -sd 12345678 -taxa (A_0,C_0,L_0,R_0,Q_0) -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt;;</monospace></p></list-item></list>
<p specific-use="continuation">We ran the chain for 1.5 × 10<sup>6</sup> iterations, with 2 × 10<sup>5</sup> burn-in iterations, and one sample was collected from every 500 iterations. We summarized the results based on the collected samples whose topologies were the true network topology (otherwise, there is no easy way to find correspondence between the parameters in the inferred networks and those in the true one) in the form of histograms.</p>
<p>Histograms of the sampled branch lengths are shown in <xref ref-type="fig" rid="pcbi.1005932.g006">Fig 6</xref>. The results indicate a very good performance of the method. The histograms peak around the true value for all branches, regardless of the number of sites used. However, as the number of sites increases, the variance around the true value shrinks.</p>
<fig id="pcbi.1005932.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Histograms of the branch lengths sampled by our method on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>.</title>
<p>Blue: 1,000 sites. Green: 10,000 sites. Black: 100,000 sites. Purple: 1,000,000 sites. The red dashed lines correspond to the true values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g006" xlink:type="simple"/>
</fig>
<p>Histograms of the sampled population mutation rates are shown in <xref ref-type="fig" rid="pcbi.1005932.g007">Fig 7</xref>. Unlike the case of branch lengths, we observe here that the population mutation rates of the external branches are well estimated, with the distribution tightening around the true values as the number of sites increases. However, the population mutation rates seem to be unidentifiable by the method for internal branches, especially those closer to the root. As we show below, increasing the number of individuals sampled per species help improve these estimates.</p>
<fig id="pcbi.1005932.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Histograms of the population mutation rates sampled by our method for each of the branches on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>.</title>
<p>Blue: 1,000 sites. Green: 10,000 sites. Black: 100,000 sites. Purple: 1,000,000 sites. The red dashed lines correspond to the true values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g007" xlink:type="simple"/>
</fig>
<p>Finally, a histogram of the sampled inheritance probabilities is shown in <xref ref-type="fig" rid="pcbi.1005932.g008">Fig 8</xref>. The method does a very good job at sampling the true value in this case. As the number of sites increases, the distribution of sampled value tightens around the true value and becomes almost all concentrated within 0.1 around it when 1,000,000 sites are used.</p>
<fig id="pcbi.1005932.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g008</object-id>
<label>Fig 8</label>
<caption>
<title>A histogram of the inheritance probabilities sampled by our method on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>.</title>
<p>Blue: 1,000 sites. Green: 10,000 sites. Black: 100,000 sites. Purple: 1,000,000 sites. The red dashed line corresponds to the true values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g008" xlink:type="simple"/>
</fig>
<p>To further assess the mixing of our sampler, we also performed five independent runs on an arbitrary data set with 10,000 sites, where each run consisting of an MCMC chain under the same settings as above. The results for the continuous parameters are shown in Figs <xref ref-type="fig" rid="pcbi.1005932.g009">9</xref>–<xref ref-type="fig" rid="pcbi.1005932.g011">11</xref>. Samples from the different runs are in very good agreement, further indicating good mixing.</p>
<fig id="pcbi.1005932.g009" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g009</object-id>
<label>Fig 9</label>
<caption>
<title>Histograms of the branch lengths sampled by our method on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>.</title>
<p>The five curves correspond to five independent runs. The red dashed lines correspond to the true values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g009" xlink:type="simple"/>
</fig>
<fig id="pcbi.1005932.g010" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g010</object-id>
<label>Fig 10</label>
<caption>
<title>Histograms of the population mutation rates sampled by our method for each of the branches on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>.</title>
<p>The five curves correspond to five independent runs. The red dashed lines correspond to the true values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g010" xlink:type="simple"/>
</fig>
<fig id="pcbi.1005932.g011" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g011</object-id>
<label>Fig 11</label>
<caption>
<title>A histogram of the inheritance probabilities sampled by our method on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref>.</title>
<p>The five curves correspond to five independent runs. The red dashed line corresponds to the true value.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g011" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec018">
<title>The effect of the number of sampled individuals on parameter estimates</title>
<p>Monomorphic sites help estimate parameter values, but sometimes they are removed because they are uninformative for estimating the topology and to reduce the computation time for the phylogenetic analyses. If there are only polymorphic sites in the data set, sampling multiple individuals could improve parameter estimation. To investigate this aspect, we set up a simulation with the phylogenetic network in <xref ref-type="fig" rid="pcbi.1005932.g012">Fig 12</xref> (we reduced the number of taxa to make the running time over many data sets manageable). In the simulation, we set <italic>u</italic> = 1 and <italic>v</italic> = 1 as the mutation rates. Furthermore, we used <italic>θ</italic> = 0.005. We sampled one diploid individual for each of the three species A, B, and D, and four diploid individuals for species C. We generated 10,000 polymorphic sites with dominant markers for each of those individuals, with 5 replicates.</p>
<fig id="pcbi.1005932.g012" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g012</object-id>
<label>Fig 12</label>
<caption>
<title>The phylogenetic network used to investigate effect of multiple individuals.</title>
<p>The branch lengths of the phylogenetic networks are measured in units of expected number of mutations per site. The inheritance probabilities are marked in blue.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g012" xlink:type="simple"/>
</fig>
<p>We used following command in PhyloNet to generate the data set:</p>
<list list-type="simple">
<list-item><p><monospace>SimBiMarkersinNetwork -diploid -dominant -op -pi0 0.5 -sd seed -num 10000 -tm &lt;A:A_0; B:B_0; C:C_0,C_1,C_2,C_3; D:D_0&gt; -truenet “[0.005]((((C:0.005:0.005)I1#H1:0.006:0.005:0.8,D:0.011:0.005):0.009:0.005,(B:0.014:0.005,I1#H1:0.009:0.005:0.2):0.006:0.005):0.005:0.005,A:0.025:0.005);” -out “markers.txt”;</monospace></p></list-item></list>
<p>We ran the method on the entire data set (7 diploid individuals, amounting to 14 haploid individuals), and on a subset that consists of a single diploid individual from each of the four species (8 haploids in total).</p>
<p>We ran each MCMC chain for 5 × 10<sup>5</sup> iterations, with 5 × 10<sup>4</sup> burn-in iterations, and one sample was collected from every 500 iterations. We used the collected samples whose topologies were the true network topology to summarize the results in the form of histograms of the parameter estimates.</p>
<p>Histograms of the sampled branch lengths are shown in <xref ref-type="fig" rid="pcbi.1005932.g013">Fig 13</xref>. As the results show, the inclusion of multiple individuals from the hybrid species (C) helps most in estimating the lengths of the three branches surrounding the reticulation event (the three edges incident with node I1).</p>
<fig id="pcbi.1005932.g013" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g013</object-id>
<label>Fig 13</label>
<caption>
<title>Histograms of the branch lengths sampled by our method on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g012">Fig 12</xref>.</title>
<p>In all cases, a single diploid individual was sampled from A, B, and D. Blue: A single diploid individual is sampled from C. Green: Four diploid individuals are sampled from C. The red dashed lines correspond to the true values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g013" xlink:type="simple"/>
</fig>
<p>Histograms of the sampled population mutation rates are shown in <xref ref-type="fig" rid="pcbi.1005932.g014">Fig 14</xref>. In this case, the most improvement gained from the inclusion of multiple individuals pertains to the external branch to taxon C.</p>
<fig id="pcbi.1005932.g014" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g014</object-id>
<label>Fig 14</label>
<caption>
<title>Histograms of the population mutation rates sampled by our method for each of the branches on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g012">Fig 12</xref>.</title>
<p>In all cases, a single diploid individual was sampled from A, B, and D. Blue: A single diploid individual is sampled from C. Green: Four diploid individuals are sampled from C. The red dashed lines correspond to the true values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g014" xlink:type="simple"/>
</fig>
<p>A histogram of the sampled inheritance probabilities is shown in <xref ref-type="fig" rid="pcbi.1005932.g015">Fig 15</xref>. The inheritance probability estimates improve when four individuals are sampled, as the distribution of the sampled values become more concentrated and peak much closer to the true value.</p>
<fig id="pcbi.1005932.g015" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g015</object-id>
<label>Fig 15</label>
<caption>
<title>A histogram of the inheritance probabilities sampled by our method on the simulated data set corresponding to the phylogenetic network of <xref ref-type="fig" rid="pcbi.1005932.g012">Fig 12</xref>.</title>
<p>In all cases, a single diploid individual was sampled from A, B, and D. Blue: A single diploid individual is sampled from C. Green: Four diploid individuals are sampled from C. The red dashed lines correspond to the true value.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g015" xlink:type="simple"/>
</fig>
<p>This simulation was performed on <ext-link ext-link-type="uri" xlink:href="https://docs.rice.edu/confluence/display/CD/DAVinCI+Overview" xlink:type="simple">DAVinCI</ext-link>, which is a batch scheduled High-Throughput Computing (HTC) cluster. We used 6 cores, with one thread per core running at 2.83GHz, and 4G RAM per thread. The average runtime for analyzing the full data set with four individuals sampled from C is 47.5 hours for each replicate. The average runtime for analyzing the subset with a single individual sampled from C is 0.3 hour for each replicate. This shows the drastic effect of the number of individuals sampled on the running time of the method.</p>
</sec>
<sec id="sec019">
<title>The method’s robustness to violations in the assumptions</title>
<p>To study the robustness of our method to violations in the underlying assumptions of the model, we simulated data sets on the network of <xref ref-type="fig" rid="pcbi.1005932.g003">Fig 3(A)</xref> with 100, 200, 300, 400, and 500 sites under different conditions.</p>
<p>Our model assumes the markers are unlinked. To simulate data with linked markers, we used the following command to produce multiple markers coming from the same gene tree:</p>
<list list-type="simple">
<list-item><p><monospace>SimBiMarkersinNetwork -diploid -dominant -op -pi0 0.5 -sd seed -num numstes -sitespergt numsites_per_genetree -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt; -truenet “[0.006](((((Q:0.004:0.006)I5#H1:0.002:0.005:0.7,A:0.006:0.006)I3:0.016:0.005,L:0.022:0.006)I2:0.02:0.005,(I5#H1:0.003:0.005:0.3,R:0.007:0.006)I4:0.035:0.005)I1:0.038:0.005,C:0.08:0.006);” -out “markers.txt”;</monospace></p></list-item></list>
<p specific-use="continuation">Here, <italic>numsites</italic>_<italic>per</italic>_<italic>genetree</italic> was once set to 10 to generate 10 markers per gene tree, and then set to 100 to generate 100 markers per gene tree. Naturally, the number of gene trees generated was divided by either 10 or 100, respectively. Each setting was used to generate 100, 200, 300, 400, 500 sites in total, and with 5 replicates using different integers as the random seeds.</p>
<p>Our model assumes a constant rate of mutation across all lineages and all markers. We simulated data sets with rate variation across markers and lineages. In the second step of our simulator, we adopted a rate variation which mimics the <italic>GTR</italic> + <italic>I</italic> + Γ setting in [<xref ref-type="bibr" rid="pcbi.1005932.ref038">38</xref>]. The following is one of the commands we used to simulate rate variation:</p>
<list list-type="simple">
<list-item><p><monospace>SimBiMarkersinNetwork -diploid -dominant -op -pi0 0.5 -sd seed -num numsites -rvl -i 0.1 -a 3.0 -g 3 -tm &lt;A:A_0; C:C_0;L:L_0;Q:Q_0;R:R_0&gt; -truenet “[0.006](((((Q:0.004:0.006)I5#H1:0.002:0.005:0.7,A:0.006:0.006)I3:0.016:0.005,L:0.022:0.006)I2:0.02:0.005,(I5#H1:0.003:0.005:0.3,R:0.007:0.006)I4:0.035:0.005)I1:0.038:0.005,C:0.08:0.006);” -out “markers.txt”;</monospace></p></list-item></list>
<p specific-use="continuation">The command was repeated with “-rvl -i 0.1 -a 3.0 -g 3”, “-rvl -i 0.2 -a 5.0 -g 3”, “-rvm -i 0.1 -a 3.0 -g 3”, “-rvm -i 0.2 -a 5.0 -g 3”. Here, “-rvl” means rate variation across lineages, “-rvm” means rate variation across markers, “-i” indicates the proportion of invariable sites, “-a” indicates the shape for the gamma rate heterogeneity, and “-g” indicates the number of categories for the discrete gamma rate heterogeneity model. Five replicates were generated for each setting, using different integers as the random seeds.</p>
<p>Furthermore, in our Bayesian formulation given by <xref ref-type="disp-formula" rid="pcbi.1005932.e100">Eq (16)</xref>, the prior <italic>p</italic>(Ψ) includes a Poisson distribution on the number of reticulation nodes in the network. In our experiments here, we varied the mean of the Poisson distribution in {1, 3}.</p>
<p>In total, there are 8 settings. For each setting, we generated five replicate 100-, 200-, 300-, 400-, 500-site data sets.</p>
<p>As above, we employed a pre-burn-in phase to obtain a good starting point, from which we then started an MCMC chain for each data set with 1.5 × 10<sup>6</sup> iterations, 2 × 10<sup>5</sup> burn-in iterations, and one sample collected from every 500 iterations. In total, there were 13,000 samples collected for each data set with different number of sites and different settings.</p>
<p>To avoid reporting results for all branch lengths in the sampled networks, <xref ref-type="fig" rid="pcbi.1005932.g016">Fig 16</xref> shows the estimation of the height of trees and networks sampled in each setting. The five bars from bottom to top correspond to the minimum, first-, second-, third-quantile, and the maximum. The most important striking pattern in the figure is that as the number of sites increases, the estimate of the height converges to the true value and the variance in the estimated value becomes smaller. In all cases of assumption violations, 500 sites are sufficient to obtain a very accurate estimate of the height.</p>
<fig id="pcbi.1005932.g016" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g016</object-id>
<label>Fig 16</label>
<caption>
<title>The height of trees and networks sampled under different simulation settings and violations in the different assumptions.</title>
<p>The red dashed lines correspond to the true values. In each panel at most one condition is violated. (a) Mean of 1.0 is used for the Poisson prior on the number of reticulations. (b) Mean of 3.0 is used for the Poisson prior on the number of reticulations. (c) Linked loci: 10 sites are generated per gene tree. (d) Linked loci: 100 sites are generated per gene tree. (e) Rate variation across lineages with 0.1 of invariable sites and 3.0 as shape of gamma rate heterogeneity. (f) Rate variation across lineages with 0.2 of invariable sites and 5.0 as shape of gamma rate heterogeneity. (g) Rate variation across markers with 0.1 of invariable sites and 3.0 as shape of gamma rate heterogeneity. (h) Rate variation across markers with 0.2 of invariable sites and 5.0 as shape of gamma rate heterogeneity.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g016" xlink:type="simple"/>
</fig>
<p>
<xref ref-type="fig" rid="pcbi.1005932.g017">Fig 17</xref> shows the estimates of the number of reticulations under the different settings and violations. In all cases, 500 sites were sufficient to recover the true number of reticulations, regardless of the violation in assumptions. Interestingly, the set mean of the Poisson distribution on the number of reticulations has an almost identical effect regardless of whether it is set to 1.0 or to 3.0. The inclusion of linked loci has much more of an effect on the number of reticulations inferred. As can be seen in the figure, even with 400 sites, the method still infers trees in many of the samples. Rate variation across lineages and sites has a similar effect, which is overcome by the method when 400 sites or more are used.</p>
<fig id="pcbi.1005932.g017" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g017</object-id>
<label>Fig 17</label>
<caption>
<title>The ratio of trees (blue) and 1-reticulation networks (green) sampled under different simulation settings and violation in the different assumptions.</title>
<p>The true number of reticulations is 1. In each panel at most one condition is violated. (a) Mean of 1.0 is used for the Poisson prior on the number of reticulations. (b) Mean of 3.0 is used for the Poisson prior on the number of reticulations. (c) Linked loci: 10 sites are generated per gene tree. (d) Linked loci: 100 sites are generated per gene tree. (e) Rate variation across lineages with 0.1 of invariable sites and 3.0 as shape of gamma rate heterogeneity. (f) Rate variation across lineages with 0.2 of invariable sites and 5.0 as shape of gamma rate heterogeneity. (g) Rate variation across markers with 0.1 of invariable sites and 3.0 as shape of gamma rate heterogeneity. (h) Rate variation across markers with 0.2 of invariable sites and 5.0 as shape of gamma rate heterogeneity.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g017" xlink:type="simple"/>
</fig>
<p>The topological differences between the inferred networks and true one and between the inferred trees and the true backbone tree are shown in <xref ref-type="fig" rid="pcbi.1005932.g018">Fig 18</xref>. With the exception of the 100-site data sets, the method is very robust in terms of the topology of the inferred network. When it infers a network, it almost always obtains the true one. When it infers a tree, it almost always obtains the backbone tree.</p>
<fig id="pcbi.1005932.g018" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g018</object-id>
<label>Fig 18</label>
<caption>
<title>The topological distance (pink) between sampled networks and true network, and the Robinson-Foulds distance (orange) between sampled trees and true backbone tree, under different simulation settings and violation in the different assumptions.</title>
<p>In each panel at most one condition is violated. (a) Mean of 1.0 is used for the Poisson prior on the number of reticulations. (b) Mean of 3.0 is used for the Poisson prior on the number of reticulations. (c) Linked loci: 10 sites are generated per gene tree. (d) Linked loci: 100 sites are generated per gene tree. (e) Rate variation across lineages with 0.1 of invariable sites and 3.0 as shape of gamma rate heterogeneity. (f) Rate variation across lineages with 0.2 of invariable sites and 5.0 as shape of gamma rate heterogeneity. (g) Rate variation across markers with 0.1 of invariable sites and 3.0 as shape of gamma rate heterogeneity. (h) Rate variation across markers with 0.2 of invariable sites and 5.0 as shape of gamma rate heterogeneity.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g018" xlink:type="simple"/>
</fig>
<p>Put together, these results point to a very robust method. In particular, when at least 500 sites are used, the method is almost completely robust to any of the violations we studied here.</p>
</sec>
</sec>
<sec id="sec020">
<title>Analysis of an empirical data set</title>
<p>Two small subsets of a larger AFLP data set of multiple New Zealand species of the plant genus <italic>Ourisia</italic> (Plantaginaceae) [<xref ref-type="bibr" rid="pcbi.1005932.ref039">39</xref>] were analyzed, including previously unpublished AFLP profiles from two different hybrid individuals <italic>O. × cockayneana</italic> and <italic>O. × prorepens</italic> (herbarium codes follow [<xref ref-type="bibr" rid="pcbi.1005932.ref040">40</xref>] [continuously updated]). There are both morphological [<xref ref-type="bibr" rid="pcbi.1005932.ref041">41</xref>] and molecular (Meudt unpubl.) data supporting the hybrid nature of these two individuals. Although other <italic>Ourisia</italic> hybrid combinations have been reported in New Zealand [<xref ref-type="bibr" rid="pcbi.1005932.ref041">41</xref>], <italic>O. × cockayneana</italic> and <italic>O. × prorepens</italic> are perhaps the most common, both involve <italic>O. caespitosa</italic> as a putative parent, and both have been formally named. Each data subset comprised five diploid individuals in total, which means ten haploid individuals were effectively analyzed due to the correction for dominant markers. A Poisson distribution with λ = 1.5 as the prior on the number of reticulations, an exponential prior with λ = 2.0 as the prior on the species divergence times, and a Gamma distribution with <italic>α</italic> = 2.0 and <italic>β</italic> = 0.05 as the prior on the population mutation rates were adopted. An MCMC chain was run on each data subset for 1.5 × 10<sup>6</sup> iterations with 2 × 10<sup>5</sup> burn-in iterations, and a sample was collected every 500 iterations. We used following commands:</p>
<list list-type="simple">
<list-item><p><monospace>MCMC_BiMarkers -cl 1500000 -bl 200000 -sf 500 -prebl 5000 -premc3 (2.0, 4.0) -premr 1 -diploid -dominant 1 -op -varytheta -pp 1.5 -ee 2.0 -mr 2 -pl 4 -ptheta 0.1 -sd 12345678 -taxa (HYB_175a_Otir, cae_174a_Otir, mcccal_176a_Otir, mccmcc_133a_Burn, mcplac_13392_Sylv) -tm &lt;HYB:HYB_175a_Otir; cae:cae_174a_Otir; mcccal:mcccal_176a_Otir; mccmcc:mccmcc_133a_Burn; mcplac:mcplac_13392_Sylv&gt;</monospace></p></list-item>
<list-item><p><monospace>MCMC_BiMarkers -cl 1500000 -bl 200000 -sf 500 -prebl 5000 -premc3 (2.0, 4.0) -premr 1 -diploid -dominant 1 -op -varytheta -pp 1.5 -ee 2.0 -mr 2 -pl 4 -ptheta 0.1 -sd 12345678 -taxa (HYB_203a_Shri, cae_196a_Shri, sesses_199a_Shri, mccmcc_133a_Burn, sesspl_PH_SealA) -tm &lt;HYB:HYB_203a_Shri; cae:cae_196a_Shri; sesses:sesses_199a_Shri; mccmcc:mccmcc_133a_Burn; sesspl:sesspl_PH_SealA&gt;</monospace></p></list-item></list>
<sec id="sec021">
<title>Data subset with hybrid <italic>O. × cockayneana</italic></title>
<p>The first data subset comprises the following five individuals: <italic>O. macrocarpa</italic> (voucher: <italic>Meudt 133a</italic>, MPN 29546; herbarium codes follow [<xref ref-type="bibr" rid="pcbi.1005932.ref040">40</xref>] [continuously updated]), <italic>O. macrophylla</italic> subsp. <italic>lactea</italic> (<italic>Cameron 13392</italic>, AK 294893), hybrid <italic>O.</italic> × <italic>cockayneana</italic> (<italic>Meudt 175a</italic>, MPN 29710), <italic>O. caespitosa</italic> (<italic>Meudt 174a</italic>, MPN 29705), and <italic>O. calycina</italic> (<italic>Meudt 176a</italic>, MPN 29713). The number of loci in this data set is 802.</p>
<p>The maximum a posteriori (MAP) phylogenetic network is shown in <xref ref-type="fig" rid="pcbi.1005932.g019">Fig 19</xref>. The effective sample size was larger than 2,000. All topologies sampled successfully detected the hybrid and its putative parents. If the hybrid is removed, the topology in <xref ref-type="fig" rid="pcbi.1005932.g019">Fig 19</xref> also agrees with that of Fig. 3 in [<xref ref-type="bibr" rid="pcbi.1005932.ref039">39</xref>].</p>
<fig id="pcbi.1005932.g019" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g019</object-id>
<label>Fig 19</label>
<caption>
<title>The MAP phylogenetic network for the subset with the hybrid <italic>O.</italic> × <italic>cockayneana</italic> (<italic>Meudt 175a</italic>, MPN 29710) and putative parents.</title>
<p>The width of each tube is proportional to the population mutation rate of each branch, which is printed on each tube. The length of each tube is proportional to the length of the corresponding branch in units of expected number of mutations per site (scale shown). Blue arrows indicate the reticulation edges and their inheritance probabilities are printed in blue.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g019" xlink:type="simple"/>
</fig>
<p>It should be noted that the posterior standard deviations reported in <xref ref-type="fig" rid="pcbi.1005932.g019">Fig 19</xref> are much larger than those in [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>]. This is perhaps not unexpected because we only used one individual per species in our analysis. Our simulation study shows that increased sampling of individuals helps the estimation of parameters, whereas when only one individual per species is sampled, the posterior distribution is much wider.</p>
</sec>
<sec id="sec022">
<title>Data subset with hybrid <italic>O. × prorepens</italic></title>
<p>The second data subset comprises <italic>O. sessilifolia</italic> subsp. <italic>splendida</italic> (<italic>Heenan s.n.</italic>, MPN 32149), <italic>O. macrocarpa</italic> (<italic>Meudt 133a</italic>, MPN 29713), hybrid <italic>O.</italic> × <italic>prorepens</italic> (<italic>Meudt 203<sup><underline>a</underline></sup></italic>, MPN 29774), <italic>O. sessilifolia</italic> subsp. sessilifolia (<italic>Meudt 199a</italic>, MPN 29771), and <italic>O. caespitosa</italic> (<italic>Meudt 196a</italic>, MPN 297695). The number of loci in this data set is 820.</p>
<p>The MAP phylogenetic network is shown in <xref ref-type="fig" rid="pcbi.1005932.g020">Fig 20</xref>. The effective sample size was also larger than 2,000 in this case. The result shows our method successfully detected the hybrid and its putative parents. If the hybrid is removed, the topology in <xref ref-type="fig" rid="pcbi.1005932.g020">Fig 20</xref> also agrees with that of Fig. 3 in [<xref ref-type="bibr" rid="pcbi.1005932.ref039">39</xref>]. As with the first data subset, the posterior standard deviations reported in <xref ref-type="fig" rid="pcbi.1005932.g020">Fig 20</xref> are large.</p>
<fig id="pcbi.1005932.g020" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005932.g020</object-id>
<label>Fig 20</label>
<caption>
<title>The MAP phylogenetic network for the subset with the hybrid <italic>O.</italic> × <italic>prorepens</italic> (<italic>Meudt 203<sup><underline>a</underline></sup></italic>, MPN 29774) and putative parents.</title>
<p>The width of each tube is proportional to the population mutation rate of each branch, which is printed on each tube. The length of each tube is proportional to the length of the corresponding branch in units of expected number of mutations per site (scale shown). Blue arrows indicate the reticulation edges and their inheritance probabilities are printed in blue.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005932.g020" xlink:type="simple"/>
</fig>
<p>Nevertheless, the mean values of inferred parameters are very similar for the two species that were common to the two data subsets, <italic>O. caespitosa</italic> and <italic>O. macrocarpa</italic>. The mean value of inferred population mutation rate of their corresponding leaves are similar. This shows that the method is both robust and consistent.</p>
<p>In summary, our method was able to extract the signal of the hybrid and successfully recover its putative parents, as well as reconstruct network topologies which were consistent with a previous study of a larger dataset [<xref ref-type="bibr" rid="pcbi.1005932.ref039">39</xref>].</p>
</sec>
</sec>
</sec>
<sec id="sec023" sec-type="conclusions">
<title>Discussion</title>
<p>Phylogenetic networks allow for representing evolutionary relationships that involve both vertical and horizontal transmission of genetic material. Extensions of the multispecies coalescent process to include hybridization events have facilitated the development of statistical methods for inferring and analyzing phylogenetic networks from gene tree estimates and sequence data. A major challenge with using gene tree estimates as the input to species phylogeny inference methods is the error in these estimates. While using the sequence data directly overcomes this issue, the problem of recombinations within loci can confound inferences. Using bi-allelic markers from individual, independent loci could provide a way to avoid both the gene tree uncertainty and recombination problems (the two are not necessarily independent). Furthermore, it is important to note that many biological studies use data sets that consists of bi-allelic markers and no available sequence alignment data for individual loci.</p>
<p>Bryant <italic>et al.</italic> recently devised an algorithm for inferring species trees from bi-allelic genetic markers while analytically integrating out the gene trees for the individual loci [<xref ref-type="bibr" rid="pcbi.1005932.ref007">7</xref>]. In this paper, we extended their algorithm significantly so as the likelihood of a phylogenetic network given bi-allelic markers could be computed while integrating out the gene trees. This method complements existing ones that use gene tree estimates or sequence alignments as input for statistical inference of phylogenetic networks.</p>
<p>We implemented a Bayesian method for sampling the posterior of phylogenetic networks and their associated parameters from bi-allelic data, and studied its performance on both simulated and empirical data. The results indicate a very good performance of the method. This work adds a powerful method to the biologist’s toolbox that allows for estimating reticulate evolutionary histories.</p>
<p>A major bottleneck of the method is its computational requirements. While the SNAPP method is very time consuming on species trees, our method is much more time consuming given that reticulations in the phylogenetic network give rise to an explosion of the number of partial likelihoods that need to be computed and stored. More generally, the number of taxa in a data set has more of an effect on the running time of the method than the number of loci does. In particular, two aspects of the phylogenetic network under consideration affect the computational requirements of the method: The number of leaves under the reticulation nodes and the diameter of each of the reticulation nodes. As discussed above, the set of lineages entering a reticulation node must be bipartitioned in every possible way. This number of lineages is dependent on the number of leaves under that reticulation node. For example, if a single individual is sampled from a single species that exist under the reticulation node, then the number of bipartitions is very small (only two bipartitions exist). However, if <italic>n</italic> individuals are sampled from a single species that exist under the reticulation node or one individual is sampled per <italic>n</italic> species that exist under the reticulation node, then a number of bipartitions on the order of 2<sup><italic>n</italic></sup> arises. This computation becomes much more demanding if there are more reticulation nodes on the path to a lowest articulation node. As for the diameter—which is the number of branches on the paths between the two parents of the reticulation node and a lowest articulation node above them, the larger its value, the more demanding the computation becomes. An important direction for future research is improving the computational requirements of the method to scale up to data sets with many taxa.</p>
</sec>
</body>
<back>
<ref-list>
<title>References</title>
<ref id="pcbi.1005932.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Felsenstein</surname> <given-names>J</given-names></name>. <article-title>Evolutionary trees from DNA sequences: a maximum likelihood approach</article-title>. <source>Journal of Molecular Evolution</source>. <year>1981</year>;<volume>17</volume>(<issue>6</issue>):<fpage>368</fpage>–<lpage>376</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/BF01734359" xlink:type="simple">10.1007/BF01734359</ext-link></comment> <object-id pub-id-type="pmid">7288891</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rannala</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Yang</surname> <given-names>Z</given-names></name>. <article-title>Bayes estimation of species divergence times and ancestral population sizes using DNA sequences from multiple loci</article-title>. <source>Genetics</source>. <year>2003</year>;<volume>164</volume>(<issue>4</issue>):<fpage>1645</fpage>–<lpage>1656</lpage>. <object-id pub-id-type="pmid">12930768</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref003">
<label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Liu</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Pearl</surname> <given-names>DK</given-names></name>. <article-title>Species trees from gene trees: reconstructing Bayesian posterior distributions of a species phylogeny using estimated gene tree distributions</article-title>. <source>Systematic Biology</source>. <year>2007</year>;<volume>56</volume>(<issue>3</issue>):<fpage>504</fpage>–<lpage>514</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1080/10635150701429982" xlink:type="simple">10.1080/10635150701429982</ext-link></comment> <object-id pub-id-type="pmid">17562474</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref004">
<label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Heled</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Drummond</surname> <given-names>AJ</given-names></name>. <article-title>Bayesian inference of species trees from multilocus data</article-title>. <source>Molecular Biology and Evolution</source>. <year>2010</year>;<volume>27</volume>(<issue>3</issue>):<fpage>570</fpage>–<lpage>580</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/molbev/msp274" xlink:type="simple">10.1093/molbev/msp274</ext-link></comment> <object-id pub-id-type="pmid">19906793</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref005">
<label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Edwards</surname> <given-names>SV</given-names></name>, <name name-style="western"><surname>Xi</surname> <given-names>Z</given-names></name>, <name name-style="western"><surname>Janke</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Faircloth</surname> <given-names>BC</given-names></name>, <name name-style="western"><surname>McCormack</surname> <given-names>JE</given-names></name>, <name name-style="western"><surname>Glenn</surname> <given-names>TC</given-names></name>, <etal>et al</etal>. <article-title>Implementing and testing the multispecies coalescent model: A valuable paradigm for phylogenomics</article-title>. <source>Molecular Phylogenetics and Evolution</source>. <year>2016</year>;<volume>94</volume>:<fpage>447</fpage>–<lpage>462</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.ympev.2015.10.027" xlink:type="simple">10.1016/j.ympev.2015.10.027</ext-link></comment> <object-id pub-id-type="pmid">26518740</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Springer</surname> <given-names>MS</given-names></name>, <name name-style="western"><surname>Gatesy</surname> <given-names>J</given-names></name>. <article-title>The gene tree delusion</article-title>. <source>Molecular Phylogenetics and Evolution</source>. <year>2016</year>;<volume>94</volume>:<fpage>1</fpage>–<lpage>33</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.ympev.2015.07.018" xlink:type="simple">10.1016/j.ympev.2015.07.018</ext-link></comment> <object-id pub-id-type="pmid">26238460</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Bryant</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Bouckaert</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Felsenstein</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Rosenberg</surname> <given-names>NA</given-names></name>, <name name-style="western"><surname>RoyChoudhury</surname> <given-names>A</given-names></name>. <article-title>Inferring species trees directly from biallelic genetic markers: bypassing gene trees in a full coalescent analysis</article-title>. <source>Molecular Biology and Evolution</source>. <year>2012</year>;<volume>29</volume>(<issue>8</issue>):<fpage>1917</fpage>–<lpage>1932</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/molbev/mss086" xlink:type="simple">10.1093/molbev/mss086</ext-link></comment> <object-id pub-id-type="pmid">22422763</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Mallet</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Besansky</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Hahn</surname> <given-names>MW</given-names></name>. <article-title>How reticulated are species?</article-title> <source>BioEssays</source>. <year>2016</year>;<volume>38</volume>(<issue>2</issue>):<fpage>140</fpage>–<lpage>149</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/bies.201500149" xlink:type="simple">10.1002/bies.201500149</ext-link></comment> <object-id pub-id-type="pmid">26709836</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref009">
<label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Gogarten</surname> <given-names>JP</given-names></name>, <name name-style="western"><surname>Doolittle</surname> <given-names>WF</given-names></name>, <name name-style="western"><surname>Lawrence</surname> <given-names>JG</given-names></name>. <article-title>Prokaryotic evolution in light of gene transfer</article-title>. <source>Molecular Biology and Evolution</source>. <year>2002</year>;<volume>19</volume>(<issue>12</issue>):<fpage>2226</fpage>–<lpage>2238</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/oxfordjournals.molbev.a004046" xlink:type="simple">10.1093/oxfordjournals.molbev.a004046</ext-link></comment> <object-id pub-id-type="pmid">12446813</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Koonin</surname> <given-names>EV</given-names></name>, <name name-style="western"><surname>Makarova</surname> <given-names>KS</given-names></name>, <name name-style="western"><surname>Aravind</surname> <given-names>L</given-names></name>. <article-title>Horizontal gene transfer in prokaryotes: quantification and classification 1</article-title>. <source>Annual Reviews in Microbiology</source>. <year>2001</year>;<volume>55</volume>(<issue>1</issue>):<fpage>709</fpage>–<lpage>742</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1146/annurev.micro.55.1.709" xlink:type="simple">10.1146/annurev.micro.55.1.709</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref011">
<label>11</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Arnold</surname> <given-names>ML</given-names></name>. <source>Natural hybridization and evolution</source>. <publisher-loc>Oxford</publisher-loc>: <publisher-name>Oxford University Press</publisher-name>; <year>1997</year>.</mixed-citation>
</ref>
<ref id="pcbi.1005932.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Barton</surname> <given-names>NH</given-names></name>. <article-title>The role of hybridization in evolution</article-title>. <source>Molecular Ecology</source>. <year>2001</year>;<volume>10</volume>(<issue>3</issue>):<fpage>551</fpage>–<lpage>568</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1046/j.1365-294x.2001.01216.x" xlink:type="simple">10.1046/j.1365-294x.2001.01216.x</ext-link></comment> <object-id pub-id-type="pmid">11298968</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Mallet</surname> <given-names>J</given-names></name>. <article-title>Hybridization as an invasion of the genome</article-title>. <source>Trends in Ecology &amp; Evolution</source>. <year>2005</year>;<volume>20</volume>(<issue>5</issue>):<fpage>229</fpage>–<lpage>237</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.tree.2005.02.010" xlink:type="simple">10.1016/j.tree.2005.02.010</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref014">
<label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Mallet</surname> <given-names>J</given-names></name>. <article-title>Hybrid speciation</article-title>. <source>Nature</source>. <year>2007</year>;<volume>446</volume>:<fpage>279</fpage>–<lpage>283</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nature05706" xlink:type="simple">10.1038/nature05706</ext-link></comment> <object-id pub-id-type="pmid">17361174</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref015">
<label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rieseberg</surname> <given-names>LH</given-names></name>. <article-title>Hybrid origins of plant species</article-title>. <source>Annual Reviews of Ecology, Evolution and Systematics</source>. <year>1997</year>;<volume>28</volume>:<fpage>359</fpage>–<lpage>389</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1146/annurev.ecolsys.28.1.359" xlink:type="simple">10.1146/annurev.ecolsys.28.1.359</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref016">
<label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rieseberg</surname> <given-names>LH</given-names></name>, <name name-style="western"><surname>Raymond</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>Rosenthal</surname> <given-names>DM</given-names></name>, <name name-style="western"><surname>Lai</surname> <given-names>Z</given-names></name>, <name name-style="western"><surname>Livingstone</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Nakazato</surname> <given-names>T</given-names></name>, <etal>et al</etal>. <article-title>Major ecological transitions in wild sunflowers facilitated by hybridization</article-title>. <source>Science</source>. <year>2003</year>;<volume>301</volume>(<issue>5637</issue>):<fpage>1211</fpage>–<lpage>1216</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1126/science.1086949" xlink:type="simple">10.1126/science.1086949</ext-link></comment> <object-id pub-id-type="pmid">12907807</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref017">
<label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Racimo</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Sankararaman</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Nielsen</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Huerta-Sánchez</surname> <given-names>E</given-names></name>. <article-title>Evidence for archaic adaptive introgression in humans</article-title>. <source>Nature Reviews Genetics</source>. <year>2015</year>;<volume>16</volume>(<issue>6</issue>):<fpage>359</fpage>–<lpage>371</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nrg3936" xlink:type="simple">10.1038/nrg3936</ext-link></comment> <object-id pub-id-type="pmid">25963373</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref018">
<label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Stevison</surname> <given-names>LS</given-names></name>, <name name-style="western"><surname>Kohn</surname> <given-names>MH</given-names></name>. <article-title>Divergence population genetic analysis of hybridization between rhesus and cynomolgus macaques</article-title>. <source>Molecular Ecology</source>. <year>2009</year>;<volume>18</volume>(<issue>11</issue>):<fpage>2457</fpage>–<lpage>2475</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/j.1365-294X.2009.04212.x" xlink:type="simple">10.1111/j.1365-294X.2009.04212.x</ext-link></comment> <object-id pub-id-type="pmid">19457196</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref019">
<label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Liu</surname> <given-names>KJ</given-names></name>, <name name-style="western"><surname>Steinberg</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Yozzo</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Song</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Kohn</surname> <given-names>MH</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>Interspecific introgressive origin of genomic diversity in the house mouse</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2015</year>;<volume>112</volume>(<issue>1</issue>):<fpage>196</fpage>–<lpage>201</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.1406298111" xlink:type="simple">10.1073/pnas.1406298111</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Zhang</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Dasmahapatra</surname> <given-names>KK</given-names></name>, <name name-style="western"><surname>Mallet</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Moreira</surname> <given-names>GR</given-names></name>, <name name-style="western"><surname>Kronforst</surname> <given-names>MR</given-names></name>. <article-title>Genome-wide introgression among distantly related Heliconius butterfly species</article-title>. <source>Genome Biology</source>. <year>2016</year>;<volume>17</volume>:<fpage>25</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/s13059-016-0889-0" xlink:type="simple">10.1186/s13059-016-0889-0</ext-link></comment> <object-id pub-id-type="pmid">26921238</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Fontaine</surname> <given-names>MC</given-names></name>, <name name-style="western"><surname>Pease</surname> <given-names>JB</given-names></name>, <name name-style="western"><surname>Steele</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Waterhouse</surname> <given-names>RM</given-names></name>, <name name-style="western"><surname>Neafsey</surname> <given-names>DE</given-names></name>, <name name-style="western"><surname>Sharakhov</surname> <given-names>IV</given-names></name>, <etal>et al</etal>. <article-title>Extensive introgression in a malaria vector species complex revealed by phylogenomics</article-title>. <source>Science</source>. <year>2015</year>;<volume>347</volume>(<issue>6217</issue>):<fpage>1258524</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1126/science.1258524" xlink:type="simple">10.1126/science.1258524</ext-link></comment> <object-id pub-id-type="pmid">25431491</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref022">
<label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wen</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Yu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Hahn</surname> <given-names>MW</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>Reticulate evolutionary history and extensive introgression in mosquito species revealed by phylogenetic network analysis</article-title>. <source>Molecular Ecology</source>. <year>2016</year>;<volume>25</volume>(<issue>11</issue>):<fpage>2361</fpage>–<lpage>2372</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/mec.13544" xlink:type="simple">10.1111/mec.13544</ext-link></comment> <object-id pub-id-type="pmid">26808290</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wen</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>Co-estimating Reticulate Phylogenies and Gene Trees from Multi-locus Sequence Data</article-title>. <source>Systematic Biology</source>. <year>2017</year>;. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/sysbio/syx085" xlink:type="simple">10.1093/sysbio/syx085</ext-link></comment> <object-id pub-id-type="pmid">29088409</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref024">
<label>24</label>
<mixed-citation publication-type="other" xlink:type="simple">Zhang C, Ogilvie HA, Drummond AJ, Stadler T. Bayesian Inference Of Species Networks From Multilocus Sequence Data. bioRxiv. 2017; p. 124982.</mixed-citation>
</ref>
<ref id="pcbi.1005932.ref025">
<label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Degnan</surname> <given-names>JH</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>The probability of a gene tree topology within a phylogenetic network with applications to hybridization detection</article-title>. <source>PLoS Genetics</source>. <year>2012</year>;<volume>8</volume>(<issue>4</issue>):<fpage>e1002660</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pgen.1002660" xlink:type="simple">10.1371/journal.pgen.1002660</ext-link></comment> <object-id pub-id-type="pmid">22536161</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref026">
<label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Dong</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Liu</surname> <given-names>KJ</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>Maximum likelihood inference of reticulate evolutionary histories</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2014</year>;<volume>111</volume>(<issue>46</issue>):<fpage>16448</fpage>–<lpage>16453</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.1407950111" xlink:type="simple">10.1073/pnas.1407950111</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref027">
<label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>A Maximum Pseudo-likelihood Approach for Phylogenetic Networks</article-title>. <source>BMC Genomics</source>. <year>2015</year>;<volume>16</volume>:<fpage>S10</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/1471-2164-16-S10-S10" xlink:type="simple">10.1186/1471-2164-16-S10-S10</ext-link></comment> <object-id pub-id-type="pmid">26450642</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Solís-Lemus</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Ané</surname> <given-names>C</given-names></name>. <article-title>Inferring phylogenetic networks with maximum pseudolikelihood under incomplete lineage sorting</article-title>. <source>PLoS Genetics</source>. <year>2016</year>;<volume>12</volume>(<issue>3</issue>):<fpage>e1005896</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pgen.1005896" xlink:type="simple">10.1371/journal.pgen.1005896</ext-link></comment> <object-id pub-id-type="pmid">26950302</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref029">
<label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wen</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Yu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>Bayesian Inference of Reticulate Phylogenies Under the Multispecies Network Coalescent</article-title>. <source>PLoS Genetics</source>. <year>2016</year>;<volume>12</volume>(<issue>5</issue>):<fpage>e1006006</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pgen.1006006" xlink:type="simple">10.1371/journal.pgen.1006006</ext-link></comment> <object-id pub-id-type="pmid">27144273</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref030">
<label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Than</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Ruths</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>PhyloNet: a software package for analyzing and reconstructing reticulate evolutionary relationships</article-title>. <source>BMC Bioinformatics</source>. <year>2008</year>;<volume>9</volume>(<issue>1</issue>):<fpage>322</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/1471-2105-9-322" xlink:type="simple">10.1186/1471-2105-9-322</ext-link></comment> <object-id pub-id-type="pmid">18662388</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref031">
<label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wu</surname> <given-names>Y</given-names></name>. <article-title>Coalescent-based species tree inference from gene tree topologies under incomplete lineage sorting by maximum likelihood</article-title>. <source>Evolution</source>. <year>2012</year>;<volume>66</volume>(<issue>3</issue>):<fpage>763</fpage>–<lpage>775</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/j.1558-5646.2011.01476.x" xlink:type="simple">10.1111/j.1558-5646.2011.01476.x</ext-link></comment> <object-id pub-id-type="pmid">22380439</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref032">
<label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Ristic</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>Fast algorithms and heuristics for phylogenomics under ILS and hybridization</article-title>. <source>BMC Bioinformatics</source>. <year>2013</year>;<volume>14</volume>(<issue>Suppl 15</issue>):<fpage>S6</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/1471-2105-14-S15-S6" xlink:type="simple">10.1186/1471-2105-14-S15-S6</ext-link></comment> <object-id pub-id-type="pmid">24564257</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref033">
<label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Liu</surname> <given-names>L</given-names></name>. <article-title>BEST: Bayesian estimation of species trees under the coalescent model</article-title>. <source>Bioinformatics</source>. <year>2008</year>;<volume>24</volume>(<issue>21</issue>):<fpage>2542</fpage>–<lpage>2543</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/bioinformatics/btn484" xlink:type="simple">10.1093/bioinformatics/btn484</ext-link></comment> <object-id pub-id-type="pmid">18799483</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref034">
<label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Green</surname> <given-names>PJ</given-names></name>. <article-title>Reversible jump Markov chain Monte Carlo computation and Bayesian model determination</article-title>. <source>Biometrika</source>. <year>1995</year>;<volume>82</volume>(<issue>4</issue>):<fpage>711</fpage>–<lpage>732</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/biomet/82.4.711" xlink:type="simple">10.1093/biomet/82.4.711</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>A metric on the space of reduced phylogenetic networks</article-title>. <source>IEEE/ACM Transactions on Computational Biology and Bioinformatics (TCBB)</source>. <year>2010</year>;<volume>7</volume>(<issue>2</issue>):<fpage>218</fpage>–<lpage>222</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TCBB.2009.2" xlink:type="simple">10.1109/TCBB.2009.2</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref036">
<label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Robinson</surname> <given-names>DR</given-names></name>, <name name-style="western"><surname>Foulds</surname> <given-names>LR</given-names></name>. <article-title>Comparison of phylogenetic trees</article-title>. <source>Math Biosci</source>. <year>1981</year>;<volume>53</volume>:<fpage>131</fpage>–<lpage>147</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/0025-5564(81)90043-2" xlink:type="simple">10.1016/0025-5564(81)90043-2</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Zhu</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Yu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Nakhleh</surname> <given-names>L</given-names></name>. <article-title>In the light of deep coalescence: revisiting trees within networks</article-title>. <source>BMC Bioinformatics</source>. <year>2016</year>;<volume>17</volume>(<issue>14</issue>):<fpage>415</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/s12859-016-1269-1" xlink:type="simple">10.1186/s12859-016-1269-1</ext-link></comment> <object-id pub-id-type="pmid">28185572</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref038">
<label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Chifman</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Kubatko</surname> <given-names>L</given-names></name>. <article-title>Quartet inference from SNP data under the coalescent model</article-title>. <source>Bioinformatics</source>. <year>2014</year>;<volume>30</volume>(<issue>23</issue>):<fpage>3317</fpage>–<lpage>3324</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/bioinformatics/btu530" xlink:type="simple">10.1093/bioinformatics/btu530</ext-link></comment> <object-id pub-id-type="pmid">25104814</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref039">
<label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Meudt</surname> <given-names>HM</given-names></name>, <name name-style="western"><surname>Lockhart</surname> <given-names>PJ</given-names></name>, <name name-style="western"><surname>Bryant</surname> <given-names>D</given-names></name>. <article-title>Species delimitation and phylogeny of a New Zealand plant species radiation</article-title>. <source>BMC Evolutionary Biology</source>. <year>2009</year>;<volume>9</volume>(<issue>1</issue>):<fpage>111</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/1471-2148-9-111" xlink:type="simple">10.1186/1471-2148-9-111</ext-link></comment> <object-id pub-id-type="pmid">19457251</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005932.ref040">
<label>40</label>
<mixed-citation publication-type="other" xlink:type="simple">Thiers B. Index Herbariorum: A global directory of public herbaria and associated staff. New York Botanical Gardens Virtual Herbarium; [continuously updated].</mixed-citation>
</ref>
<ref id="pcbi.1005932.ref041">
<label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Meudt</surname> <given-names>HM</given-names></name>. <article-title>Monograph of <italic>Ourisia</italic> (Plantaginaceae)</article-title>. <source>Systematic Botany Monographs</source>. <year>2006</year>;<volume>77</volume>:<fpage>1</fpage>–<lpage>188</lpage>.</mixed-citation>
</ref>
</ref-list>
</back>
</article>